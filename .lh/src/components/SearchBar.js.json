{
    "sourceFile": "src/components/SearchBar.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1746893166609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747123090964,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,17 @@\n \"use client\";\r\n import { useState, useRef, useEffect } from \"react\";\r\n import { motion } from \"framer-motion\";\r\n+import { useRouter } from \"next/navigation\";\r\n+import toast from \"react-hot-toast\";\r\n \r\n export default function SearchBar({ isSearchOpen, setIsSearchOpen }) {\r\n   const [searchQuery, setSearchQuery] = useState(\"\");\r\n   const [isFocused, setIsFocused] = useState(false);\r\n+  const [searchResults, setSearchResults] = useState([]);\r\n+  const [isLoading, setIsLoading] = useState(false);\r\n   const searchRef = useRef(null);\r\n+  const router = useRouter();\r\n \r\n   useEffect(() => {\r\n     const handleClickOutside = (event) => {\r\n       if (searchRef.current && !searchRef.current.contains(event.target)) {\r\n@@ -16,16 +21,52 @@\n     document.addEventListener(\"mousedown\", handleClickOutside);\r\n     return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n   }, [setIsSearchOpen]);\r\n \r\n+  // Thêm debounce để tránh gọi API quá nhiều\r\n+  useEffect(() => {\r\n+    const delayDebounceFn = setTimeout(() => {\r\n+      if (searchQuery.trim()) {\r\n+        handleSearch();\r\n+      } else {\r\n+        setSearchResults([]);\r\n+      }\r\n+    }, 300);\r\n+\r\n+    return () => clearTimeout(delayDebounceFn);\r\n+  }, [searchQuery]);\r\n+\r\n+  const handleSearch = async () => {\r\n+    try {\r\n+      setIsLoading(true);\r\n+      const response = await fetch(`/api/search?q=${encodeURIComponent(searchQuery)}`);\r\n+      if (!response.ok) {\r\n+        throw new Error('Search failed');\r\n+      }\r\n+      const data = await response.json();\r\n+      setSearchResults(data);\r\n+    } catch (error) {\r\n+      console.error('Search error:', error);\r\n+      toast.error('Không thể tìm kiếm sản phẩm');\r\n+    } finally {\r\n+      setIsLoading(false);\r\n+    }\r\n+  };\r\n+\r\n+  const handleProductClick = (productId) => {\r\n+    router.push(`/product/${productId}`);\r\n+    setIsSearchOpen(false);\r\n+    setSearchQuery(\"\");\r\n+  };\r\n+\r\n   return (\r\n     <motion.div\r\n       ref={searchRef}\r\n       initial={{ opacity: 0, y: -10 }}\r\n       animate={{ opacity: 1, y: 0 }}\r\n       exit={{ opacity: 0, y: -10 }}\r\n       transition={{ duration: 0.3, ease: \"easeInOut\" }}\r\n-      className=\"absolute top-[55px] right-0 w-full sm:w-1/2 h-[10vh] bg-white shadow-md p-4 flex flex-col\" // Full màn ở mobile\r\n+      className=\"absolute top-[55px] right-0 w-full sm:w-1/2 h-[80vh] bg-white shadow-md p-4 flex flex-col\"\r\n     >\r\n       <div className=\"relative w-full flex items-center gap-2\">\r\n         <div className=\"relative flex-1\">\r\n           {searchQuery === \"\" && (\r\n@@ -56,14 +97,49 @@\n           className=\"text-gray-700 text-sm font-semibold px-2 relative group\"\r\n           onClick={() => {\r\n             setIsSearchOpen(false);\r\n             setSearchQuery(\"\");\r\n+            setSearchResults([]);\r\n           }}\r\n         >\r\n           Cancel\r\n           <span className=\"absolute left-1/2 bottom-0 h-[2px] bg-black transition-all duration-300 w-0 group-hover:w-[70%] -translate-x-1/2\"></span>\r\n         </button>\r\n       </div>\r\n-      <div className=\"flex-1\"></div>\r\n+\r\n+      {/* Search Results */}\r\n+      <div className=\"flex-1 overflow-y-auto mt-4\">\r\n+        {isLoading ? (\r\n+          <div className=\"flex items-center justify-center h-full\">\r\n+            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black\"></div>\r\n+          </div>\r\n+        ) : searchResults.length > 0 ? (\r\n+          <div className=\"grid grid-cols-1 gap-4\">\r\n+            {searchResults.map((product) => (\r\n+              <div\r\n+                key={product._id}\r\n+                className=\"flex items-center gap-4 p-2 hover:bg-gray-50 cursor-pointer\"\r\n+                onClick={() => handleProductClick(product._id)}\r\n+              >\r\n+                {product.images && product.images[0] && (\r\n+                  <img\r\n+                    src={product.images[0]}\r\n+                    alt={product.name}\r\n+                    className=\"w-16 h-16 object-cover\"\r\n+                  />\r\n+                )}\r\n+                <div>\r\n+                  <h3 className=\"text-sm font-semibold text-black\">{product.name}</h3>\r\n+                  <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')}đ</p>\r\n+                </div>\r\n+              </div>\r\n+            ))}\r\n+          </div>\r\n+        ) : searchQuery ? (\r\n+          <div className=\"text-center text-gray-500 mt-8\">\r\n+            Không tìm thấy sản phẩm\r\n+          </div>\r\n+        ) : null}\r\n+      </div>\r\n     </motion.div>\r\n   );\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747123364435,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,11 +52,12 @@\n     }\r\n   };\r\n \r\n   const handleProductClick = (productId) => {\r\n-    router.push(`/product/${productId}`);\r\n+    router.push(`/products/${productId}`);\r\n     setIsSearchOpen(false);\r\n     setSearchQuery(\"\");\r\n+    setSearchResults([]);\r\n   };\r\n \r\n   return (\r\n     <motion.div\r\n@@ -64,9 +65,11 @@\n       initial={{ opacity: 0, y: -10 }}\r\n       animate={{ opacity: 1, y: 0 }}\r\n       exit={{ opacity: 0, y: -10 }}\r\n       transition={{ duration: 0.3, ease: \"easeInOut\" }}\r\n-      className=\"absolute top-[55px] right-0 w-full sm:w-1/2 h-[80vh] bg-white shadow-md p-4 flex flex-col\"\r\n+      className={`absolute top-[55px] right-0 w-full sm:w-1/2 bg-white shadow-md p-4 flex flex-col ${\r\n+        searchResults.length > 0 ? 'h-[80vh]' : 'h-[10vh]'\r\n+      }`}\r\n     >\r\n       <div className=\"relative w-full flex items-center gap-2\">\r\n         <div className=\"relative flex-1\">\r\n           {searchQuery === \"\" && (\r\n@@ -106,40 +109,44 @@\n         </button>\r\n       </div>\r\n \r\n       {/* Search Results */}\r\n-      <div className=\"flex-1 overflow-y-auto mt-4\">\r\n-        {isLoading ? (\r\n-          <div className=\"flex items-center justify-center h-full\">\r\n-            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black\"></div>\r\n-          </div>\r\n-        ) : searchResults.length > 0 ? (\r\n-          <div className=\"grid grid-cols-1 gap-4\">\r\n-            {searchResults.map((product) => (\r\n-              <div\r\n-                key={product._id}\r\n-                className=\"flex items-center gap-4 p-2 hover:bg-gray-50 cursor-pointer\"\r\n-                onClick={() => handleProductClick(product._id)}\r\n-              >\r\n-                {product.images && product.images[0] && (\r\n-                  <img\r\n-                    src={product.images[0]}\r\n-                    alt={product.name}\r\n-                    className=\"w-16 h-16 object-cover\"\r\n-                  />\r\n-                )}\r\n-                <div>\r\n-                  <h3 className=\"text-sm font-semibold text-black\">{product.name}</h3>\r\n-                  <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')}đ</p>\r\n+      {searchResults.length > 0 && (\r\n+        <div className=\"flex-1 overflow-y-auto mt-4\">\r\n+          {isLoading ? (\r\n+            <div className=\"flex items-center justify-center h-full\">\r\n+              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black\"></div>\r\n+            </div>\r\n+          ) : (\r\n+            <div className=\"grid grid-cols-1 gap-4\">\r\n+              {searchResults.map((product) => (\r\n+                <div\r\n+                  key={product._id}\r\n+                  className=\"flex items-center gap-4 p-2 hover:bg-gray-50 cursor-pointer\"\r\n+                  onClick={() => handleProductClick(product._id)}\r\n+                >\r\n+                  {product.images && product.images[0] && (\r\n+                    <img\r\n+                      src={product.images[0]}\r\n+                      alt={product.name}\r\n+                      className=\"w-16 h-16 object-cover\"\r\n+                    />\r\n+                  )}\r\n+                  <div>\r\n+                    <h3 className=\"text-sm font-semibold text-black\">{product.name}</h3>\r\n+                    <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')}đ</p>\r\n+                  </div>\r\n                 </div>\r\n-              </div>\r\n-            ))}\r\n-          </div>\r\n-        ) : searchQuery ? (\r\n-          <div className=\"text-center text-gray-500 mt-8\">\r\n-            Không tìm thấy sản phẩm\r\n-          </div>\r\n-        ) : null}\r\n-      </div>\r\n+              ))}\r\n+            </div>\r\n+          )}\r\n+        </div>\r\n+      )}\r\n+\r\n+      {searchQuery && !isLoading && searchResults.length === 0 && (\r\n+        <div className=\"text-center text-gray-500 mt-8\">\r\n+          Không tìm thấy sản phẩm\r\n+        </div>\r\n+      )}\r\n     </motion.div>\r\n   );\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747123579112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,9 +132,9 @@\n                     />\r\n                   )}\r\n                   <div>\r\n                     <h3 className=\"text-sm font-semibold text-black\">{product.name}</h3>\r\n-                    <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')}đ</p>\r\n+                    <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')} VND</p>\r\n                   </div>\r\n                 </div>\r\n               ))}\r\n             </div>\r\n"
                },
                {
                    "date": 1747199003666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,9 +52,9 @@\n     }\r\n   };\r\n \r\n   const handleProductClick = (productId) => {\r\n-    router.push(`/products/${productId}`);\r\n+    router.push(`/${productId}`);\r\n     setIsSearchOpen(false);\r\n     setSearchQuery(\"\");\r\n     setSearchResults([]);\r\n   };\r\n"
                },
                {
                    "date": 1747213826240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,9 @@\n       animate={{ opacity: 1, y: 0 }}\r\n       exit={{ opacity: 0, y: -10 }}\r\n       transition={{ duration: 0.3, ease: \"easeInOut\" }}\r\n       className={`absolute top-[55px] right-0 w-full sm:w-1/2 bg-white shadow-md p-4 flex flex-col ${\r\n-        searchResults.length > 0 ? 'h-[80vh]' : 'h-[10vh]'\r\n+        searchResults.length > 0 || (searchQuery && !isLoading && searchResults.length === 0) ? 'h-[80vh]' : 'h-[10vh]'\r\n       }`}\r\n     >\r\n       <div className=\"relative w-full flex items-center gap-2\">\r\n         <div className=\"relative flex-1\">\r\n@@ -142,10 +142,12 @@\n         </div>\r\n       )}\r\n \r\n       {searchQuery && !isLoading && searchResults.length === 0 && (\r\n-        <div className=\"text-center text-gray-500 mt-8\">\r\n-          Không tìm thấy sản phẩm\r\n+        <div className=\"flex-1 flex items-center justify-center\">\r\n+          <div className=\"text-center text-gray-500 text-lg\">\r\n+            Không tìm thấy sản phẩm\r\n+          </div>\r\n         </div>\r\n       )}\r\n     </motion.div>\r\n   );\r\n"
                },
                {
                    "date": 1747213897974,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,9 @@\n       animate={{ opacity: 1, y: 0 }}\r\n       exit={{ opacity: 0, y: -10 }}\r\n       transition={{ duration: 0.3, ease: \"easeInOut\" }}\r\n       className={`absolute top-[55px] right-0 w-full sm:w-1/2 bg-white shadow-md p-4 flex flex-col ${\r\n-        searchResults.length > 0 || (searchQuery && !isLoading && searchResults.length === 0) ? 'h-[80vh]' : 'h-[10vh]'\r\n+        searchResults.length > 0 ? 'h-[80vh]' : 'h-[15vh]'\r\n       }`}\r\n     >\r\n       <div className=\"relative w-full flex items-center gap-2\">\r\n         <div className=\"relative flex-1\">\r\n@@ -142,12 +142,10 @@\n         </div>\r\n       )}\r\n \r\n       {searchQuery && !isLoading && searchResults.length === 0 && (\r\n-        <div className=\"flex-1 flex items-center justify-center\">\r\n-          <div className=\"text-center text-gray-500 text-lg\">\r\n-            Không tìm thấy sản phẩm\r\n-          </div>\r\n+        <div className=\"text-center text-gray-500 mt-4 text-sm\">\r\n+          Không tìm thấy sản phẩm\r\n         </div>\r\n       )}\r\n     </motion.div>\r\n   );\r\n"
                },
                {
                    "date": 1747214002053,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,9 +52,9 @@\n     }\r\n   };\r\n \r\n   const handleProductClick = (productId) => {\r\n-    router.push(`/${productId}`);\r\n+    router.push(`/products/${productId}`);\r\n     setIsSearchOpen(false);\r\n     setSearchQuery(\"\");\r\n     setSearchResults([]);\r\n   };\r\n"
                },
                {
                    "date": 1747214040476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,10 +51,10 @@\n       setIsLoading(false);\r\n     }\r\n   };\r\n \r\n-  const handleProductClick = (productId) => {\r\n-    router.push(`/products/${productId}`);\r\n+  const handleProductClick = (product) => {\r\n+    router.push(`/${product.slug}`);\r\n     setIsSearchOpen(false);\r\n     setSearchQuery(\"\");\r\n     setSearchResults([]);\r\n   };\r\n@@ -121,9 +121,9 @@\n               {searchResults.map((product) => (\r\n                 <div\r\n                   key={product._id}\r\n                   className=\"flex items-center gap-4 p-2 hover:bg-gray-50 cursor-pointer\"\r\n-                  onClick={() => handleProductClick(product._id)}\r\n+                  onClick={() => handleProductClick(product)}\r\n                 >\r\n                   {product.images && product.images[0] && (\r\n                     <img\r\n                       src={product.images[0]}\r\n"
                },
                {
                    "date": 1747294779053,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,19 +1,40 @@\n \"use client\";\r\n import { useState, useRef, useEffect } from \"react\";\r\n import { motion } from \"framer-motion\";\r\n import { useRouter } from \"next/navigation\";\r\n+import { useLanguage } from '../context/LanguageContext';\r\n import toast from \"react-hot-toast\";\r\n \r\n export default function SearchBar({ isSearchOpen, setIsSearchOpen }) {\r\n   const [searchQuery, setSearchQuery] = useState(\"\");\r\n   const [isFocused, setIsFocused] = useState(false);\r\n   const [searchResults, setSearchResults] = useState([]);\r\n   const [isLoading, setIsLoading] = useState(false);\r\n+  const [exchangeRate, setExchangeRate] = useState(26000); // Default fallback rate\r\n   const searchRef = useRef(null);\r\n   const router = useRouter();\r\n+  const { t, language } = useLanguage();\r\n \r\n   useEffect(() => {\r\n+    const fetchExchangeRate = async () => {\r\n+      try {\r\n+        const response = await fetch('https://open.er-api.com/v6/latest/USD');\r\n+        const data = await response.json();\r\n+        if (data.rates && data.rates.VND) {\r\n+          setExchangeRate(data.rates.VND);\r\n+        }\r\n+      } catch (error) {\r\n+        console.error('Error fetching exchange rate:', error);\r\n+      }\r\n+    };\r\n+\r\n+    fetchExchangeRate();\r\n+    const interval = setInterval(fetchExchangeRate, 3600000);\r\n+    return () => clearInterval(interval);\r\n+  }, []);\r\n+\r\n+  useEffect(() => {\r\n     const handleClickOutside = (event) => {\r\n       if (searchRef.current && !searchRef.current.contains(event.target)) {\r\n         setIsSearchOpen(false);\r\n       }\r\n@@ -45,9 +66,9 @@\n       const data = await response.json();\r\n       setSearchResults(data);\r\n     } catch (error) {\r\n       console.error('Search error:', error);\r\n-      toast.error('Không thể tìm kiếm sản phẩm');\r\n+      toast.error(t('search.error'));\r\n     } finally {\r\n       setIsLoading(false);\r\n     }\r\n   };\r\n@@ -58,8 +79,18 @@\n     setSearchQuery(\"\");\r\n     setSearchResults([]);\r\n   };\r\n \r\n+  // Format price based on language\r\n+  const formatPrice = (price) => {\r\n+    if (language === 'vi') {\r\n+      return `${price.toLocaleString('vi-VN')} VND`;\r\n+    } else {\r\n+      const usdPrice = (price / exchangeRate).toFixed(2);\r\n+      return `$${usdPrice}`;\r\n+    }\r\n+  };\r\n+\r\n   return (\r\n     <motion.div\r\n       ref={searchRef}\r\n       initial={{ opacity: 0, y: -10 }}\r\n@@ -77,9 +108,9 @@\n               className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-600 font-semibold text-xs pointer-events-none\"\r\n               animate={{ opacity: [1, 0.5, 1] }}\r\n               transition={{ duration: 1.5, repeat: Infinity, ease: \"easeInOut\" }}\r\n             >\r\n-              What are you looking for?\r\n+              {t('search.placeholder')}\r\n             </motion.span>\r\n           )}\r\n           <input\r\n             type=\"text\"\r\n@@ -103,9 +134,9 @@\n             setSearchQuery(\"\");\r\n             setSearchResults([]);\r\n           }}\r\n         >\r\n-          Cancel\r\n+          {t('search.cancel')}\r\n           <span className=\"absolute left-1/2 bottom-0 h-[2px] bg-black transition-all duration-300 w-0 group-hover:w-[70%] -translate-x-1/2\"></span>\r\n         </button>\r\n       </div>\r\n \r\n@@ -132,9 +163,9 @@\n                     />\r\n                   )}\r\n                   <div>\r\n                     <h3 className=\"text-sm font-semibold text-black\">{product.name}</h3>\r\n-                    <p className=\"text-xs text-gray-600\">{product.price.toLocaleString('vi-VN')} VND</p>\r\n+                    <p className=\"text-xs text-gray-600\">{formatPrice(product.price)}</p>\r\n                   </div>\r\n                 </div>\r\n               ))}\r\n             </div>\r\n@@ -143,9 +174,9 @@\n       )}\r\n \r\n       {searchQuery && !isLoading && searchResults.length === 0 && (\r\n         <div className=\"text-center text-gray-500 mt-4 text-sm\">\r\n-          Không tìm thấy sản phẩm\r\n+          {t('search.noResults')}\r\n         </div>\r\n       )}\r\n     </motion.div>\r\n   );\r\n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "\"use client\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function SearchBar({ isSearchOpen, setIsSearchOpen }) {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [isFocused, setIsFocused] = useState(false);\r\n  const searchRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (searchRef.current && !searchRef.current.contains(event.target)) {\r\n        setIsSearchOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, [setIsSearchOpen]);\r\n\r\n  return (\r\n    <motion.div\r\n      ref={searchRef}\r\n      initial={{ opacity: 0, y: -10 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      exit={{ opacity: 0, y: -10 }}\r\n      transition={{ duration: 0.3, ease: \"easeInOut\" }}\r\n      className=\"absolute top-[55px] right-0 w-full sm:w-1/2 h-[10vh] bg-white shadow-md p-4 flex flex-col\" // Full màn ở mobile\r\n    >\r\n      <div className=\"relative w-full flex items-center gap-2\">\r\n        <div className=\"relative flex-1\">\r\n          {searchQuery === \"\" && (\r\n            <motion.span\r\n              className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-600 font-semibold text-xs pointer-events-none\"\r\n              animate={{ opacity: [1, 0.5, 1] }}\r\n              transition={{ duration: 1.5, repeat: Infinity, ease: \"easeInOut\" }}\r\n            >\r\n              What are you looking for?\r\n            </motion.span>\r\n          )}\r\n          <input\r\n            type=\"text\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            onFocus={() => setIsFocused(true)}\r\n            onBlur={() => setIsFocused(false)}\r\n            className=\"w-full pt-2 pb-2 text-sm text-black font-semibold focus:outline-none border-b-2 border-gray-300 pl-3\"\r\n          />\r\n          <motion.span\r\n            className=\"absolute left-0 bottom-0 h-[2px] bg-black\"\r\n            initial={{ width: \"0%\" }}\r\n            animate={isFocused ? { width: \"100%\" } : { width: \"0%\" }}\r\n            transition={{ duration: 0.6, ease: \"easeOut\" }}\r\n          />\r\n        </div>\r\n        <button\r\n          className=\"text-gray-700 text-sm font-semibold px-2 relative group\"\r\n          onClick={() => {\r\n            setIsSearchOpen(false);\r\n            setSearchQuery(\"\");\r\n          }}\r\n        >\r\n          Cancel\r\n          <span className=\"absolute left-1/2 bottom-0 h-[2px] bg-black transition-all duration-300 w-0 group-hover:w-[70%] -translate-x-1/2\"></span>\r\n        </button>\r\n      </div>\r\n      <div className=\"flex-1\"></div>\r\n    </motion.div>\r\n  );\r\n}"
        }
    ]
}