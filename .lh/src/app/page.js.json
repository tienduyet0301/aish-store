{
    "sourceFile": "src/app/page.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 28,
            "patches": [
                {
                    "date": 1746893163061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747040998089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,22 +56,22 @@\n       if (isScrolling) return;\n       const delta = Math.sign(e.deltaY);\n       const newIdx = Math.max(0, Math.min(banners.length - 1, imageIdx + delta));\n       if (newIdx === currentImage) return;\n-      setIsScrolling(true);\n+        setIsScrolling(true);\n       setCurrentImage(newIdx);\n       const start = scrollY;\n       const end = newIdx * winH;\n-      const startTime = performance.now();\n+        const startTime = performance.now();\n       function animateScroll(now) {\n         const elapsed = now - startTime;\n         const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n         window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n-        if (progress < 1) {\n-          requestAnimationFrame(animateScroll);\n-        } else {\n-          setIsScrolling(false);\n-        }\n+          if (progress < 1) {\n+            requestAnimationFrame(animateScroll);\n+          } else {\n+            setIsScrolling(false);\n+          }\n       }\n       requestAnimationFrame(animateScroll);\n     },\n     [banners.length, currentImage, isScrolling]\n@@ -84,15 +84,15 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return banners.map((banner, idx) => (\n-      <div\n+          <div\n         key={banner._id || idx}\n         className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-      >\n-        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-          <Image\n-            src={banner.imageUrl}\n+          >\n+            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+              <Image\n+                src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -132,11 +132,11 @@\n             style={{\n               objectFit: 'cover',\n               objectPosition: 'center',\n             }}\n-          />\n-        </div>\n-      </div>\n+              />\n+            </div>\n+          </div>\n     );\n   }\n \n   return (\n"
                },
                {
                    "date": 1747236045584,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n import Image from \"next/image\";\n import { FiMessageCircle } from \"react-icons/fi\";\n+import Link from 'next/link';\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n \n@@ -56,22 +57,22 @@\n       if (isScrolling) return;\n       const delta = Math.sign(e.deltaY);\n       const newIdx = Math.max(0, Math.min(banners.length - 1, imageIdx + delta));\n       if (newIdx === currentImage) return;\n-        setIsScrolling(true);\n+      setIsScrolling(true);\n       setCurrentImage(newIdx);\n       const start = scrollY;\n       const end = newIdx * winH;\n-        const startTime = performance.now();\n+      const startTime = performance.now();\n       function animateScroll(now) {\n         const elapsed = now - startTime;\n         const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n         window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n-          if (progress < 1) {\n-            requestAnimationFrame(animateScroll);\n-          } else {\n-            setIsScrolling(false);\n-          }\n+        if (progress < 1) {\n+          requestAnimationFrame(animateScroll);\n+        } else {\n+          setIsScrolling(false);\n+        }\n       }\n       requestAnimationFrame(animateScroll);\n     },\n     [banners.length, currentImage, isScrolling]\n@@ -84,15 +85,15 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return banners.map((banner, idx) => (\n-          <div\n+      <div\n         key={banner._id || idx}\n         className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-          >\n-            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-              <Image\n-                src={banner.imageUrl}\n+      >\n+        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+          <Image\n+            src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -132,16 +133,31 @@\n             style={{\n               objectFit: 'cover',\n               objectPosition: 'center',\n             }}\n-              />\n-            </div>\n-          </div>\n+          />\n+        </div>\n+      </div>\n     );\n   }\n \n   return (\n     <div className=\"relative w-full bg-black overflow-hidden\">\n+      {/* Menu items */}\n+      <div className=\"flex flex-wrap justify-center gap-4 p-4 bg-white\">\n+        <Link href=\"/tshirt\" className=\"text-gray-600 hover:text-gray-900\">TSHIRT</Link>\n+        <Link href=\"/shirt\" className=\"text-gray-600 hover:text-gray-900\">SHIRT</Link>\n+        <Link href=\"/polo\" className=\"text-gray-600 hover:text-gray-900\">POLO</Link>\n+        <Link href=\"/sweater\" className=\"text-gray-600 hover:text-gray-900\">SWEATER</Link>\n+        <Link href=\"/hoodie\" className=\"text-gray-600 hover:text-gray-900\">HOODIE</Link>\n+        <Link href=\"/accept-the-problem\" className=\"text-gray-600 hover:text-gray-900\">ACCEPT THE PROBLEM</Link>\n+        <Link href=\"/back-to-summer\" className=\"text-gray-600 hover:text-gray-900\">BACK TO SUMMER</Link>\n+        <Link href=\"/chill-calm-down\" className=\"text-gray-600 hover:text-gray-900\">CHILL, CALM DOWN</Link>\n+        <Link href=\"/return-policy\" className=\"text-gray-600 hover:text-gray-900\">RETURN POLICY</Link>\n+        <Link href=\"/warranty-policy\" className=\"text-gray-600 hover:text-gray-900\">WARRANTY POLICY</Link>\n+        <Link href=\"/care-instructions\" className=\"text-gray-600 hover:text-gray-900\">CARE INSTRUCTIONS</Link>\n+      </div>\n+\n       <div className=\"flex flex-col\">\n         {bannerItems}\n       </div>\n \n"
                },
                {
                    "date": 1747236093970,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,8 @@\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n import Image from \"next/image\";\n import { FiMessageCircle } from \"react-icons/fi\";\n-import Link from 'next/link';\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n \n@@ -57,22 +56,22 @@\n       if (isScrolling) return;\n       const delta = Math.sign(e.deltaY);\n       const newIdx = Math.max(0, Math.min(banners.length - 1, imageIdx + delta));\n       if (newIdx === currentImage) return;\n-      setIsScrolling(true);\n+        setIsScrolling(true);\n       setCurrentImage(newIdx);\n       const start = scrollY;\n       const end = newIdx * winH;\n-      const startTime = performance.now();\n+        const startTime = performance.now();\n       function animateScroll(now) {\n         const elapsed = now - startTime;\n         const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n         window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n-        if (progress < 1) {\n-          requestAnimationFrame(animateScroll);\n-        } else {\n-          setIsScrolling(false);\n-        }\n+          if (progress < 1) {\n+            requestAnimationFrame(animateScroll);\n+          } else {\n+            setIsScrolling(false);\n+          }\n       }\n       requestAnimationFrame(animateScroll);\n     },\n     [banners.length, currentImage, isScrolling]\n@@ -85,15 +84,15 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return banners.map((banner, idx) => (\n-      <div\n+          <div\n         key={banner._id || idx}\n         className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-      >\n-        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-          <Image\n-            src={banner.imageUrl}\n+          >\n+            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+              <Image\n+                src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -133,31 +132,16 @@\n             style={{\n               objectFit: 'cover',\n               objectPosition: 'center',\n             }}\n-          />\n-        </div>\n-      </div>\n+              />\n+            </div>\n+          </div>\n     );\n   }\n \n   return (\n     <div className=\"relative w-full bg-black overflow-hidden\">\n-      {/* Menu items */}\n-      <div className=\"flex flex-wrap justify-center gap-4 p-4 bg-white\">\n-        <Link href=\"/tshirt\" className=\"text-gray-600 hover:text-gray-900\">TSHIRT</Link>\n-        <Link href=\"/shirt\" className=\"text-gray-600 hover:text-gray-900\">SHIRT</Link>\n-        <Link href=\"/polo\" className=\"text-gray-600 hover:text-gray-900\">POLO</Link>\n-        <Link href=\"/sweater\" className=\"text-gray-600 hover:text-gray-900\">SWEATER</Link>\n-        <Link href=\"/hoodie\" className=\"text-gray-600 hover:text-gray-900\">HOODIE</Link>\n-        <Link href=\"/accept-the-problem\" className=\"text-gray-600 hover:text-gray-900\">ACCEPT THE PROBLEM</Link>\n-        <Link href=\"/back-to-summer\" className=\"text-gray-600 hover:text-gray-900\">BACK TO SUMMER</Link>\n-        <Link href=\"/chill-calm-down\" className=\"text-gray-600 hover:text-gray-900\">CHILL, CALM DOWN</Link>\n-        <Link href=\"/return-policy\" className=\"text-gray-600 hover:text-gray-900\">RETURN POLICY</Link>\n-        <Link href=\"/warranty-policy\" className=\"text-gray-600 hover:text-gray-900\">WARRANTY POLICY</Link>\n-        <Link href=\"/care-instructions\" className=\"text-gray-600 hover:text-gray-900\">CARE INSTRUCTIONS</Link>\n-      </div>\n-\n       <div className=\"flex flex-col\">\n         {bannerItems}\n       </div>\n \n"
                },
                {
                    "date": 1747278383569,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,4 +176,7 @@\n       </motion.div>\n     </div>\n   );\n }\n+export const metadata = {\n+  title: 'AISH Official Site',\n+};\n"
                },
                {
                    "date": 1747278892961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,8 @@\n+export const metadata = {\n+  title: 'AISH Official Site',\n+};\n+\n \"use client\";\n import { useState, useEffect, useCallback, useMemo } from \"react\";\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n@@ -176,7 +180,4 @@\n       </motion.div>\n     </div>\n   );\n }\n-export const metadata = {\n-  title: 'AISH Official Site',\n-};\n"
                },
                {
                    "date": 1747278905524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,4 @@\n-export const metadata = {\n-  title: 'AISH Official Site',\n-};\n-\n \"use client\";\n import { useState, useEffect, useCallback, useMemo } from \"react\";\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n"
                },
                {
                    "date": 1747366383827,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -149,9 +149,9 @@\n       <motion.div\n         initial={{ opacity: 0, y: 20 }}\n         animate={{ opacity: 1, y: 0 }}\n         whileHover={{ scale: 1.05 }}\n-        className=\"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-10\"\n+        className=\"absolute top-24 left-8 z-10\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n           className=\"bg-white text-black px-8 py-3 rounded-full text-lg font-semibold hover:bg-gray-100 transition-colors\"\n"
                },
                {
                    "date": 1747366465735,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -149,13 +149,13 @@\n       <motion.div\n         initial={{ opacity: 0, y: 20 }}\n         animate={{ opacity: 1, y: 0 }}\n         whileHover={{ scale: 1.05 }}\n-        className=\"absolute top-24 left-8 z-10\"\n+        className=\"fixed top-24 left-8 z-50\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-8 py-3 rounded-full text-lg font-semibold hover:bg-gray-100 transition-colors\"\n+          className=\"bg-transparent text-white px-8 py-3 text-lg font-semibold border-2 border-white hover:bg-white hover:text-black transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747366538791,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n         className=\"fixed top-24 left-8 z-50\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-transparent text-white px-8 py-3 text-lg font-semibold border-2 border-white hover:bg-white hover:text-black transition-all duration-300\"\n+          className=\"bg-white text-black px-6 py-2 text-sm font-semibold border-2 border-black hover:bg-black hover:text-white transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747366663040,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n         className=\"fixed top-24 left-8 z-50\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-6 py-2 text-sm font-semibold border-2 border-black hover:bg-black hover:text-white transition-all duration-300\"\n+          className=\"bg-white text-black px-6 py-2 text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747366752046,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -149,9 +149,9 @@\n       <motion.div\n         initial={{ opacity: 0, y: 20 }}\n         animate={{ opacity: 1, y: 0 }}\n         whileHover={{ scale: 1.05 }}\n-        className=\"fixed top-24 left-8 z-50\"\n+        className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n           className=\"bg-white text-black px-6 py-2 text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n"
                },
                {
                    "date": 1747381832417,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -84,15 +84,15 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return banners.map((banner, idx) => (\n-          <div\n+      <div\n         key={banner._id || idx}\n-        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-          >\n-            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-              <Image\n-                src={banner.imageUrl}\n+        className=\"relative w-full h-[100vh] md:h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n+      >\n+        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+          <Image\n+            src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -108,8 +108,30 @@\n             onError={(e) => {\n               e.target.src = DEFAULT_BANNER_IMAGE;\n             }}\n           />\n+          {(banner.title || banner.description) && (\n+            <div className=\"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center\">\n+              <div className=\"text-center text-white p-4 max-w-[90%] md:max-w-[80%]\">\n+                {banner.title && (\n+                  <h2 className=\"text-xl md:text-3xl font-bold mb-2\">{banner.title}</h2>\n+                )}\n+                {banner.description && (\n+                  <p className=\"text-sm md:text-lg\">{banner.description}</p>\n+                )}\n+                {banner.link && (\n+                  <a\n+                    href={banner.link}\n+                    target=\"_blank\"\n+                    rel=\"noopener noreferrer\"\n+                    className=\"inline-block mt-4 px-4 md:px-6 py-2 bg-white text-black rounded-md hover:bg-gray-100 transition-colors text-sm md:text-base\"\n+                  >\n+                    Learn More\n+                  </a>\n+                )}\n+              </div>\n+            </div>\n+          )}\n         </div>\n       </div>\n     ));\n   }, [banners]);\n"
                },
                {
                    "date": 1747381865977,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -84,15 +84,15 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return banners.map((banner, idx) => (\n-      <div\n+          <div\n         key={banner._id || idx}\n-        className=\"relative w-full h-[100vh] md:h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-      >\n-        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-          <Image\n-            src={banner.imageUrl}\n+        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n+          >\n+            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+              <Image\n+                src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -108,30 +108,8 @@\n             onError={(e) => {\n               e.target.src = DEFAULT_BANNER_IMAGE;\n             }}\n           />\n-          {(banner.title || banner.description) && (\n-            <div className=\"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center\">\n-              <div className=\"text-center text-white p-4 max-w-[90%] md:max-w-[80%]\">\n-                {banner.title && (\n-                  <h2 className=\"text-xl md:text-3xl font-bold mb-2\">{banner.title}</h2>\n-                )}\n-                {banner.description && (\n-                  <p className=\"text-sm md:text-lg\">{banner.description}</p>\n-                )}\n-                {banner.link && (\n-                  <a\n-                    href={banner.link}\n-                    target=\"_blank\"\n-                    rel=\"noopener noreferrer\"\n-                    className=\"inline-block mt-4 px-4 md:px-6 py-2 bg-white text-black rounded-md hover:bg-gray-100 transition-colors text-sm md:text-base\"\n-                  >\n-                    Learn More\n-                  </a>\n-                )}\n-              </div>\n-            </div>\n-          )}\n         </div>\n       </div>\n     ));\n   }, [banners]);\n"
                },
                {
                    "date": 1747384840910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,13 +27,26 @@\n       try {\n         const response = await fetch(\"/api/banners\");\n         const data = await response.json();\n         if (!ignore) {\n-          setBanners(\n-            Array.isArray(data)\n-              ? data.filter(b => b && b.imageUrl && b.isActive)\n-              : []\n-          );\n+          // Lọc banner active và phân loại desktop/mobile\n+          const activeBanners = Array.isArray(data)\n+            ? data.filter(b => b && b.imageUrl && b.isActive)\n+            : [];\n+\n+          // Phân loại banner dựa vào kích thước ảnh\n+          const processedBanners = await Promise.all(activeBanners.map(async (banner) => {\n+            const isMobile = await new Promise((resolve) => {\n+              const img = new window.Image();\n+              img.onload = () => {\n+                resolve(img.height > img.width);\n+              };\n+              img.src = banner.imageUrl;\n+            });\n+            return { ...banner, isMobile };\n+          }));\n+\n+          setBanners(processedBanners);\n         }\n       } catch (error) {\n         if (!ignore) setBanners([]);\n       }\n@@ -43,20 +56,36 @@\n       ignore = true;\n     };\n   }, []);\n \n+  // Kiểm tra thiết bị\n+  const [isMobileDevice, setIsMobileDevice] = useState(false);\n+  useEffect(() => {\n+    const checkMobile = () => {\n+      setIsMobileDevice(window.innerWidth < 768);\n+    };\n+    checkMobile();\n+    window.addEventListener('resize', checkMobile);\n+    return () => window.removeEventListener('resize', checkMobile);\n+  }, []);\n+\n+  // Lọc banner theo thiết bị\n+  const filteredBanners = useMemo(() => {\n+    return banners.filter(banner => banner.isMobile === isMobileDevice);\n+  }, [banners, isMobileDevice]);\n+\n   // Scroll handler\n   const handleScroll = useCallback(\n     (e) => {\n-      if (banners.length < 2) return;\n+      if (filteredBanners.length < 2) return;\n       const scrollY = window.scrollY;\n       const winH = window.innerHeight;\n       const imageIdx = Math.floor(scrollY / winH);\n-      if (imageIdx === banners.length - 1 && e.deltaY > 0) return;\n+      if (imageIdx === filteredBanners.length - 1 && e.deltaY > 0) return;\n       e.preventDefault();\n       if (isScrolling) return;\n       const delta = Math.sign(e.deltaY);\n-      const newIdx = Math.max(0, Math.min(banners.length - 1, imageIdx + delta));\n+      const newIdx = Math.max(0, Math.min(filteredBanners.length - 1, imageIdx + delta));\n       if (newIdx === currentImage) return;\n         setIsScrolling(true);\n       setCurrentImage(newIdx);\n       const start = scrollY;\n@@ -73,9 +102,9 @@\n           }\n       }\n       requestAnimationFrame(animateScroll);\n     },\n-    [banners.length, currentImage, isScrolling]\n+    [filteredBanners.length, currentImage, isScrolling]\n   );\n \n   useEffect(() => {\n     window.addEventListener(\"wheel\", handleScroll, { passive: false });\n@@ -83,16 +112,16 @@\n   }, [handleScroll]);\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n-    return banners.map((banner, idx) => (\n-          <div\n+    return filteredBanners.map((banner, idx) => (\n+      <div\n         key={banner._id || idx}\n         className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-          >\n-            <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-              <Image\n-                src={banner.imageUrl}\n+      >\n+        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+          <Image\n+            src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n             priority\n@@ -111,12 +140,12 @@\n           />\n         </div>\n       </div>\n     ));\n-  }, [banners]);\n+  }, [filteredBanners]);\n \n   // Render fallback if no banners\n-  if (!banners.length) {\n+  if (!filteredBanners.length) {\n     return (\n       <div className=\"h-screen flex items-center justify-center overflow-hidden\">\n         <div className=\"relative w-full h-full\">\n           <Image\n@@ -132,11 +161,11 @@\n             style={{\n               objectFit: 'cover',\n               objectPosition: 'center',\n             }}\n-              />\n-            </div>\n-          </div>\n+          />\n+        </div>\n+      </div>\n     );\n   }\n \n   return (\n"
                },
                {
                    "date": 1747385008423,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,9 +182,9 @@\n         className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-6 py-2 text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n+          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747386322447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,9 @@\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n   const router = useRouter();\n+  const [isAtTop, setIsAtTop] = useState(true);\n \n   // Fetch banners only once\n   useEffect(() => {\n     let ignore = false;\n@@ -110,8 +111,14 @@\n     window.addEventListener(\"wheel\", handleScroll, { passive: false });\n     return () => window.removeEventListener(\"wheel\", handleScroll);\n   }, [handleScroll]);\n \n+  useEffect(() => {\n+    const handleScroll = () => setIsAtTop(window.scrollY === 0);\n+    window.addEventListener('scroll', handleScroll);\n+    return () => window.removeEventListener('scroll', handleScroll);\n+  }, []);\n+\n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return filteredBanners.map((banner, idx) => (\n       <div\n@@ -182,9 +189,9 @@\n         className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n+          className={`bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300 ${isAtTop ? \"opacity-0 pointer-events-none\" : \"opacity-100 pointer-events-auto\"}`}\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747386367686,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,8 @@\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n   const router = useRouter();\n-  const [isAtTop, setIsAtTop] = useState(true);\n \n   // Fetch banners only once\n   useEffect(() => {\n     let ignore = false;\n@@ -111,14 +110,8 @@\n     window.addEventListener(\"wheel\", handleScroll, { passive: false });\n     return () => window.removeEventListener(\"wheel\", handleScroll);\n   }, [handleScroll]);\n \n-  useEffect(() => {\n-    const handleScroll = () => setIsAtTop(window.scrollY === 0);\n-    window.addEventListener('scroll', handleScroll);\n-    return () => window.removeEventListener('scroll', handleScroll);\n-  }, []);\n-\n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return filteredBanners.map((banner, idx) => (\n       <div\n@@ -189,9 +182,9 @@\n         className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className={`bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300 ${isAtTop ? \"opacity-0 pointer-events-none\" : \"opacity-100 pointer-events-auto\"}`}\n+          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747386455577,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,9 +182,14 @@\n         className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n+          className={`px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold transition-all duration-300\n+            ${isAtTop\n+              ? \"bg-transparent border-transparent text-black\"\n+              : \"bg-white border border-black text-black hover:bg-black hover:text-white\"\n+            }\n+          `}\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747386493572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,14 +182,9 @@\n         className=\"fixed top-24 left-8 z-20\"\n       >\n         <button\n           onClick={() => router.push(\"/products\")}\n-          className={`px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold transition-all duration-300\n-            ${isAtTop\n-              ? \"bg-transparent border-transparent text-black\"\n-              : \"bg-white border border-black text-black hover:bg-black hover:text-white\"\n-            }\n-          `}\n+          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n"
                },
                {
                    "date": 1747408333794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,22 +187,7 @@\n         >\n           SHOP NOW\n         </button>\n       </motion.div>\n-\n-      {/* Chat button */}\n-      <motion.div\n-        initial={{ opacity: 0, x: 20 }}\n-        animate={{ opacity: 1, x: 0 }}\n-        whileHover={{ scale: 1.1 }}\n-        className=\"fixed bottom-8 right-8 z-50\"\n-      >\n-        <button\n-          className=\"bg-white text-black p-4 rounded-full shadow-lg hover:bg-gray-100 transition-colors\"\n-          onClick={() => router.push(\"/contact\")}\n-        >\n-          <FiMessageCircle size={24} />\n-        </button>\n-      </motion.div>\n     </div>\n   );\n }\n"
                },
                {
                    "date": 1749703750448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n import Image from \"next/image\";\n import { FiMessageCircle } from \"react-icons/fi\";\n+import Head from 'next/head';\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n \n@@ -32,21 +33,39 @@\n           const activeBanners = Array.isArray(data)\n             ? data.filter(b => b && b.imageUrl && b.isActive)\n             : [];\n \n-          // Phân loại banner dựa vào kích thước ảnh\n-          const processedBanners = await Promise.all(activeBanners.map(async (banner) => {\n+          // Chỉ xử lý banner đầu tiên ngay lập tức\n+          if (activeBanners.length > 0) {\n+            const firstBanner = activeBanners[0];\n             const isMobile = await new Promise((resolve) => {\n               const img = new window.Image();\n               img.onload = () => {\n                 resolve(img.height > img.width);\n               };\n-              img.src = banner.imageUrl;\n+              img.src = firstBanner.imageUrl;\n             });\n-            return { ...banner, isMobile };\n-          }));\n+            setBanners([{ ...firstBanner, isMobile }]);\n \n-          setBanners(processedBanners);\n+            // Xử lý các banner còn lại sau\n+            if (activeBanners.length > 1) {\n+              setTimeout(async () => {\n+                const remainingBanners = await Promise.all(\n+                  activeBanners.slice(1).map(async (banner) => {\n+                    const isMobile = await new Promise((resolve) => {\n+                      const img = new window.Image();\n+                      img.onload = () => {\n+                        resolve(img.height > img.width);\n+                      };\n+                      img.src = banner.imageUrl;\n+                    });\n+                    return { ...banner, isMobile };\n+                  })\n+                );\n+                setBanners(prev => [...prev, ...remainingBanners]);\n+              }, 1000);\n+            }\n+          }\n         }\n       } catch (error) {\n         if (!ignore) setBanners([]);\n       }\n@@ -123,17 +142,18 @@\n             src={banner.imageUrl}\n             alt={banner.title || `Banner ${idx + 1}`}\n             fill\n             className=\"object-cover\"\n-            priority\n+            priority={idx === 0}\n             sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-            quality={98}\n-            loading=\"eager\"\n+            quality={idx === 0 ? 98 : 75}\n+            loading={idx === 0 ? \"eager\" : \"lazy\"}\n             placeholder=\"blur\"\n             blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n             style={{\n               objectFit: 'cover',\n               objectPosition: 'center',\n+              willChange: 'transform',\n             }}\n             onError={(e) => {\n               e.target.src = DEFAULT_BANNER_IMAGE;\n             }}\n"
                },
                {
                    "date": 1749703760801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,21 @@\n     ? 4 * t * t * t\n     : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n }\n \n+// Thêm debounce function\n+function debounce(func, wait) {\n+  let timeout;\n+  return function executedFunction(...args) {\n+    const later = () => {\n+      clearTimeout(timeout);\n+      func(...args);\n+    };\n+    clearTimeout(timeout);\n+    timeout = setTimeout(later, wait);\n+  };\n+}\n+\n export default function Home() {\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n@@ -91,11 +104,11 @@\n   const filteredBanners = useMemo(() => {\n     return banners.filter(banner => banner.isMobile === isMobileDevice);\n   }, [banners, isMobileDevice]);\n \n-  // Scroll handler\n+  // Tối ưu scroll handler\n   const handleScroll = useCallback(\n-    (e) => {\n+    debounce((e) => {\n       if (filteredBanners.length < 2) return;\n       const scrollY = window.scrollY;\n       const winH = window.innerHeight;\n       const imageIdx = Math.floor(scrollY / winH);\n@@ -104,25 +117,30 @@\n       if (isScrolling) return;\n       const delta = Math.sign(e.deltaY);\n       const newIdx = Math.max(0, Math.min(filteredBanners.length - 1, imageIdx + delta));\n       if (newIdx === currentImage) return;\n-        setIsScrolling(true);\n+      setIsScrolling(true);\n       setCurrentImage(newIdx);\n       const start = scrollY;\n       const end = newIdx * winH;\n-        const startTime = performance.now();\n+      const startTime = performance.now();\n+\n       function animateScroll(now) {\n         const elapsed = now - startTime;\n         const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n-        window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n-          if (progress < 1) {\n-            requestAnimationFrame(animateScroll);\n-          } else {\n-            setIsScrolling(false);\n-          }\n+        // Sử dụng transform thay vì scrollTo\n+        const translateY = start + (end - start) * easeInOutCubic(progress);\n+        document.body.style.transform = `translateY(-${translateY}px)`;\n+        if (progress < 1) {\n+          requestAnimationFrame(animateScroll);\n+        } else {\n+          setIsScrolling(false);\n+          document.body.style.transform = '';\n+          window.scrollTo(0, end);\n+        }\n       }\n       requestAnimationFrame(animateScroll);\n-    },\n+    }, 16), // 60fps\n     [filteredBanners.length, currentImage, isScrolling]\n   );\n \n   useEffect(() => {\n"
                },
                {
                    "date": 1749703778446,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n import { motion } from \"framer-motion\";\n import Image from \"next/image\";\n import { FiMessageCircle } from \"react-icons/fi\";\n import Head from 'next/head';\n+import React from \"react\";\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n \n@@ -27,8 +28,46 @@\n     timeout = setTimeout(later, wait);\n   };\n }\n \n+const LoadingSkeleton = () => (\n+  <div className=\"animate-pulse\">\n+    <div className=\"h-screen bg-gray-200\"></div>\n+  </div>\n+);\n+\n+const BannerItem = React.memo(({ banner, idx, isFirst }) => (\n+  <div\n+    key={banner._id || idx}\n+    className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n+  >\n+    <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+      <Image\n+        src={banner.imageUrl}\n+        alt={banner.title || `Banner ${idx + 1}`}\n+        fill\n+        className=\"object-cover\"\n+        priority={isFirst}\n+        sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n+        quality={isFirst ? 98 : 75}\n+        loading={isFirst ? \"eager\" : \"lazy\"}\n+        placeholder=\"blur\"\n+        blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n+        style={{\n+          objectFit: 'cover',\n+          objectPosition: 'center',\n+          willChange: 'transform',\n+        }}\n+        onError={(e) => {\n+          e.target.src = DEFAULT_BANNER_IMAGE;\n+        }}\n+      />\n+    </div>\n+  </div>\n+));\n+\n+BannerItem.displayName = 'BannerItem';\n+\n export default function Home() {\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n@@ -150,61 +189,20 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return filteredBanners.map((banner, idx) => (\n-      <div\n+      <BannerItem\n         key={banner._id || idx}\n-        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-      >\n-        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-          <Image\n-            src={banner.imageUrl}\n-            alt={banner.title || `Banner ${idx + 1}`}\n-            fill\n-            className=\"object-cover\"\n-            priority={idx === 0}\n-            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-            quality={idx === 0 ? 98 : 75}\n-            loading={idx === 0 ? \"eager\" : \"lazy\"}\n-            placeholder=\"blur\"\n-            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n-            style={{\n-              objectFit: 'cover',\n-              objectPosition: 'center',\n-              willChange: 'transform',\n-            }}\n-            onError={(e) => {\n-              e.target.src = DEFAULT_BANNER_IMAGE;\n-            }}\n-          />\n-        </div>\n-      </div>\n+        banner={banner}\n+        idx={idx}\n+        isFirst={idx === 0}\n+      />\n     ));\n   }, [filteredBanners]);\n \n   // Render fallback if no banners\n   if (!filteredBanners.length) {\n-    return (\n-      <div className=\"h-screen flex items-center justify-center overflow-hidden\">\n-        <div className=\"relative w-full h-full\">\n-          <Image\n-            src={DEFAULT_BANNER_IMAGE}\n-            alt=\"Default Banner\"\n-            fill\n-            className=\"object-cover\"\n-            priority\n-            quality={98}\n-            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-            placeholder=\"blur\"\n-            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n-            style={{\n-              objectFit: 'cover',\n-              objectPosition: 'center',\n-            }}\n-          />\n-        </div>\n-      </div>\n-    );\n+    return <LoadingSkeleton />;\n   }\n \n   return (\n     <div className=\"relative w-full bg-black overflow-hidden\">\n"
                },
                {
                    "date": 1749703955454,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -189,14 +189,35 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return filteredBanners.map((banner, idx) => (\n-      <BannerItem\n+      <div\n         key={banner._id || idx}\n-        banner={banner}\n-        idx={idx}\n-        isFirst={idx === 0}\n-      />\n+        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n+      >\n+        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n+          <Image\n+            src={banner.imageUrl}\n+            alt={banner.title || `Banner ${idx + 1}`}\n+            fill\n+            className=\"object-cover\"\n+            priority={idx === 0}\n+            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n+            quality={idx === 0 ? 98 : 75}\n+            loading={idx === 0 ? \"eager\" : \"lazy\"}\n+            placeholder=\"blur\"\n+            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n+            style={{\n+              objectFit: 'cover',\n+              objectPosition: 'center',\n+              willChange: 'transform',\n+            }}\n+            onError={(e) => {\n+              e.target.src = DEFAULT_BANNER_IMAGE;\n+            }}\n+          />\n+        </div>\n+      </div>\n     ));\n   }, [filteredBanners]);\n \n   // Render fallback if no banners\n"
                },
                {
                    "date": 1749704036610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n     <div className=\"h-screen bg-gray-200\"></div>\n   </div>\n );\n \n-const BannerItem = React.memo(({ banner, idx, isFirst }) => (\n+const BannerItem = React.memo(({ banner, idx }) => (\n   <div\n     key={banner._id || idx}\n     className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n   >\n@@ -45,12 +45,12 @@\n         src={banner.imageUrl}\n         alt={banner.title || `Banner ${idx + 1}`}\n         fill\n         className=\"object-cover\"\n-        priority={isFirst}\n+        priority\n         sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-        quality={isFirst ? 98 : 75}\n-        loading={isFirst ? \"eager\" : \"lazy\"}\n+        quality={98}\n+        loading=\"eager\"\n         placeholder=\"blur\"\n         blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n         style={{\n           objectFit: 'cover',\n@@ -85,39 +85,21 @@\n           const activeBanners = Array.isArray(data)\n             ? data.filter(b => b && b.imageUrl && b.isActive)\n             : [];\n \n-          // Chỉ xử lý banner đầu tiên ngay lập tức\n-          if (activeBanners.length > 0) {\n-            const firstBanner = activeBanners[0];\n+          // Phân loại banner dựa vào kích thước ảnh\n+          const processedBanners = await Promise.all(activeBanners.map(async (banner) => {\n             const isMobile = await new Promise((resolve) => {\n               const img = new window.Image();\n               img.onload = () => {\n                 resolve(img.height > img.width);\n               };\n-              img.src = firstBanner.imageUrl;\n+              img.src = banner.imageUrl;\n             });\n-            setBanners([{ ...firstBanner, isMobile }]);\n+            return { ...banner, isMobile };\n+          }));\n \n-            // Xử lý các banner còn lại sau\n-            if (activeBanners.length > 1) {\n-              setTimeout(async () => {\n-                const remainingBanners = await Promise.all(\n-                  activeBanners.slice(1).map(async (banner) => {\n-                    const isMobile = await new Promise((resolve) => {\n-                      const img = new window.Image();\n-                      img.onload = () => {\n-                        resolve(img.height > img.width);\n-                      };\n-                      img.src = banner.imageUrl;\n-                    });\n-                    return { ...banner, isMobile };\n-                  })\n-                );\n-                setBanners(prev => [...prev, ...remainingBanners]);\n-              }, 1000);\n-            }\n-          }\n+          setBanners(processedBanners);\n         }\n       } catch (error) {\n         if (!ignore) setBanners([]);\n       }\n@@ -143,11 +125,11 @@\n   const filteredBanners = useMemo(() => {\n     return banners.filter(banner => banner.isMobile === isMobileDevice);\n   }, [banners, isMobileDevice]);\n \n-  // Tối ưu scroll handler\n+  // Scroll handler\n   const handleScroll = useCallback(\n-    debounce((e) => {\n+    (e) => {\n       if (filteredBanners.length < 2) return;\n       const scrollY = window.scrollY;\n       const winH = window.innerHeight;\n       const imageIdx = Math.floor(scrollY / winH);\n@@ -161,25 +143,20 @@\n       setCurrentImage(newIdx);\n       const start = scrollY;\n       const end = newIdx * winH;\n       const startTime = performance.now();\n-\n       function animateScroll(now) {\n         const elapsed = now - startTime;\n         const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n-        // Sử dụng transform thay vì scrollTo\n-        const translateY = start + (end - start) * easeInOutCubic(progress);\n-        document.body.style.transform = `translateY(-${translateY}px)`;\n+        window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n         if (progress < 1) {\n           requestAnimationFrame(animateScroll);\n         } else {\n           setIsScrolling(false);\n-          document.body.style.transform = '';\n-          window.scrollTo(0, end);\n         }\n       }\n       requestAnimationFrame(animateScroll);\n-    }, 16), // 60fps\n+    },\n     [filteredBanners.length, currentImage, isScrolling]\n   );\n \n   useEffect(() => {\n@@ -189,35 +166,13 @@\n \n   // Memoize banner items to prevent unnecessary re-renders\n   const bannerItems = useMemo(() => {\n     return filteredBanners.map((banner, idx) => (\n-      <div\n+      <BannerItem\n         key={banner._id || idx}\n-        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-      >\n-        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-          <Image\n-            src={banner.imageUrl}\n-            alt={banner.title || `Banner ${idx + 1}`}\n-            fill\n-            className=\"object-cover\"\n-            priority={idx === 0}\n-            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-            quality={idx === 0 ? 98 : 75}\n-            loading={idx === 0 ? \"eager\" : \"lazy\"}\n-            placeholder=\"blur\"\n-            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n-            style={{\n-              objectFit: 'cover',\n-              objectPosition: 'center',\n-              willChange: 'transform',\n-            }}\n-            onError={(e) => {\n-              e.target.src = DEFAULT_BANNER_IMAGE;\n-            }}\n-          />\n-        </div>\n-      </div>\n+        banner={banner}\n+        idx={idx}\n+      />\n     ));\n   }, [filteredBanners]);\n \n   // Render fallback if no banners\n"
                },
                {
                    "date": 1749704508083,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,10 +3,10 @@\n import { useRouter } from \"next/navigation\";\n import { motion } from \"framer-motion\";\n import Image from \"next/image\";\n import { FiMessageCircle } from \"react-icons/fi\";\n+import React from \"react\";\n import Head from 'next/head';\n-import React from \"react\";\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n \n@@ -29,10 +29,12 @@\n   };\n }\n \n const LoadingSkeleton = () => (\n-  <div className=\"animate-pulse\">\n-    <div className=\"h-screen bg-gray-200\"></div>\n+  <div className=\"w-full h-screen bg-gradient-to-b from-gray-900 to-black animate-pulse\">\n+    <div className=\"w-full h-full flex items-center justify-center\">\n+      <div className=\"w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin\"></div>\n+    </div>\n   </div>\n );\n \n const BannerItem = React.memo(({ banner, idx }) => (\n@@ -70,15 +72,49 @@\n export default function Home() {\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n+  const [isLoading, setIsLoading] = useState(true);\n   const router = useRouter();\n \n+  // Preload images\n+  useEffect(() => {\n+    const preloadImages = async (urls) => {\n+      const promises = urls.map(url => {\n+        return new Promise((resolve, reject) => {\n+          const img = new Image();\n+          img.src = url;\n+          img.onload = resolve;\n+          img.onerror = reject;\n+        });\n+      });\n+      await Promise.all(promises);\n+    };\n+\n+    const preloadBannerImages = async () => {\n+      try {\n+        const response = await fetch(\"/api/banners\");\n+        const data = await response.json();\n+        if (Array.isArray(data)) {\n+          const activeBanners = data.filter(b => b && b.imageUrl && b.isActive);\n+          if (activeBanners.length > 0) {\n+            await preloadImages(activeBanners.map(b => b.imageUrl));\n+          }\n+        }\n+      } catch (error) {\n+        console.error('Error preloading images:', error);\n+      }\n+    };\n+\n+    preloadBannerImages();\n+  }, []);\n+\n   // Fetch banners only once\n   useEffect(() => {\n     let ignore = false;\n     async function fetchBanners() {\n       try {\n+        setIsLoading(true);\n         const response = await fetch(\"/api/banners\");\n         const data = await response.json();\n         if (!ignore) {\n           // Lọc banner active và phân loại desktop/mobile\n@@ -98,11 +134,15 @@\n             return { ...banner, isMobile };\n           }));\n \n           setBanners(processedBanners);\n+          setIsLoading(false);\n         }\n       } catch (error) {\n-        if (!ignore) setBanners([]);\n+        if (!ignore) {\n+          setBanners([]);\n+          setIsLoading(false);\n+        }\n       }\n     }\n     fetchBanners();\n     return () => {\n@@ -174,32 +214,49 @@\n       />\n     ));\n   }, [filteredBanners]);\n \n+  // Render loading skeleton if loading\n+  if (isLoading) {\n+    return <LoadingSkeleton />;\n+  }\n+\n   // Render fallback if no banners\n   if (!filteredBanners.length) {\n     return <LoadingSkeleton />;\n   }\n \n   return (\n-    <div className=\"relative w-full bg-black overflow-hidden\">\n-      <div className=\"flex flex-col\">\n-        {bannerItems}\n-      </div>\n+    <>\n+      <Head>\n+        {filteredBanners.map((banner, idx) => (\n+          <link\n+            key={banner._id || idx}\n+            rel=\"preload\"\n+            href={banner.imageUrl}\n+            as=\"image\"\n+          />\n+        ))}\n+      </Head>\n+      <div className=\"relative w-full bg-black overflow-hidden\">\n+        <div className=\"flex flex-col\">\n+          {bannerItems}\n+        </div>\n \n-      {/* SHOP NOW text */}\n-      <motion.div\n-        initial={{ opacity: 0, y: 20 }}\n-        animate={{ opacity: 1, y: 0 }}\n-        whileHover={{ scale: 1.05 }}\n-        className=\"fixed top-24 left-8 z-20\"\n-      >\n-        <button\n-          onClick={() => router.push(\"/products\")}\n-          className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n+        {/* SHOP NOW text */}\n+        <motion.div\n+          initial={{ opacity: 0, y: 20 }}\n+          animate={{ opacity: 1, y: 0 }}\n+          whileHover={{ scale: 1.05 }}\n+          className=\"fixed top-24 left-8 z-20\"\n         >\n-          SHOP NOW\n-        </button>\n-      </motion.div>\n-    </div>\n+          <button\n+            onClick={() => router.push(\"/products\")}\n+            className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n+          >\n+            SHOP NOW\n+          </button>\n+        </motion.div>\n+      </div>\n+    </>\n   );\n }\n"
                },
                {
                    "date": 1749704760874,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,10 @@\n import Head from 'next/head';\n \n const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n const SCROLL_ANIMATION_DURATION = 700;\n+const CACHE_KEY = 'banner_cache';\n+const CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours\n \n function easeInOutCubic(t) {\n   return t < 0.5\n     ? 4 * t * t * t\n@@ -72,58 +74,35 @@\n export default function Home() {\n   const [currentImage, setCurrentImage] = useState(0);\n   const [banners, setBanners] = useState([]);\n   const [isScrolling, setIsScrolling] = useState(false);\n-  const [isLoading, setIsLoading] = useState(true);\n   const router = useRouter();\n \n-  // Preload images\n+  // Load banners from cache or API\n   useEffect(() => {\n-    const preloadImages = async (urls) => {\n-      const promises = urls.map(url => {\n-        return new Promise((resolve, reject) => {\n-          const img = new Image();\n-          img.src = url;\n-          img.onload = resolve;\n-          img.onerror = reject;\n-        });\n-      });\n-      await Promise.all(promises);\n-    };\n+    let ignore = false;\n \n-    const preloadBannerImages = async () => {\n+    const loadBanners = async () => {\n       try {\n-        const response = await fetch(\"/api/banners\");\n-        const data = await response.json();\n-        if (Array.isArray(data)) {\n-          const activeBanners = data.filter(b => b && b.imageUrl && b.isActive);\n-          if (activeBanners.length > 0) {\n-            await preloadImages(activeBanners.map(b => b.imageUrl));\n+        // Try to load from cache first\n+        const cachedData = localStorage.getItem(CACHE_KEY);\n+        if (cachedData) {\n+          const { data, timestamp } = JSON.parse(cachedData);\n+          if (Date.now() - timestamp < CACHE_EXPIRY) {\n+            if (!ignore) {\n+              setBanners(data);\n+            }\n           }\n         }\n-      } catch (error) {\n-        console.error('Error preloading images:', error);\n-      }\n-    };\n \n-    preloadBannerImages();\n-  }, []);\n-\n-  // Fetch banners only once\n-  useEffect(() => {\n-    let ignore = false;\n-    async function fetchBanners() {\n-      try {\n-        setIsLoading(true);\n+        // Fetch fresh data from API\n         const response = await fetch(\"/api/banners\");\n         const data = await response.json();\n-        if (!ignore) {\n-          // Lọc banner active và phân loại desktop/mobile\n-          const activeBanners = Array.isArray(data)\n-            ? data.filter(b => b && b.imageUrl && b.isActive)\n-            : [];\n-\n-          // Phân loại banner dựa vào kích thước ảnh\n+        \n+        if (!ignore && Array.isArray(data)) {\n+          const activeBanners = data.filter(b => b && b.imageUrl && b.isActive);\n+          \n+          // Process banners\n           const processedBanners = await Promise.all(activeBanners.map(async (banner) => {\n             const isMobile = await new Promise((resolve) => {\n               const img = new window.Image();\n               img.onload = () => {\n@@ -133,24 +112,48 @@\n             });\n             return { ...banner, isMobile };\n           }));\n \n+          // Update state and cache\n           setBanners(processedBanners);\n-          setIsLoading(false);\n+          localStorage.setItem(CACHE_KEY, JSON.stringify({\n+            data: processedBanners,\n+            timestamp: Date.now()\n+          }));\n         }\n       } catch (error) {\n+        console.error('Error loading banners:', error);\n         if (!ignore) {\n           setBanners([]);\n-          setIsLoading(false);\n         }\n       }\n-    }\n-    fetchBanners();\n+    };\n+\n+    loadBanners();\n     return () => {\n       ignore = true;\n     };\n   }, []);\n \n+  // Preload images\n+  useEffect(() => {\n+    const preloadImages = async (urls) => {\n+      const promises = urls.map(url => {\n+        return new Promise((resolve, reject) => {\n+          const img = new Image();\n+          img.src = url;\n+          img.onload = resolve;\n+          img.onerror = reject;\n+        });\n+      });\n+      await Promise.all(promises);\n+    };\n+\n+    if (banners.length > 0) {\n+      preloadImages(banners.map(b => b.imageUrl));\n+    }\n+  }, [banners]);\n+\n   // Kiểm tra thiết bị\n   const [isMobileDevice, setIsMobileDevice] = useState(false);\n   useEffect(() => {\n     const checkMobile = () => {\n@@ -214,18 +217,8 @@\n       />\n     ));\n   }, [filteredBanners]);\n \n-  // Render loading skeleton if loading\n-  if (isLoading) {\n-    return <LoadingSkeleton />;\n-  }\n-\n-  // Render fallback if no banners\n-  if (!filteredBanners.length) {\n-    return <LoadingSkeleton />;\n-  }\n-\n   return (\n     <>\n       <Head>\n         {filteredBanners.map((banner, idx) => (\n"
                },
                {
                    "date": 1750479119007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,255 +1,1 @@\n-\"use client\";\n-import { useState, useEffect, useCallback, useMemo } from \"react\";\n-import { useRouter } from \"next/navigation\";\n-import { motion } from \"framer-motion\";\n-import Image from \"next/image\";\n-import { FiMessageCircle } from \"react-icons/fi\";\n-import React from \"react\";\n-import Head from 'next/head';\n-\n-const DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\n-const SCROLL_ANIMATION_DURATION = 700;\n-const CACHE_KEY = 'banner_cache';\n-const CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours\n-\n-function easeInOutCubic(t) {\n-  return t < 0.5\n-    ? 4 * t * t * t\n-    : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n-}\n-\n-// Thêm debounce function\n-function debounce(func, wait) {\n-  let timeout;\n-  return function executedFunction(...args) {\n-    const later = () => {\n-      clearTimeout(timeout);\n-      func(...args);\n-    };\n-    clearTimeout(timeout);\n-    timeout = setTimeout(later, wait);\n-  };\n-}\n-\n-const LoadingSkeleton = () => (\n-  <div className=\"w-full h-screen bg-gradient-to-b from-gray-900 to-black animate-pulse\">\n-    <div className=\"w-full h-full flex items-center justify-center\">\n-      <div className=\"w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin\"></div>\n-    </div>\n-  </div>\n-);\n-\n-const BannerItem = React.memo(({ banner, idx }) => (\n-  <div\n-    key={banner._id || idx}\n-    className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n-  >\n-    <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n-      <Image\n-        src={banner.imageUrl}\n-        alt={banner.title || `Banner ${idx + 1}`}\n-        fill\n-        className=\"object-cover\"\n-        priority\n-        sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n-        quality={98}\n-        loading=\"eager\"\n-        placeholder=\"blur\"\n-        blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n-        style={{\n-          objectFit: 'cover',\n-          objectPosition: 'center',\n-          willChange: 'transform',\n-        }}\n-        onError={(e) => {\n-          e.target.src = DEFAULT_BANNER_IMAGE;\n-        }}\n-      />\n-    </div>\n-  </div>\n-));\n-\n-BannerItem.displayName = 'BannerItem';\n-\n-export default function Home() {\n-  const [currentImage, setCurrentImage] = useState(0);\n-  const [banners, setBanners] = useState([]);\n-  const [isScrolling, setIsScrolling] = useState(false);\n-  const router = useRouter();\n-\n-  // Load banners from cache or API\n-  useEffect(() => {\n-    let ignore = false;\n-\n-    const loadBanners = async () => {\n-      try {\n-        // Try to load from cache first\n-        const cachedData = localStorage.getItem(CACHE_KEY);\n-        if (cachedData) {\n-          const { data, timestamp } = JSON.parse(cachedData);\n-          if (Date.now() - timestamp < CACHE_EXPIRY) {\n-            if (!ignore) {\n-              setBanners(data);\n-            }\n-          }\n-        }\n-\n-        // Fetch fresh data from API\n-        const response = await fetch(\"/api/banners\");\n-        const data = await response.json();\n-        \n-        if (!ignore && Array.isArray(data)) {\n-          const activeBanners = data.filter(b => b && b.imageUrl && b.isActive);\n-          \n-          // Process banners\n-          const processedBanners = await Promise.all(activeBanners.map(async (banner) => {\n-            const isMobile = await new Promise((resolve) => {\n-              const img = new window.Image();\n-              img.onload = () => {\n-                resolve(img.height > img.width);\n-              };\n-              img.src = banner.imageUrl;\n-            });\n-            return { ...banner, isMobile };\n-          }));\n-\n-          // Update state and cache\n-          setBanners(processedBanners);\n-          localStorage.setItem(CACHE_KEY, JSON.stringify({\n-            data: processedBanners,\n-            timestamp: Date.now()\n-          }));\n-        }\n-      } catch (error) {\n-        console.error('Error loading banners:', error);\n-        if (!ignore) {\n-          setBanners([]);\n-        }\n-      }\n-    };\n-\n-    loadBanners();\n-    return () => {\n-      ignore = true;\n-    };\n-  }, []);\n-\n-  // Preload images\n-  useEffect(() => {\n-    const preloadImages = async (urls) => {\n-      const promises = urls.map(url => {\n-        return new Promise((resolve, reject) => {\n-          const img = new Image();\n-          img.src = url;\n-          img.onload = resolve;\n-          img.onerror = reject;\n-        });\n-      });\n-      await Promise.all(promises);\n-    };\n-\n-    if (banners.length > 0) {\n-      preloadImages(banners.map(b => b.imageUrl));\n-    }\n-  }, [banners]);\n-\n-  // Kiểm tra thiết bị\n-  const [isMobileDevice, setIsMobileDevice] = useState(false);\n-  useEffect(() => {\n-    const checkMobile = () => {\n-      setIsMobileDevice(window.innerWidth < 768);\n-    };\n-    checkMobile();\n-    window.addEventListener('resize', checkMobile);\n-    return () => window.removeEventListener('resize', checkMobile);\n-  }, []);\n-\n-  // Lọc banner theo thiết bị\n-  const filteredBanners = useMemo(() => {\n-    return banners.filter(banner => banner.isMobile === isMobileDevice);\n-  }, [banners, isMobileDevice]);\n-\n-  // Scroll handler\n-  const handleScroll = useCallback(\n-    (e) => {\n-      if (filteredBanners.length < 2) return;\n-      const scrollY = window.scrollY;\n-      const winH = window.innerHeight;\n-      const imageIdx = Math.floor(scrollY / winH);\n-      if (imageIdx === filteredBanners.length - 1 && e.deltaY > 0) return;\n-      e.preventDefault();\n-      if (isScrolling) return;\n-      const delta = Math.sign(e.deltaY);\n-      const newIdx = Math.max(0, Math.min(filteredBanners.length - 1, imageIdx + delta));\n-      if (newIdx === currentImage) return;\n-      setIsScrolling(true);\n-      setCurrentImage(newIdx);\n-      const start = scrollY;\n-      const end = newIdx * winH;\n-      const startTime = performance.now();\n-      function animateScroll(now) {\n-        const elapsed = now - startTime;\n-        const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n-        window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n-        if (progress < 1) {\n-          requestAnimationFrame(animateScroll);\n-        } else {\n-          setIsScrolling(false);\n-        }\n-      }\n-      requestAnimationFrame(animateScroll);\n-    },\n-    [filteredBanners.length, currentImage, isScrolling]\n-  );\n-\n-  useEffect(() => {\n-    window.addEventListener(\"wheel\", handleScroll, { passive: false });\n-    return () => window.removeEventListener(\"wheel\", handleScroll);\n-  }, [handleScroll]);\n-\n-  // Memoize banner items to prevent unnecessary re-renders\n-  const bannerItems = useMemo(() => {\n-    return filteredBanners.map((banner, idx) => (\n-      <BannerItem\n-        key={banner._id || idx}\n-        banner={banner}\n-        idx={idx}\n-      />\n-    ));\n-  }, [filteredBanners]);\n-\n-  return (\n-    <>\n-      <Head>\n-        {filteredBanners.map((banner, idx) => (\n-          <link\n-            key={banner._id || idx}\n-            rel=\"preload\"\n-            href={banner.imageUrl}\n-            as=\"image\"\n-          />\n-        ))}\n-      </Head>\n-      <div className=\"relative w-full bg-black overflow-hidden\">\n-        <div className=\"flex flex-col\">\n-          {bannerItems}\n-        </div>\n-\n-        {/* SHOP NOW text */}\n-        <motion.div\n-          initial={{ opacity: 0, y: 20 }}\n-          animate={{ opacity: 1, y: 0 }}\n-          whileHover={{ scale: 1.05 }}\n-          className=\"fixed top-24 left-8 z-20\"\n-        >\n-          <button\n-            onClick={() => router.push(\"/products\")}\n-            className=\"bg-white text-black px-4 py-1.5 md:px-6 md:py-2 text-xs md:text-sm font-semibold hover:bg-black hover:text-white transition-all duration-300\"\n-          >\n-            SHOP NOW\n-          </button>\n-        </motion.div>\n-      </div>\n-    </>\n-  );\n-}\n+ \n\\ No newline at end of file\n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "\"use client\";\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { motion } from \"framer-motion\";\nimport Image from \"next/image\";\nimport { FiMessageCircle } from \"react-icons/fi\";\n\nconst DEFAULT_BANNER_IMAGE = \"/images/image1.jpg\";\nconst SCROLL_ANIMATION_DURATION = 700;\n\nfunction easeInOutCubic(t) {\n  return t < 0.5\n    ? 4 * t * t * t\n    : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n}\n\nexport default function Home() {\n  const [currentImage, setCurrentImage] = useState(0);\n  const [banners, setBanners] = useState([]);\n  const [isScrolling, setIsScrolling] = useState(false);\n  const router = useRouter();\n\n  // Fetch banners only once\n  useEffect(() => {\n    let ignore = false;\n    async function fetchBanners() {\n      try {\n        const response = await fetch(\"/api/banners\");\n        const data = await response.json();\n        if (!ignore) {\n          setBanners(\n            Array.isArray(data)\n              ? data.filter(b => b && b.imageUrl && b.isActive)\n              : []\n          );\n        }\n      } catch (error) {\n        if (!ignore) setBanners([]);\n      }\n    }\n    fetchBanners();\n    return () => {\n      ignore = true;\n    };\n  }, []);\n\n  // Scroll handler\n  const handleScroll = useCallback(\n    (e) => {\n      if (banners.length < 2) return;\n      const scrollY = window.scrollY;\n      const winH = window.innerHeight;\n      const imageIdx = Math.floor(scrollY / winH);\n      if (imageIdx === banners.length - 1 && e.deltaY > 0) return;\n      e.preventDefault();\n      if (isScrolling) return;\n      const delta = Math.sign(e.deltaY);\n      const newIdx = Math.max(0, Math.min(banners.length - 1, imageIdx + delta));\n      if (newIdx === currentImage) return;\n      setIsScrolling(true);\n      setCurrentImage(newIdx);\n      const start = scrollY;\n      const end = newIdx * winH;\n      const startTime = performance.now();\n      function animateScroll(now) {\n        const elapsed = now - startTime;\n        const progress = Math.min(elapsed / SCROLL_ANIMATION_DURATION, 1);\n        window.scrollTo(0, start + (end - start) * easeInOutCubic(progress));\n        if (progress < 1) {\n          requestAnimationFrame(animateScroll);\n        } else {\n          setIsScrolling(false);\n        }\n      }\n      requestAnimationFrame(animateScroll);\n    },\n    [banners.length, currentImage, isScrolling]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"wheel\", handleScroll, { passive: false });\n    return () => window.removeEventListener(\"wheel\", handleScroll);\n  }, [handleScroll]);\n\n  // Memoize banner items to prevent unnecessary re-renders\n  const bannerItems = useMemo(() => {\n    return banners.map((banner, idx) => (\n      <div\n        key={banner._id || idx}\n        className=\"relative w-full h-screen flex items-center justify-center m-0 p-0 overflow-hidden\"\n      >\n        <div className=\"relative w-full h-full flex items-center justify-center bg-black m-0 p-0\">\n          <Image\n            src={banner.imageUrl}\n            alt={banner.title || `Banner ${idx + 1}`}\n            fill\n            className=\"object-cover\"\n            priority\n            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n            quality={98}\n            loading=\"eager\"\n            placeholder=\"blur\"\n            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n            style={{\n              objectFit: 'cover',\n              objectPosition: 'center',\n            }}\n            onError={(e) => {\n              e.target.src = DEFAULT_BANNER_IMAGE;\n            }}\n          />\n        </div>\n      </div>\n    ));\n  }, [banners]);\n\n  // Render fallback if no banners\n  if (!banners.length) {\n    return (\n      <div className=\"h-screen flex items-center justify-center overflow-hidden\">\n        <div className=\"relative w-full h-full\">\n          <Image\n            src={DEFAULT_BANNER_IMAGE}\n            alt=\"Default Banner\"\n            fill\n            className=\"object-cover\"\n            priority\n            quality={98}\n            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw\"\n            placeholder=\"blur\"\n            blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQdHx4eHRoaHSQtJSEkMjU1LS0yMi4qLjg0PjU4Ojo7OjU4Ojo7Ojo7Ojo7Ojo7Ojo7Ojv/2wBDAR4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=\"\n            style={{\n              objectFit: 'cover',\n              objectPosition: 'center',\n            }}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative w-full bg-black overflow-hidden\">\n      <div className=\"flex flex-col\">\n        {bannerItems}\n      </div>\n\n      {/* SHOP NOW text */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        whileHover={{ scale: 1.05 }}\n        className=\"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-10\"\n      >\n        <button\n          onClick={() => router.push(\"/products\")}\n          className=\"bg-white text-black px-8 py-3 rounded-full text-lg font-semibold hover:bg-gray-100 transition-colors\"\n        >\n          SHOP NOW\n        </button>\n      </motion.div>\n\n      {/* Chat button */}\n      <motion.div\n        initial={{ opacity: 0, x: 20 }}\n        animate={{ opacity: 1, x: 0 }}\n        whileHover={{ scale: 1.1 }}\n        className=\"fixed bottom-8 right-8 z-50\"\n      >\n        <button\n          className=\"bg-white text-black p-4 rounded-full shadow-lg hover:bg-gray-100 transition-colors\"\n          onClick={() => router.push(\"/contact\")}\n        >\n          <FiMessageCircle size={24} />\n        </button>\n      </motion.div>\n    </div>\n  );\n}\n"
        }
    ]
}