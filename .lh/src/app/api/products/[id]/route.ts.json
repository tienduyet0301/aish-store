{
    "sourceFile": "src/app/api/products/[id]/route.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1746893160195,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747457109772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import { NextResponse } from \"next/server\";\r\n-import clientPromise from \"@/lib/mongodb\";\r\n+import { connectToDatabase } from \"@/lib/mongodb\";\r\n import { ObjectId } from \"mongodb\";\r\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n@@ -10,37 +10,25 @@\n   request: Request,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n-    const client = await clientPromise;\r\n-    const db = client.db(\"aishh\");\r\n-    const { id } = params;\r\n-\r\n+    const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(id) });\r\n+      .findOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n-        { ok: false, error: \"Product not found\" },\r\n+        { error: \"Product not found\" },\r\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    return NextResponse.json({\r\n-      ok: true,\r\n-      product: {\r\n-        ...product,\r\n-        _id: product._id.toString(),\r\n-        images: product.images?.map((url: string) => \r\n-          url.startsWith('http') ? url : `${DOMAIN}${url}`\r\n-        ) || []\r\n-      }\r\n-    });\r\n+    return NextResponse.json(product);\r\n   } catch (error) {\r\n     console.error(\"Error fetching product:\", error);\r\n     return NextResponse.json(\r\n-      { ok: false, error: \"Failed to fetch product\" },\r\n+      { error: \"Internal Server Error\" },\r\n       { status: 500 }\r\n     );\r\n   }\r\n }\r\n"
                },
                {
                    "date": 1747457119685,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,74 +38,29 @@\n   request: Request,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n-    const client = await clientPromise;\r\n-    const db = client.db(\"aishh\");\r\n-    const product = await request.json();\r\n-    const { id } = params;\r\n+    const { db } = await connectToDatabase();\r\n+    const body = await request.json();\r\n \r\n-    // Chuyển đổi các trường số\r\n-    const updatedProduct = {\r\n-      name: product.name,\r\n-      price: Number(product.price),\r\n-      description: product.description,\r\n-      images: product.images,\r\n-      quantityM: Number(product.quantityM),\r\n-      quantityL: Number(product.quantityL),\r\n-      quantityXL: Number(product.quantityXL),\r\n-      quantityHat: Number(product.quantityHat),\r\n-      productCode: product.productCode,\r\n-      details: product.details,\r\n-      category: product.category,\r\n-      collection: product.collection,\r\n-      colors: product.colors || [],\r\n-      updatedAt: new Date().toISOString()\r\n-    };\r\n+    const result = await db.collection(\"products\").updateOne(\r\n+      { _id: new ObjectId(params.id) },\r\n+      { $set: body }\r\n+    );\r\n \r\n-    const result = await db\r\n-      .collection(\"products\")\r\n-      .updateOne(\r\n-        { _id: new ObjectId(id) },\r\n-        { $set: updatedProduct }\r\n-      );\r\n-\r\n     if (result.matchedCount === 0) {\r\n       return NextResponse.json(\r\n-        { ok: false, error: \"Product not found\" },\r\n+        { error: \"Product not found\" },\r\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    // Lấy sản phẩm đã cập nhật\r\n-    const updatedProductData = await db\r\n-      .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(id) });\r\n-\r\n-    if (!updatedProductData) {\r\n-      return NextResponse.json(\r\n-        { ok: false, error: \"Failed to fetch updated product\" },\r\n-        { status: 500 }\r\n-      );\r\n-    }\r\n-\r\n-    revalidatePath(\"/products\");\r\n-    revalidatePath(\"/admin/products\");\r\n-\r\n-    return NextResponse.json({ \r\n-      ok: true,\r\n-      product: {\r\n-        ...updatedProductData,\r\n-        _id: updatedProductData._id.toString(),\r\n-        images: updatedProductData.images?.map((url: string) => \r\n-          url.startsWith('http') ? url : `${DOMAIN}${url}`\r\n-        ) || []\r\n-      }\r\n-    });\r\n+    revalidatePath(`/products/${params.id}`);\r\n+    return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n-      { ok: false, error: \"Failed to update product\" },\r\n+      { error: \"Internal Server Error\" },\r\n       { status: 500 }\r\n     );\r\n   }\r\n }\r\n@@ -115,31 +70,26 @@\n   request: Request,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n-    const client = await clientPromise;\r\n-    const db = client.db(\"aishh\");\r\n-    const { id } = params;\r\n-\r\n+    const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(id) });\r\n+      .deleteOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n-        { ok: false, error: \"Product not found\" },\r\n+        { error: \"Product not found\" },\r\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n     revalidatePath(\"/products\");\r\n-    revalidatePath(\"/admin/products\");\r\n-\r\n-    return NextResponse.json({ ok: true });\r\n+    return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error deleting product:\", error);\r\n     return NextResponse.json(\r\n-      { ok: false, error: \"Failed to delete product\" },\r\n+      { error: \"Internal Server Error\" },\r\n       { status: 500 }\r\n     );\r\n   }\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1747457295849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,21 +1,21 @@\n-import { NextResponse } from \"next/server\";\r\n+import { NextRequest, NextResponse } from \"next/server\";\r\n import { connectToDatabase } from \"@/lib/mongodb\";\r\n import { ObjectId } from \"mongodb\";\r\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n // GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\n export async function GET(\r\n-  request: Request,\r\n-  { params }: { params: { id: string } }\r\n+  req: NextRequest,\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(params.id) });\r\n+      .findOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -34,17 +34,17 @@\n }\r\n \r\n // PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\n export async function PUT(\r\n-  request: Request,\r\n-  { params }: { params: { id: string } }\r\n+  req: NextRequest,\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n-    const body = await request.json();\r\n+    const body = await req.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(params.id) },\r\n+      { _id: new ObjectId(context.params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -53,9 +53,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${params.id}`);\r\n+    revalidatePath(`/products/${context.params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -66,16 +66,16 @@\n }\r\n \r\n // DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\n export async function DELETE(\r\n-  request: Request,\r\n-  { params }: { params: { id: string } }\r\n+  req: NextRequest,\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(params.id) });\r\n+      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747457427439,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,18 +4,24 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n+type RouteContext = {\r\n+  params: {\r\n+    id: string;\r\n+  };\r\n+};\r\n+\r\n // GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\n export async function GET(\r\n-  req: NextRequest,\r\n-  context: { params: { id: string } }\r\n-) {\r\n+  request: NextRequest,\r\n+  { params }: RouteContext\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(context.params.id) });\r\n+      .findOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -34,17 +40,17 @@\n }\r\n \r\n // PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\n export async function PUT(\r\n-  req: NextRequest,\r\n-  context: { params: { id: string } }\r\n-) {\r\n+  request: NextRequest,\r\n+  { params }: RouteContext\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n-    const body = await req.json();\r\n+    const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(context.params.id) },\r\n+      { _id: new ObjectId(params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -53,9 +59,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${context.params.id}`);\r\n+    revalidatePath(`/products/${params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -66,16 +72,16 @@\n }\r\n \r\n // DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\n export async function DELETE(\r\n-  req: NextRequest,\r\n-  context: { params: { id: string } }\r\n-) {\r\n+  request: NextRequest,\r\n+  { params }: RouteContext\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n+      .deleteOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747457690303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,18 +4,12 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n-type RouteContext = {\r\n-  params: {\r\n-    id: string;\r\n-  };\r\n-};\r\n-\r\n // GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\n export async function GET(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n@@ -41,9 +35,9 @@\n \r\n // PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\n export async function PUT(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n@@ -73,9 +67,9 @@\n \r\n // DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n"
                },
                {
                    "date": 1747457938478,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,18 +4,24 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n+type RouteSegmentProps = {\r\n+  params: {\r\n+    id: string;\r\n+  };\r\n+};\r\n+\r\n // GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\n export async function GET(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  props: RouteSegmentProps\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(params.id) });\r\n+      .findOne({ _id: new ObjectId(props.params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -35,16 +41,16 @@\n \r\n // PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\n export async function PUT(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  props: RouteSegmentProps\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(params.id) },\r\n+      { _id: new ObjectId(props.params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -53,9 +59,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${params.id}`);\r\n+    revalidatePath(`/products/${props.params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -67,15 +73,15 @@\n \r\n // DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  props: RouteSegmentProps\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(params.id) });\r\n+      .deleteOne({ _id: new ObjectId(props.params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747458176625,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,24 +4,17 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n-type RouteSegmentProps = {\r\n-  params: {\r\n-    id: string;\r\n-  };\r\n-};\r\n-\r\n-// GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\n export async function GET(\r\n   request: NextRequest,\r\n-  props: RouteSegmentProps\r\n-): Promise<NextResponse> {\r\n+  { params }: { params: { id: string } }\r\n+) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(props.params.id) });\r\n+      .findOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -38,19 +31,18 @@\n     );\r\n   }\r\n }\r\n \r\n-// PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\n export async function PUT(\r\n   request: NextRequest,\r\n-  props: RouteSegmentProps\r\n-): Promise<NextResponse> {\r\n+  { params }: { params: { id: string } }\r\n+) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(props.params.id) },\r\n+      { _id: new ObjectId(params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -59,9 +51,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${props.params.id}`);\r\n+    revalidatePath(`/products/${params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -70,18 +62,17 @@\n     );\r\n   }\r\n }\r\n \r\n-// DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  props: RouteSegmentProps\r\n-): Promise<NextResponse> {\r\n+  { params }: { params: { id: string } }\r\n+) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(props.params.id) });\r\n+      .deleteOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747462940273,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,15 +6,15 @@\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n export async function GET(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(params.id) });\r\n+      .findOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -33,16 +33,16 @@\n }\r\n \r\n export async function PUT(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(params.id) },\r\n+      { _id: new ObjectId(context.params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -51,9 +51,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${params.id}`);\r\n+    revalidatePath(`/products/${context.params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -64,15 +64,15 @@\n }\r\n \r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(params.id) });\r\n+      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747463114198,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,17 +4,23 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n+type RouteContext = {\r\n+  params: {\r\n+    id: string;\r\n+  };\r\n+};\r\n+\r\n export async function GET(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: RouteContext\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(context.params.id) });\r\n+      .findOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -33,16 +39,16 @@\n }\r\n \r\n export async function PUT(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: RouteContext\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(context.params.id) },\r\n+      { _id: new ObjectId(params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -51,9 +57,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${context.params.id}`);\r\n+    revalidatePath(`/products/${params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -64,15 +70,15 @@\n }\r\n \r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: RouteContext\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n+      .deleteOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747468139010,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,17 +4,11 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n-type RouteContext = {\r\n-  params: {\r\n-    id: string;\r\n-  };\r\n-};\r\n-\r\n export async function GET(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n@@ -39,9 +33,9 @@\n }\r\n \r\n export async function PUT(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n@@ -70,9 +64,9 @@\n }\r\n \r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  { params }: RouteContext\r\n+  { params }: { params: { id: string } }\r\n ) {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n"
                },
                {
                    "date": 1747468351757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n+// @ts-ignore\r\n export async function GET(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n@@ -31,8 +32,9 @@\n     );\r\n   }\r\n }\r\n \r\n+// @ts-ignore\r\n export async function PUT(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n@@ -62,8 +64,9 @@\n     );\r\n   }\r\n }\r\n \r\n+// @ts-ignore\r\n export async function DELETE(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n ) {\r\n"
                },
                {
                    "date": 1747468517975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,13 +4,12 @@\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n-// @ts-ignore\r\n export async function GET(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n-) {\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n@@ -32,13 +31,12 @@\n     );\r\n   }\r\n }\r\n \r\n-// @ts-ignore\r\n export async function PUT(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n-) {\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n@@ -64,13 +62,12 @@\n     );\r\n   }\r\n }\r\n \r\n-// @ts-ignore\r\n export async function DELETE(\r\n   request: NextRequest,\r\n   { params }: { params: { id: string } }\r\n-) {\r\n+): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n"
                },
                {
                    "date": 1747468649060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,15 +6,15 @@\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n export async function GET(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(params.id) });\r\n+      .findOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -33,16 +33,16 @@\n }\r\n \r\n export async function PUT(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(params.id) },\r\n+      { _id: new ObjectId(context.params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -51,9 +51,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${params.id}`);\r\n+    revalidatePath(`/products/${context.params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -64,15 +64,15 @@\n }\r\n \r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  { params }: { params: { id: string } }\r\n+  context: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(params.id) });\r\n+      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747469455215,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,15 +6,15 @@\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n export async function GET(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const product = await db\r\n       .collection(\"products\")\r\n-      .findOne({ _id: new ObjectId(context.params.id) });\r\n+      .findOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (!product) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n@@ -33,16 +33,16 @@\n }\r\n \r\n export async function PUT(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const body = await request.json();\r\n \r\n     const result = await db.collection(\"products\").updateOne(\r\n-      { _id: new ObjectId(context.params.id) },\r\n+      { _id: new ObjectId(params.id) },\r\n       { $set: body }\r\n     );\r\n \r\n     if (result.matchedCount === 0) {\r\n@@ -51,9 +51,9 @@\n         { status: 404 }\r\n       );\r\n     }\r\n \r\n-    revalidatePath(`/products/${context.params.id}`);\r\n+    revalidatePath(`/products/${params.id}`);\r\n     return NextResponse.json({ success: true });\r\n   } catch (error) {\r\n     console.error(\"Error updating product:\", error);\r\n     return NextResponse.json(\r\n@@ -64,15 +64,15 @@\n }\r\n \r\n export async function DELETE(\r\n   request: NextRequest,\r\n-  context: { params: { id: string } }\r\n+  { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n     const result = await db\r\n       .collection(\"products\")\r\n-      .deleteOne({ _id: new ObjectId(context.params.id) });\r\n+      .deleteOne({ _id: new ObjectId(params.id) });\r\n \r\n     if (result.deletedCount === 0) {\r\n       return NextResponse.json(\r\n         { error: \"Product not found\" },\r\n"
                },
                {
                    "date": 1747626943649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n-import { NextRequest, NextResponse } from \"next/server\";\r\n+import { NextResponse } from \"next/server\";\r\n import { connectToDatabase } from \"@/lib/mongodb\";\r\n import { ObjectId } from \"mongodb\";\r\n import { revalidatePath } from \"next/cache\";\r\n \r\n const DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n \r\n export async function GET(\r\n-  request: NextRequest,\r\n+  request: Request,\r\n   { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n@@ -32,9 +32,9 @@\n   }\r\n }\r\n \r\n export async function PUT(\r\n-  request: NextRequest,\r\n+  request: Request,\r\n   { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n@@ -63,9 +63,9 @@\n   }\r\n }\r\n \r\n export async function DELETE(\r\n-  request: NextRequest,\r\n+  request: Request,\r\n   { params }: { params: { id: string } }\r\n ): Promise<NextResponse> {\r\n   try {\r\n     const { db } = await connectToDatabase();\r\n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "import { NextResponse } from \"next/server\";\r\nimport clientPromise from \"@/lib/mongodb\";\r\nimport { ObjectId } from \"mongodb\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nconst DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\r\n\r\n// GET /api/products/[id] - Lấy thông tin sản phẩm theo ID\r\nexport async function GET(\r\n  request: Request,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  try {\r\n    const client = await clientPromise;\r\n    const db = client.db(\"aishh\");\r\n    const { id } = params;\r\n\r\n    const product = await db\r\n      .collection(\"products\")\r\n      .findOne({ _id: new ObjectId(id) });\r\n\r\n    if (!product) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Product not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      ok: true,\r\n      product: {\r\n        ...product,\r\n        _id: product._id.toString(),\r\n        images: product.images?.map((url: string) => \r\n          url.startsWith('http') ? url : `${DOMAIN}${url}`\r\n        ) || []\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching product:\", error);\r\n    return NextResponse.json(\r\n      { ok: false, error: \"Failed to fetch product\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PUT /api/products/[id] - Cập nhật sản phẩm theo ID\r\nexport async function PUT(\r\n  request: Request,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  try {\r\n    const client = await clientPromise;\r\n    const db = client.db(\"aishh\");\r\n    const product = await request.json();\r\n    const { id } = params;\r\n\r\n    // Chuyển đổi các trường số\r\n    const updatedProduct = {\r\n      name: product.name,\r\n      price: Number(product.price),\r\n      description: product.description,\r\n      images: product.images,\r\n      quantityM: Number(product.quantityM),\r\n      quantityL: Number(product.quantityL),\r\n      quantityXL: Number(product.quantityXL),\r\n      quantityHat: Number(product.quantityHat),\r\n      productCode: product.productCode,\r\n      details: product.details,\r\n      category: product.category,\r\n      collection: product.collection,\r\n      colors: product.colors || [],\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n\r\n    const result = await db\r\n      .collection(\"products\")\r\n      .updateOne(\r\n        { _id: new ObjectId(id) },\r\n        { $set: updatedProduct }\r\n      );\r\n\r\n    if (result.matchedCount === 0) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Product not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Lấy sản phẩm đã cập nhật\r\n    const updatedProductData = await db\r\n      .collection(\"products\")\r\n      .findOne({ _id: new ObjectId(id) });\r\n\r\n    if (!updatedProductData) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Failed to fetch updated product\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    revalidatePath(\"/products\");\r\n    revalidatePath(\"/admin/products\");\r\n\r\n    return NextResponse.json({ \r\n      ok: true,\r\n      product: {\r\n        ...updatedProductData,\r\n        _id: updatedProductData._id.toString(),\r\n        images: updatedProductData.images?.map((url: string) => \r\n          url.startsWith('http') ? url : `${DOMAIN}${url}`\r\n        ) || []\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error updating product:\", error);\r\n    return NextResponse.json(\r\n      { ok: false, error: \"Failed to update product\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// DELETE /api/products/[id] - Xóa sản phẩm theo ID\r\nexport async function DELETE(\r\n  request: Request,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  try {\r\n    const client = await clientPromise;\r\n    const db = client.db(\"aishh\");\r\n    const { id } = params;\r\n\r\n    const result = await db\r\n      .collection(\"products\")\r\n      .deleteOne({ _id: new ObjectId(id) });\r\n\r\n    if (result.deletedCount === 0) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Product not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    revalidatePath(\"/products\");\r\n    revalidatePath(\"/admin/products\");\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (error) {\r\n    console.error(\"Error deleting product:\", error);\r\n    return NextResponse.json(\r\n      { ok: false, error: \"Failed to delete product\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n} "
        }
    ]
}