{
    "sourceFile": "src/app/admin/notifications/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746893158757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface PromoCode {\r\n  id: string;\r\n  code: string;\r\n  amount: number;\r\n  isActive: boolean;\r\n}\r\n\r\nexport default function NotificationsAdmin() {\r\n  const [announcement, setAnnouncement] = useState(\"\");\r\n  const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n  const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n  const [newPromoCode, setNewPromoCode] = useState(\"\");\r\n  const [newPromoAmount, setNewPromoAmount] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    fetchNotifications();\r\n  }, []);\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\");\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setAnnouncement(data.announcement);\r\n        setIsAnnouncementActive(data.isAnnouncementActive);\r\n        setPromoCodes(data.promoCodes || []);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching notifications:\", error);\r\n    }\r\n  };\r\n\r\n  const handleAnnouncementSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"announcement\",\r\n          content: announcement,\r\n          isActive: isAnnouncementActive,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Thông báo đã được cập nhật!\");\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating announcement:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi cập nhật thông báo\");\r\n    }\r\n  };\r\n\r\n  const handleAddPromoCode = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    console.log(\"Adding promo code:\", { newPromoCode, newPromoAmount });\r\n\r\n    if (!newPromoCode || !newPromoAmount) {\r\n      setMessage(\"Vui lòng nhập đầy đủ thông tin mã giảm giá\");\r\n      return;\r\n    }\r\n\r\n    // Chuyển đổi chuỗi số tiền thành số\r\n    const amount = parseInt(newPromoAmount.replace(/[^0-9]/g, ''));\r\n    console.log(\"Parsed amount:\", amount);\r\n\r\n    if (isNaN(amount) || amount <= 0) {\r\n      setMessage(\"Số tiền giảm giá không hợp lệ\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"add\",\r\n          code: newPromoCode.trim(),\r\n          amount: Number(amount), // Đảm bảo gửi số\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      console.log(\"API Response:\", data);\r\n\r\n      if (data.ok) {\r\n        setMessage(\"Mã giảm giá đã được thêm!\");\r\n        setNewPromoCode(\"\");\r\n        setNewPromoAmount(\"\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      } else {\r\n        setMessage(data.error || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  const handleTogglePromoCode = async (id: string, isActive: boolean) => {\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"toggle\",\r\n          id,\r\n          isActive,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Trạng thái mã giảm giá đã được cập nhật!\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error toggling promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi cập nhật trạng thái mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  const handleDeletePromoCode = async (id: string) => {\r\n    if (!confirm(\"Bạn có chắc chắn muốn xóa mã giảm giá này?\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"delete\",\r\n          id,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Mã giảm giá đã được xóa!\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi xóa mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white\">\r\n      <div className=\"w-full\">\r\n        <div className=\"border-b border-gray-200\">\r\n          <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n        </div>\r\n\r\n        {message && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n          >\r\n            {message}\r\n          </motion.div>\r\n        )}\r\n\r\n        <div className=\"p-8\">\r\n          <div className=\"border border-gray-200 mb-6\">\r\n            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n              <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <form onSubmit={handleAnnouncementSubmit}>\r\n                <div className=\"mb-4\">\r\n                  <textarea\r\n                    value={announcement}\r\n                    onChange={(e) => setAnnouncement(e.target.value)}\r\n                    className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                    rows={3}\r\n                    placeholder=\"Nhập nội dung thông báo...\"\r\n                  />\r\n                </div>\r\n                <div className=\"mb-4\">\r\n                  <label className=\"flex items-center text-sm\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={isAnnouncementActive}\r\n                      onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n                      className=\"form-checkbox h-4 w-4 text-black\"\r\n                    />\r\n                    <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n                  </label>\r\n                </div>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                >\r\n                  Cập nhật thông báo\r\n                </button>\r\n              </form>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"border border-gray-200\">\r\n            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n              <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                  <div>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={newPromoCode}\r\n                      onChange={(e) => setNewPromoCode(e.target.value)}\r\n                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                      placeholder=\"Nhập mã giảm giá...\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={newPromoAmount}\r\n                      onChange={(e) => setNewPromoAmount(e.target.value)}\r\n                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                      placeholder=\"Nhập số tiền giảm (VD: 100.000đ)\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                >\r\n                  Thêm mã giảm giá\r\n                </button>\r\n              </form>\r\n\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-gray-200\">\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Số tiền giảm</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Thao tác</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {promoCodes.map((promo) => (\r\n                      <tr key={promo.id} className=\"border-b border-gray-100\">\r\n                        <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n                        <td className=\"py-2 px-4 text-sm text-black\">{promo.amount.toLocaleString()}đ</td>\r\n                        <td className=\"py-2 px-4\">\r\n                          <label className=\"flex items-center\">\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              checked={promo.isActive}\r\n                              onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n                              className=\"form-checkbox h-4 w-4 text-black\"\r\n                            />\r\n                            <span className=\"ml-2 text-sm text-black\">\r\n                              {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n                            </span>\r\n                          </label>\r\n                        </td>\r\n                        <td className=\"py-2 px-4\">\r\n                          <button\r\n                            onClick={() => handleDeletePromoCode(promo.id)}\r\n                            className=\"text-sm text-red-600 hover:text-red-800\"\r\n                          >\r\n                            Xóa\r\n                          </button>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "
        }
    ]
}