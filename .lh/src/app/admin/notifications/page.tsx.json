{
    "sourceFile": "src/app/admin/notifications/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 12,
            "patches": [
                {
                    "date": 1746893158757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748618828143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,18 +4,31 @@\n \r\n interface PromoCode {\r\n   id: string;\r\n   code: string;\r\n-  amount: number;\r\n+  amount?: number; // amount có thể không tồn tại nếu type là percentage\r\n   isActive: boolean;\r\n+  type: 'fixed' | 'percentage'; // Thêm loại giảm giá\r\n+  value: number; // Số tiền hoặc phần trăm\r\n+  maxAmount?: number; // Giới hạn tối đa cho percentage\r\n+  isLoginRequired?: boolean; // Yêu cầu đăng nhập\r\n+  perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n+  usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n+  expiryDate?: string; // Ngày hết hạn\r\n+  usedCount?: number; // Tổng số lần đã dùng\r\n }\r\n \r\n export default function NotificationsAdmin() {\r\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n   const [newPromoCode, setNewPromoCode] = useState(\"\");\r\n-  const [newPromoAmount, setNewPromoAmount] = useState(\"\");\r\n+  const [newPromoType, setNewPromoType] = useState<'fixed' | 'percentage'>('fixed'); // State cho loại giảm giá\r\n+  const [newPromoValue, setNewPromoValue] = useState(\"\"); // State cho giá trị (tiền hoặc %) - dùng string để dễ nhập liệu\r\n+  const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\"); // State cho giới hạn tối đa\r\n+  const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false); // State yêu cầu đăng nhập\r\n+  const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\"); // State giới hạn mỗi người dùng\r\n+  const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\"); // State ngày hết hạn\r\n   const [message, setMessage] = useState(\"\");\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n@@ -25,14 +38,40 @@\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\");\r\n       const data = await response.json();\r\n       if (data.ok) {\r\n-        setAnnouncement(data.announcement);\r\n-        setIsAnnouncementActive(data.isAnnouncementActive);\r\n-        setPromoCodes(data.promoCodes || []);\r\n+        // Filter out announcement and only set promo codes\r\n+        const fetchedPromoCodes = data.notifications.filter((notif: any) => notif.type === 'promo');\r\n+        const announcementNotif = data.notifications.find((notif: any) => notif.type === 'announcement');\r\n+\r\n+        if(announcementNotif) {\r\n+           setAnnouncement(announcementNotif.content);\r\n+           setIsAnnouncementActive(announcementNotif.isActive);\r\n+        }\r\n+\r\n+        // Map data to match PromoCode interface\r\n+        const formattedPromoCodes: PromoCode[] = fetchedPromoCodes.map((code: any) => ({\r\n+          id: code._id.toString(),\r\n+          code: code.code,\r\n+          type: code.type || 'fixed', // Default to fixed if type is missing\r\n+          value: code.value !== undefined ? code.value : code.amount, // Use value if available, fallback to amount\r\n+          amount: code.amount, // Keep amount for backward compatibility if needed\r\n+          maxAmount: code.maxAmount,\r\n+          isActive: code.isActive,\r\n+          isLoginRequired: code.isLoginRequired || false,\r\n+          perUserLimit: code.perUserLimit || 0,\r\n+          usedByUsers: code.usedByUsers || [],\r\n+          expiryDate: code.expiryDate,\r\n+          usedCount: code.usedCount || 0,\r\n+        }));\r\n+        setPromoCodes(formattedPromoCodes);\r\n+\r\n+      } else {\r\n+         setMessage(data.message || \"Failed to fetch notifications\");\r\n       }\r\n     } catch (error) {\r\n       console.error(\"Error fetching notifications:\", error);\r\n+      setMessage(\"Có lỗi xảy ra khi lấy dữ liệu thông báo và mã giảm giá\");\r\n     }\r\n   };\r\n \r\n   const handleAnnouncementSubmit = async (e: React.FormEvent) => {\r\n@@ -62,24 +101,39 @@\n   };\r\n \r\n   const handleAddPromoCode = async (e: React.FormEvent) => {\r\n     e.preventDefault();\r\n-    console.log(\"Adding promo code:\", { newPromoCode, newPromoAmount });\r\n+    console.log(\"Adding promo code:\", { newPromoCode, newPromoType, newPromoValue, newPromoMaxAmount, newPromoIsLoginRequired, newPromoPerUserLimit, newPromoExpiryDate });\r\n \r\n-    if (!newPromoCode || !newPromoAmount) {\r\n-      setMessage(\"Vui lòng nhập đầy đủ thông tin mã giảm giá\");\r\n+    if (!newPromoCode.trim() || !newPromoValue.trim()) {\r\n+      setMessage(\"Vui lòng nhập đầy đủ mã và giá trị giảm giá\");\r\n       return;\r\n     }\r\n \r\n-    // Chuyển đổi chuỗi số tiền thành số\r\n-    const amount = parseInt(newPromoAmount.replace(/[^0-9]/g, ''));\r\n-    console.log(\"Parsed amount:\", amount);\r\n+    const promoValueNumeric = parseFloat(newPromoValue.replace(/[^0-9.-]+/g, ''));\r\n \r\n-    if (isNaN(amount) || amount <= 0) {\r\n-      setMessage(\"Số tiền giảm giá không hợp lệ\");\r\n-      return;\r\n+    if (isNaN(promoValueNumeric) || promoValueNumeric <= 0) {\r\n+        setMessage(newPromoType === 'fixed' ? \"Số tiền giảm giá không hợp lệ\" : \"Phần trăm giảm giá không hợp lệ\");\r\n+        return;\r\n     }\r\n \r\n+    let promoMaxAmountNumeric: number | undefined = undefined;\r\n+    if (newPromoType === 'percentage' && newPromoMaxAmount.trim()) {\r\n+        promoMaxAmountNumeric = parseFloat(newPromoMaxAmount.replace(/[^0-9.-]+/g, ''));\r\n+        if (isNaN(promoMaxAmountNumeric) || promoMaxAmountNumeric < 0) {\r\n+            setMessage(\"Giới hạn tối đa không hợp lệ\");\r\n+            return;\r\n+        }\r\n+    }\r\n+\r\n+    const promoPerUserLimitNumeric = parseInt(newPromoPerUserLimit.trim());\r\n+    if (newPromoPerUserLimit.trim() && (isNaN(promoPerUserLimitNumeric) || promoPerUserLimitNumeric < 0)) {\r\n+         setMessage(\"Giới hạn sử dụng mỗi người dùng không hợp lệ\");\r\n+         return;\r\n+    }\r\n+\r\n+    const promoExpiryDateValue = newPromoExpiryDate ? new Date(newPromoExpiryDate).toISOString() : undefined; // Lưu ISO string\r\n+\r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\", {\r\n         method: \"POST\",\r\n         headers: {\r\n@@ -87,10 +141,18 @@\n         },\r\n         body: JSON.stringify({\r\n           type: \"promo\",\r\n           action: \"add\",\r\n-          code: newPromoCode.trim(),\r\n-          amount: Number(amount), // Đảm bảo gửi số\r\n+          code: newPromoCode.trim().toUpperCase(), // Lưu mã code viết hoa\r\n+          promoType: newPromoType, // Gửi loại giảm giá\r\n+          promoValue: promoValueNumeric, // Gửi giá trị số\r\n+          promoMaxAmount: promoMaxAmountNumeric, // Gửi giới hạn tối đa\r\n+          isLoginRequired: newPromoIsLoginRequired, // Gửi yêu cầu đăng nhập\r\n+          perUserLimit: promoPerUserLimitNumeric || 0, // Gửi giới hạn mỗi người dùng (0 nếu trống/không hợp lệ)\r\n+          expiryDate: promoExpiryDateValue, // Gửi ngày hết hạn\r\n+          isActive: true, // Mặc định kích hoạt khi tạo mới\r\n+          usedByUsers: [], // Khởi tạo mảng rỗng\r\n+          usedCount: 0, // Khởi tạo số lần dùng là 0\r\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n@@ -98,9 +160,14 @@\n \r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được thêm!\");\r\n         setNewPromoCode(\"\");\r\n-        setNewPromoAmount(\"\");\r\n+        setNewPromoType('fixed');\r\n+        setNewPromoValue(\"\");\r\n+        setNewPromoMaxAmount(\"\");\r\n+        setNewPromoIsLoginRequired(false);\r\n+        setNewPromoPerUserLimit(\"\");\r\n+        setNewPromoExpiryDate(\"\");\r\n         fetchNotifications();\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n       } else {\r\n         setMessage(data.error || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n@@ -229,26 +296,92 @@\n             <div className=\"p-6\">\r\n               <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                   <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Mã giảm giá</label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoCode}\r\n                       onChange={(e) => setNewPromoCode(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"Nhập mã giảm giá...\"\r\n+                      placeholder=\"VD: NEWCODE20\"\r\n+                      required\r\n                     />\r\n                   </div>\r\n                   <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Loại giảm giá</label>\r\n+                    <select\r\n+                      value={newPromoType}\r\n+                      onChange={(e) => setNewPromoType(e.target.value as 'fixed' | 'percentage')}\r\n+                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                    >\r\n+                      <option value=\"fixed\">Giảm theo số tiền cố định</option>\r\n+                      <option value=\"percentage\">Giảm theo phần trăm (%)</option>\r\n+                    </select>\r\n+                  </div>\r\n+                </div>\r\n+\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                  <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Giá trị giảm giá ({newPromoType === 'fixed' ? 'VND' : '%'})</label>\r\n                     <input\r\n                       type=\"text\"\r\n-                      value={newPromoAmount}\r\n-                      onChange={(e) => setNewPromoAmount(e.target.value)}\r\n+                      value={newPromoValue}\r\n+                      onChange={(e) => setNewPromoValue(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"Nhập số tiền giảm (VD: 100.000đ)\"\r\n+                      placeholder={newPromoType === 'fixed' ? \"VD: 50000\" : \"VD: 20\"}\r\n+                      required\r\n                     />\r\n                   </div>\r\n+                  {newPromoType === 'percentage' && (\r\n+                    <div>\r\n+                       <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn tối đa (VND, tùy chọn)</label>\r\n+                       <input\r\n+                         type=\"text\"\r\n+                         value={newPromoMaxAmount}\r\n+                         onChange={(e) => setNewPromoMaxAmount(e.target.value)}\r\n+                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                         placeholder=\"VD: 100000\"\r\n+                       />\r\n+                    </div>\r\n+                  )}\r\n                 </div>\r\n+\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                   <div>\r\n+                      <label className=\"block text-sm font-medium text-black mb-1\">Ngày hết hạn (tùy chọn)</label>\r\n+                      <input\r\n+                        type=\"date\"\r\n+                        value={newPromoExpiryDate}\r\n+                        onChange={(e) => setNewPromoExpiryDate(e.target.value)}\r\n+                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                      />\r\n+                   </div>\r\n+                    <div>\r\n+                       <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn sử dụng mỗi người dùng (tùy chọn, 0 = không giới hạn)</label>\r\n+                       <input\r\n+                         type=\"number\"\r\n+                         value={newPromoPerUserLimit}\r\n+                         onChange={(e) => setNewPromoPerUserLimit(e.target.value)}\r\n+                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                         placeholder=\"VD: 1\"\r\n+                         min=\"0\"\r\n+                       />\r\n+                    </div>\r\n+                </div>\r\n+\r\n+                <div className=\"mb-4\">\r\n+                   <label className=\"flex items-center text-sm font-medium text-black\">\r\n+                     <input\r\n+                       type=\"checkbox\"\r\n+                       checked={newPromoIsLoginRequired}\r\n+                       onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n+                       className=\"form-checkbox h-4 w-4 text-black\"\r\n+                     />\r\n+                     <span className=\"ml-2\">Yêu cầu đăng nhập để sử dụng</span>\r\n+                   </label>\r\n+                </div>\r\n+\r\n                 <button\r\n                   type=\"submit\"\r\n                   className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                 >\r\n@@ -260,18 +393,30 @@\n                 <table className=\"min-w-full\">\r\n                   <thead>\r\n                     <tr className=\"border-b border-gray-200\">\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Số tiền giảm</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Tối đa</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu ĐN</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn mỗi users</th>\r\n+                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã dùng</th>\r\n+                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Thao tác</th>\r\n                     </tr>\r\n                   </thead>\r\n                   <tbody>\r\n                     {promoCodes.map((promo) => (\r\n                       <tr key={promo.id} className=\"border-b border-gray-100\">\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.amount.toLocaleString()}đ</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n+                         <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n+                         <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n                         <td className=\"py-2 px-4\">\r\n                           <label className=\"flex items-center\">\r\n                             <input\r\n                               type=\"checkbox\"\r\n"
                },
                {
                    "date": 1748618838049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -412,9 +412,9 @@\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n                          <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n                          <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n                         <td className=\"py-2 px-4\">\r\n                           <label className=\"flex items-center\">\r\n"
                },
                {
                    "date": 1748657832887,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,18 +42,22 @@\n         // Filter out announcement and only set promo codes\r\n         const fetchedPromoCodes = data.notifications.filter((notif: any) => notif.type === 'promo');\r\n         const announcementNotif = data.notifications.find((notif: any) => notif.type === 'announcement');\r\n \r\n-        if(announcementNotif) {\r\n-           setAnnouncement(announcementNotif.content);\r\n-           setIsAnnouncementActive(announcementNotif.isActive);\r\n+        if (announcementNotif) {\r\n+          setAnnouncement(announcementNotif.content || '');\r\n+          setIsAnnouncementActive(announcementNotif.isActive || false);\r\n+        } else {\r\n+          // Reset state if no announcement exists\r\n+          setAnnouncement('');\r\n+          setIsAnnouncementActive(false);\r\n         }\r\n \r\n         // Map data to match PromoCode interface\r\n         const formattedPromoCodes: PromoCode[] = fetchedPromoCodes.map((code: any) => ({\r\n           id: code._id.toString(),\r\n           code: code.code,\r\n-          type: code.type || 'fixed', // Default to fixed if type is missing\r\n+          type: code.promoType || 'fixed', // Use promoType instead of type\r\n           value: code.value !== undefined ? code.value : code.amount, // Use value if available, fallback to amount\r\n           amount: code.amount, // Keep amount for backward compatibility if needed\r\n           maxAmount: code.maxAmount,\r\n           isActive: code.isActive,\r\n@@ -63,11 +67,10 @@\n           expiryDate: code.expiryDate,\r\n           usedCount: code.usedCount || 0,\r\n         }));\r\n         setPromoCodes(formattedPromoCodes);\r\n-\r\n       } else {\r\n-         setMessage(data.message || \"Failed to fetch notifications\");\r\n+        setMessage(data.message || \"Failed to fetch notifications\");\r\n       }\r\n     } catch (error) {\r\n       console.error(\"Error fetching notifications:\", error);\r\n       setMessage(\"Có lỗi xảy ra khi lấy dữ liệu thông báo và mã giảm giá\");\r\n"
                },
                {
                    "date": 1749534484911,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,10 +14,18 @@\n   perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n   usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n   expiryDate?: string; // Ngày hết hạn\r\n   usedCount?: number; // Tổng số lần đã dùng\r\n+  scope: 'all' | 'selected';\r\n+  selectedProducts?: string[];\r\n }\r\n \r\n+interface Product {\r\n+  _id: string;\r\n+  name: string;\r\n+  price: number;\r\n+}\r\n+\r\n export default function NotificationsAdmin() {\r\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n@@ -27,14 +35,31 @@\n   const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\"); // State cho giới hạn tối đa\r\n   const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false); // State yêu cầu đăng nhập\r\n   const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\"); // State giới hạn mỗi người dùng\r\n   const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\"); // State ngày hết hạn\r\n+  const [newPromoScope, setNewPromoScope] = useState<'all' | 'selected'>('all');\r\n+  const [selectedProducts, setSelectedProducts] = useState<string[]>([]);\r\n+  const [products, setProducts] = useState<Product[]>([]);\r\n   const [message, setMessage] = useState(\"\");\r\n+  const [showProductSelector, setShowProductSelector] = useState(false);\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n+    fetchProducts();\r\n   }, []);\r\n \r\n+  const fetchProducts = async () => {\r\n+    try {\r\n+      const response = await fetch(\"/api/products\");\r\n+      const data = await response.json();\r\n+      if (data.ok) {\r\n+        setProducts(data.products);\r\n+      }\r\n+    } catch (error) {\r\n+      console.error(\"Error fetching products:\", error);\r\n+    }\r\n+  };\r\n+\r\n   const fetchNotifications = async () => {\r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\");\r\n       const data = await response.json();\r\n@@ -65,8 +90,10 @@\n           perUserLimit: code.perUserLimit || 0,\r\n           usedByUsers: code.usedByUsers || [],\r\n           expiryDate: code.expiryDate,\r\n           usedCount: code.usedCount || 0,\r\n+          scope: code.scope || 'all',\r\n+          selectedProducts: code.selectedProducts || [],\r\n         }));\r\n         setPromoCodes(formattedPromoCodes);\r\n       } else {\r\n         setMessage(data.message || \"Failed to fetch notifications\");\r\n@@ -104,38 +131,53 @@\n   };\r\n \r\n   const handleAddPromoCode = async (e: React.FormEvent) => {\r\n     e.preventDefault();\r\n-    console.log(\"Adding promo code:\", { newPromoCode, newPromoType, newPromoValue, newPromoMaxAmount, newPromoIsLoginRequired, newPromoPerUserLimit, newPromoExpiryDate });\r\n+    console.log(\"Adding promo code:\", { \r\n+      newPromoCode, \r\n+      newPromoType, \r\n+      newPromoValue, \r\n+      newPromoMaxAmount, \r\n+      newPromoIsLoginRequired, \r\n+      newPromoPerUserLimit, \r\n+      newPromoExpiryDate,\r\n+      newPromoScope,\r\n+      selectedProducts \r\n+    });\r\n \r\n     if (!newPromoCode.trim() || !newPromoValue.trim()) {\r\n       setMessage(\"Vui lòng nhập đầy đủ mã và giá trị giảm giá\");\r\n       return;\r\n     }\r\n \r\n+    if (newPromoScope === 'selected' && selectedProducts.length === 0) {\r\n+      setMessage(\"Vui lòng chọn ít nhất một sản phẩm\");\r\n+      return;\r\n+    }\r\n+\r\n     const promoValueNumeric = parseFloat(newPromoValue.replace(/[^0-9.-]+/g, ''));\r\n \r\n     if (isNaN(promoValueNumeric) || promoValueNumeric <= 0) {\r\n-        setMessage(newPromoType === 'fixed' ? \"Số tiền giảm giá không hợp lệ\" : \"Phần trăm giảm giá không hợp lệ\");\r\n-        return;\r\n+      setMessage(newPromoType === 'fixed' ? \"Số tiền giảm giá không hợp lệ\" : \"Phần trăm giảm giá không hợp lệ\");\r\n+      return;\r\n     }\r\n \r\n     let promoMaxAmountNumeric: number | undefined = undefined;\r\n     if (newPromoType === 'percentage' && newPromoMaxAmount.trim()) {\r\n-        promoMaxAmountNumeric = parseFloat(newPromoMaxAmount.replace(/[^0-9.-]+/g, ''));\r\n-        if (isNaN(promoMaxAmountNumeric) || promoMaxAmountNumeric < 0) {\r\n-            setMessage(\"Giới hạn tối đa không hợp lệ\");\r\n-            return;\r\n-        }\r\n+      promoMaxAmountNumeric = parseFloat(newPromoMaxAmount.replace(/[^0-9.-]+/g, ''));\r\n+      if (isNaN(promoMaxAmountNumeric) || promoMaxAmountNumeric < 0) {\r\n+        setMessage(\"Giới hạn tối đa không hợp lệ\");\r\n+        return;\r\n+      }\r\n     }\r\n \r\n     const promoPerUserLimitNumeric = parseInt(newPromoPerUserLimit.trim());\r\n     if (newPromoPerUserLimit.trim() && (isNaN(promoPerUserLimitNumeric) || promoPerUserLimitNumeric < 0)) {\r\n-         setMessage(\"Giới hạn sử dụng mỗi người dùng không hợp lệ\");\r\n-         return;\r\n+      setMessage(\"Giới hạn sử dụng mỗi người dùng không hợp lệ\");\r\n+      return;\r\n     }\r\n \r\n-    const promoExpiryDateValue = newPromoExpiryDate ? new Date(newPromoExpiryDate).toISOString() : undefined; // Lưu ISO string\r\n+    const promoExpiryDateValue = newPromoExpiryDate ? new Date(newPromoExpiryDate).toISOString() : undefined;\r\n \r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\", {\r\n         method: \"POST\",\r\n@@ -144,33 +186,31 @@\n         },\r\n         body: JSON.stringify({\r\n           type: \"promo\",\r\n           action: \"add\",\r\n-          code: newPromoCode.trim().toUpperCase(), // Lưu mã code viết hoa\r\n-          promoType: newPromoType, // Gửi loại giảm giá\r\n-          promoValue: promoValueNumeric, // Gửi giá trị số\r\n-          promoMaxAmount: promoMaxAmountNumeric, // Gửi giới hạn tối đa\r\n-          isLoginRequired: newPromoIsLoginRequired, // Gửi yêu cầu đăng nhập\r\n-          perUserLimit: promoPerUserLimitNumeric || 0, // Gửi giới hạn mỗi người dùng (0 nếu trống/không hợp lệ)\r\n-          expiryDate: promoExpiryDateValue, // Gửi ngày hết hạn\r\n-          isActive: true, // Mặc định kích hoạt khi tạo mới\r\n-          usedByUsers: [], // Khởi tạo mảng rỗng\r\n-          usedCount: 0, // Khởi tạo số lần dùng là 0\r\n+          code: newPromoCode.trim(),\r\n+          type: newPromoType,\r\n+          value: promoValueNumeric,\r\n+          maxAmount: promoMaxAmountNumeric,\r\n+          isLoginRequired: newPromoIsLoginRequired,\r\n+          perUserLimit: promoPerUserLimitNumeric || undefined,\r\n+          expiryDate: promoExpiryDateValue,\r\n+          scope: newPromoScope,\r\n+          selectedProducts: newPromoScope === 'selected' ? selectedProducts : undefined\r\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n-      console.log(\"API Response:\", data);\r\n-\r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được thêm!\");\r\n         setNewPromoCode(\"\");\r\n-        setNewPromoType('fixed');\r\n         setNewPromoValue(\"\");\r\n         setNewPromoMaxAmount(\"\");\r\n         setNewPromoIsLoginRequired(false);\r\n         setNewPromoPerUserLimit(\"\");\r\n         setNewPromoExpiryDate(\"\");\r\n+        setNewPromoScope('all');\r\n+        setSelectedProducts([]);\r\n         fetchNotifications();\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n       } else {\r\n         setMessage(data.error || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n@@ -324,65 +364,94 @@\n                 </div>\r\n \r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                   <div>\r\n-                    <label className=\"block text-sm font-medium text-black mb-1\">Giá trị giảm giá ({newPromoType === 'fixed' ? 'VND' : '%'})</label>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">\r\n+                      {newPromoType === 'fixed' ? 'Số tiền giảm' : 'Phần trăm giảm'}\r\n+                    </label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoValue}\r\n                       onChange={(e) => setNewPromoValue(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder={newPromoType === 'fixed' ? \"VD: 50000\" : \"VD: 20\"}\r\n+                      placeholder={newPromoType === 'fixed' ? \"VD: 100000\" : \"VD: 20\"}\r\n                       required\r\n                     />\r\n                   </div>\r\n                   {newPromoType === 'percentage' && (\r\n                     <div>\r\n-                       <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn tối đa (VND, tùy chọn)</label>\r\n-                       <input\r\n-                         type=\"text\"\r\n-                         value={newPromoMaxAmount}\r\n-                         onChange={(e) => setNewPromoMaxAmount(e.target.value)}\r\n-                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                         placeholder=\"VD: 100000\"\r\n-                       />\r\n+                      <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn tối đa</label>\r\n+                      <input\r\n+                        type=\"text\"\r\n+                        value={newPromoMaxAmount}\r\n+                        onChange={(e) => setNewPromoMaxAmount(e.target.value)}\r\n+                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                        placeholder=\"VD: 500000\"\r\n+                      />\r\n                     </div>\r\n                   )}\r\n                 </div>\r\n \r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n-                   <div>\r\n-                      <label className=\"block text-sm font-medium text-black mb-1\">Ngày hết hạn (tùy chọn)</label>\r\n-                      <input\r\n-                        type=\"date\"\r\n-                        value={newPromoExpiryDate}\r\n-                        onChange={(e) => setNewPromoExpiryDate(e.target.value)}\r\n-                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      />\r\n-                   </div>\r\n+                  <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Phạm vi áp dụng</label>\r\n+                    <select\r\n+                      value={newPromoScope}\r\n+                      onChange={(e) => setNewPromoScope(e.target.value as 'all' | 'selected')}\r\n+                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                    >\r\n+                      <option value=\"all\">Tất cả sản phẩm</option>\r\n+                      <option value=\"selected\">Chọn sản phẩm cụ thể</option>\r\n+                    </select>\r\n+                  </div>\r\n+                  {newPromoScope === 'selected' && (\r\n                     <div>\r\n-                       <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn sử dụng mỗi người dùng (tùy chọn, 0 = không giới hạn)</label>\r\n-                       <input\r\n-                         type=\"number\"\r\n-                         value={newPromoPerUserLimit}\r\n-                         onChange={(e) => setNewPromoPerUserLimit(e.target.value)}\r\n-                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                         placeholder=\"VD: 1\"\r\n-                         min=\"0\"\r\n-                       />\r\n+                      <button\r\n+                        type=\"button\"\r\n+                        onClick={() => setShowProductSelector(true)}\r\n+                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black hover:bg-gray-50\"\r\n+                      >\r\n+                        {selectedProducts.length > 0 \r\n+                          ? `Đã chọn ${selectedProducts.length} sản phẩm` \r\n+                          : \"Chọn sản phẩm\"}\r\n+                      </button>\r\n                     </div>\r\n+                  )}\r\n                 </div>\r\n \r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                  <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Ngày hết hạn</label>\r\n+                    <input\r\n+                      type=\"date\"\r\n+                      value={newPromoExpiryDate}\r\n+                      onChange={(e) => setNewPromoExpiryDate(e.target.value)}\r\n+                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                    />\r\n+                  </div>\r\n+                  <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Giới hạn sử dụng mỗi người</label>\r\n+                    <input\r\n+                      type=\"number\"\r\n+                      value={newPromoPerUserLimit}\r\n+                      onChange={(e) => setNewPromoPerUserLimit(e.target.value)}\r\n+                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                      placeholder=\"Để trống nếu không giới hạn\"\r\n+                      min=\"0\"\r\n+                    />\r\n+                  </div>\r\n+                </div>\r\n+\r\n                 <div className=\"mb-4\">\r\n-                   <label className=\"flex items-center text-sm font-medium text-black\">\r\n-                     <input\r\n-                       type=\"checkbox\"\r\n-                       checked={newPromoIsLoginRequired}\r\n-                       onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n-                       className=\"form-checkbox h-4 w-4 text-black\"\r\n-                     />\r\n-                     <span className=\"ml-2\">Yêu cầu đăng nhập để sử dụng</span>\r\n-                   </label>\r\n+                  <label className=\"flex items-center\">\r\n+                    <input\r\n+                      type=\"checkbox\"\r\n+                      checked={newPromoIsLoginRequired}\r\n+                      onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n+                      className=\"form-checkbox h-4 w-4 text-black\"\r\n+                    />\r\n+                    <span className=\"ml-2 text-sm text-black\">Yêu cầu đăng nhập để sử dụng</span>\r\n+                  </label>\r\n                 </div>\r\n \r\n                 <button\r\n                   type=\"submit\"\r\n@@ -391,22 +460,70 @@\n                   Thêm mã giảm giá\r\n                 </button>\r\n               </form>\r\n \r\n+              {/* Product Selector Modal */}\r\n+              {showProductSelector && (\r\n+                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n+                  <div className=\"bg-white p-6 rounded-lg max-w-2xl w-full mx-4\">\r\n+                    <div className=\"flex justify-between items-center mb-4\">\r\n+                      <h3 className=\"text-lg font-bold text-black\">Chọn sản phẩm</h3>\r\n+                      <button\r\n+                        onClick={() => setShowProductSelector(false)}\r\n+                        className=\"text-gray-500 hover:text-black\"\r\n+                      >\r\n+                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n+                        </svg>\r\n+                      </button>\r\n+                    </div>\r\n+                    <div className=\"max-h-96 overflow-y-auto mb-4\">\r\n+                      {products.map((product) => (\r\n+                        <label key={product._id} className=\"flex items-center p-2 hover:bg-gray-50\">\r\n+                          <input\r\n+                            type=\"checkbox\"\r\n+                            checked={selectedProducts.includes(product._id)}\r\n+                            onChange={(e) => {\r\n+                              if (e.target.checked) {\r\n+                                setSelectedProducts([...selectedProducts, product._id]);\r\n+                              } else {\r\n+                                setSelectedProducts(selectedProducts.filter(id => id !== product._id));\r\n+                              }\r\n+                            }}\r\n+                            className=\"form-checkbox h-4 w-4 text-black\"\r\n+                          />\r\n+                          <span className=\"ml-2 text-sm text-black\">\r\n+                            {product.name} - {product.price.toLocaleString('vi-VN')} VND\r\n+                          </span>\r\n+                        </label>\r\n+                      ))}\r\n+                    </div>\r\n+                    <div className=\"flex justify-end\">\r\n+                      <button\r\n+                        onClick={() => setShowProductSelector(false)}\r\n+                        className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n+                      >\r\n+                        Xong\r\n+                      </button>\r\n+                    </div>\r\n+                  </div>\r\n+                </div>\r\n+              )}\r\n+\r\n               <div className=\"overflow-x-auto\">\r\n                 <table className=\"min-w-full\">\r\n                   <thead>\r\n                     <tr className=\"border-b border-gray-200\">\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Tối đa</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu ĐN</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn mỗi users</th>\r\n-                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã dùng</th>\r\n-                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Phạm vi</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Thao tác</th>\r\n                     </tr>\r\n                   </thead>\r\n                   <tbody>\r\n                     {promoCodes.map((promo) => (\r\n@@ -416,10 +533,11 @@\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n-                         <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n-                         <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.scope === 'all' ? 'Tất cả' : 'Đã chọn'}</td>\r\n                         <td className=\"py-2 px-4\">\r\n                           <label className=\"flex items-center\">\r\n                             <input\r\n                               type=\"checkbox\"\r\n@@ -431,16 +549,8 @@\n                               {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n                             </span>\r\n                           </label>\r\n                         </td>\r\n-                        <td className=\"py-2 px-4\">\r\n-                          <button\r\n-                            onClick={() => handleDeletePromoCode(promo.id)}\r\n-                            className=\"text-sm text-red-600 hover:text-red-800\"\r\n-                          >\r\n-                            Xóa\r\n-                          </button>\r\n-                        </td>\r\n                       </tr>\r\n                     ))}\r\n                   </tbody>\r\n                 </table>\r\n"
                },
                {
                    "date": 1749534564982,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,9 +187,9 @@\n         body: JSON.stringify({\r\n           type: \"promo\",\r\n           action: \"add\",\r\n           code: newPromoCode.trim(),\r\n-          type: newPromoType,\r\n+          promoType: newPromoType,\r\n           value: promoValueNumeric,\r\n           maxAmount: promoMaxAmountNumeric,\r\n           isLoginRequired: newPromoIsLoginRequired,\r\n           perUserLimit: promoPerUserLimitNumeric || undefined,\r\n"
                },
                {
                    "date": 1749536151442,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,12 +62,14 @@\n   const fetchNotifications = async () => {\r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\");\r\n       const data = await response.json();\r\n+      console.log('Fetched notifications data:', data); // Debug log\r\n+\r\n       if (data.ok) {\r\n         // Filter out announcement and only set promo codes\r\n-        const fetchedPromoCodes = data.notifications.filter((notif: any) => notif.type === 'promo');\r\n-        const announcementNotif = data.notifications.find((notif: any) => notif.type === 'announcement');\r\n+        const fetchedPromoCodes = data.promoCodes || [];\r\n+        const announcementNotif = data.notifications?.[0];\r\n \r\n         if (announcementNotif) {\r\n           setAnnouncement(announcementNotif.content || '');\r\n           setIsAnnouncementActive(announcementNotif.isActive || false);\r\n@@ -80,11 +82,10 @@\n         // Map data to match PromoCode interface\r\n         const formattedPromoCodes: PromoCode[] = fetchedPromoCodes.map((code: any) => ({\r\n           id: code._id.toString(),\r\n           code: code.code,\r\n-          type: code.promoType || 'fixed', // Use promoType instead of type\r\n-          value: code.value !== undefined ? code.value : code.amount, // Use value if available, fallback to amount\r\n-          amount: code.amount, // Keep amount for backward compatibility if needed\r\n+          type: code.type || 'fixed',\r\n+          value: code.value,\r\n           maxAmount: code.maxAmount,\r\n           isActive: code.isActive,\r\n           isLoginRequired: code.isLoginRequired || false,\r\n           perUserLimit: code.perUserLimit || 0,\r\n@@ -93,8 +94,10 @@\n           usedCount: code.usedCount || 0,\r\n           scope: code.scope || 'all',\r\n           selectedProducts: code.selectedProducts || [],\r\n         }));\r\n+\r\n+        console.log('Formatted promo codes:', formattedPromoCodes); // Debug log\r\n         setPromoCodes(formattedPromoCodes);\r\n       } else {\r\n         setMessage(data.message || \"Failed to fetch notifications\");\r\n       }\r\n@@ -199,8 +202,10 @@\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n+      console.log('Add promo code response:', data); // Debug log\r\n+\r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được thêm!\");\r\n         setNewPromoCode(\"\");\r\n         setNewPromoValue(\"\");\r\n@@ -209,12 +214,12 @@\n         setNewPromoPerUserLimit(\"\");\r\n         setNewPromoExpiryDate(\"\");\r\n         setNewPromoScope('all');\r\n         setSelectedProducts([]);\r\n-        fetchNotifications();\r\n+        await fetchNotifications(); // Fetch updated data\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n       } else {\r\n-        setMessage(data.error || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n+        setMessage(data.message || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n       }\r\n     } catch (error) {\r\n       console.error(\"Error adding promo code:\", error);\r\n       setMessage(\"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n"
                },
                {
                    "date": 1749537901032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -253,9 +253,9 @@\n     }\r\n   };\r\n \r\n   const handleDeletePromoCode = async (id: string) => {\r\n-    if (!confirm(\"Bạn có chắc chắn muốn xóa mã giảm giá này?\")) {\r\n+    if (!confirm('Bạn có chắc chắn muốn xóa mã giảm giá này?')) {\r\n       return;\r\n     }\r\n \r\n     try {\r\n@@ -266,17 +266,19 @@\n         },\r\n         body: JSON.stringify({\r\n           type: \"promo\",\r\n           action: \"delete\",\r\n-          id,\r\n+          id: id\r\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được xóa!\");\r\n-        fetchNotifications();\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n+        fetchNotifications(); // Refresh danh sách\r\n+      } else {\r\n+        setMessage(data.message || \"Có lỗi xảy ra khi xóa mã giảm giá\");\r\n       }\r\n     } catch (error) {\r\n       console.error(\"Error deleting promo code:\", error);\r\n       setMessage(\"Có lỗi xảy ra khi xóa mã giảm giá\");\r\n"
                },
                {
                    "date": 1749538187999,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -529,8 +529,9 @@\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Phạm vi</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n                     </tr>\r\n                   </thead>\r\n                   <tbody>\r\n                     {promoCodes.map((promo) => (\r\n@@ -556,8 +557,28 @@\n                               {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n                             </span>\r\n                           </label>\r\n                         </td>\r\n+                        <td className=\"py-2 px-4\">\r\n+                          <div className=\"flex gap-2\">\r\n+                            <button\r\n+                              onClick={() => handleTogglePromoCode(promo.id, !promo.isActive)}\r\n+                              className={`px-3 py-1 rounded ${\r\n+                                promo.isActive \r\n+                                  ? 'bg-red-500 hover:bg-red-600' \r\n+                                  : 'bg-green-500 hover:bg-green-600'\r\n+                              } text-white text-sm`}\r\n+                            >\r\n+                              {promo.isActive ? 'Vô hiệu hóa' : 'Kích hoạt'}\r\n+                            </button>\r\n+                            <button\r\n+                              onClick={() => handleDeletePromoCode(promo.id)}\r\n+                              className=\"px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-sm\"\r\n+                            >\r\n+                              Xóa\r\n+                            </button>\r\n+                          </div>\r\n+                        </td>\r\n                       </tr>\r\n                     ))}\r\n                   </tbody>\r\n                 </table>\r\n"
                },
                {
                    "date": 1749543728568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,10 +14,8 @@\n   perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n   usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n   expiryDate?: string; // Ngày hết hạn\r\n   usedCount?: number; // Tổng số lần đã dùng\r\n-  scope: 'all' | 'selected';\r\n-  selectedProducts?: string[];\r\n }\r\n \r\n interface Product {\r\n   _id: string;\r\n@@ -29,19 +27,16 @@\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n   const [newPromoCode, setNewPromoCode] = useState(\"\");\r\n-  const [newPromoType, setNewPromoType] = useState<'fixed' | 'percentage'>('fixed'); // State cho loại giảm giá\r\n-  const [newPromoValue, setNewPromoValue] = useState(\"\"); // State cho giá trị (tiền hoặc %) - dùng string để dễ nhập liệu\r\n-  const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\"); // State cho giới hạn tối đa\r\n-  const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false); // State yêu cầu đăng nhập\r\n-  const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\"); // State giới hạn mỗi người dùng\r\n-  const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\"); // State ngày hết hạn\r\n-  const [newPromoScope, setNewPromoScope] = useState<'all' | 'selected'>('all');\r\n-  const [selectedProducts, setSelectedProducts] = useState<string[]>([]);\r\n+  const [newPromoType, setNewPromoType] = useState<'fixed' | 'percentage'>('fixed');\r\n+  const [newPromoValue, setNewPromoValue] = useState(\"\");\r\n+  const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\");\r\n+  const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false);\r\n+  const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\");\r\n+  const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\");\r\n   const [products, setProducts] = useState<Product[]>([]);\r\n   const [message, setMessage] = useState(\"\");\r\n-  const [showProductSelector, setShowProductSelector] = useState(false);\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n     fetchProducts();\r\n@@ -91,10 +86,8 @@\n           perUserLimit: code.perUserLimit || 0,\r\n           usedByUsers: code.usedByUsers || [],\r\n           expiryDate: code.expiryDate,\r\n           usedCount: code.usedCount || 0,\r\n-          scope: code.scope || 'all',\r\n-          selectedProducts: code.selectedProducts || [],\r\n         }));\r\n \r\n         console.log('Formatted promo codes:', formattedPromoCodes); // Debug log\r\n         setPromoCodes(formattedPromoCodes);\r\n@@ -141,23 +134,16 @@\n       newPromoValue, \r\n       newPromoMaxAmount, \r\n       newPromoIsLoginRequired, \r\n       newPromoPerUserLimit, \r\n-      newPromoExpiryDate,\r\n-      newPromoScope,\r\n-      selectedProducts \r\n+      newPromoExpiryDate\r\n     });\r\n \r\n     if (!newPromoCode.trim() || !newPromoValue.trim()) {\r\n       setMessage(\"Vui lòng nhập đầy đủ mã và giá trị giảm giá\");\r\n       return;\r\n     }\r\n \r\n-    if (newPromoScope === 'selected' && selectedProducts.length === 0) {\r\n-      setMessage(\"Vui lòng chọn ít nhất một sản phẩm\");\r\n-      return;\r\n-    }\r\n-\r\n     const promoValueNumeric = parseFloat(newPromoValue.replace(/[^0-9.-]+/g, ''));\r\n \r\n     if (isNaN(promoValueNumeric) || promoValueNumeric <= 0) {\r\n       setMessage(newPromoType === 'fixed' ? \"Số tiền giảm giá không hợp lệ\" : \"Phần trăm giảm giá không hợp lệ\");\r\n@@ -195,16 +181,14 @@\n           value: promoValueNumeric,\r\n           maxAmount: promoMaxAmountNumeric,\r\n           isLoginRequired: newPromoIsLoginRequired,\r\n           perUserLimit: promoPerUserLimitNumeric || undefined,\r\n-          expiryDate: promoExpiryDateValue,\r\n-          scope: newPromoScope,\r\n-          selectedProducts: newPromoScope === 'selected' ? selectedProducts : undefined\r\n+          expiryDate: promoExpiryDateValue\r\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n-      console.log('Add promo code response:', data); // Debug log\r\n+      console.log('Add promo code response:', data);\r\n \r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được thêm!\");\r\n         setNewPromoCode(\"\");\r\n@@ -212,11 +196,9 @@\n         setNewPromoMaxAmount(\"\");\r\n         setNewPromoIsLoginRequired(false);\r\n         setNewPromoPerUserLimit(\"\");\r\n         setNewPromoExpiryDate(\"\");\r\n-        setNewPromoScope('all');\r\n-        setSelectedProducts([]);\r\n-        await fetchNotifications(); // Fetch updated data\r\n+        await fetchNotifications();\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n       } else {\r\n         setMessage(data.message || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n       }\r\n@@ -344,18 +326,17 @@\n               <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n             </div>\r\n             <div className=\"p-6\">\r\n               <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Mã giảm giá</label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoCode}\r\n                       onChange={(e) => setNewPromoCode(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"VD: NEWCODE20\"\r\n-                      required\r\n+                      placeholder=\"Nhập mã giảm giá\"\r\n                     />\r\n                   </div>\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Loại giảm giá</label>\r\n@@ -363,26 +344,25 @@\n                       value={newPromoType}\r\n                       onChange={(e) => setNewPromoType(e.target.value as 'fixed' | 'percentage')}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                     >\r\n-                      <option value=\"fixed\">Giảm theo số tiền cố định</option>\r\n-                      <option value=\"percentage\">Giảm theo phần trăm (%)</option>\r\n+                      <option value=\"fixed\">Giảm giá cố định</option>\r\n+                      <option value=\"percentage\">Giảm giá theo phần trăm</option>\r\n                     </select>\r\n                   </div>\r\n                 </div>\r\n \r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">\r\n-                      {newPromoType === 'fixed' ? 'Số tiền giảm' : 'Phần trăm giảm'}\r\n+                      {newPromoType === 'fixed' ? 'Số tiền giảm giá' : 'Phần trăm giảm giá (%)'}\r\n                     </label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoValue}\r\n                       onChange={(e) => setNewPromoValue(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder={newPromoType === 'fixed' ? \"VD: 100000\" : \"VD: 20\"}\r\n-                      required\r\n+                      placeholder={newPromoType === 'fixed' ? 'Nhập số tiền' : 'Nhập phần trăm'}\r\n                     />\r\n                   </div>\r\n                   {newPromoType === 'percentage' && (\r\n                     <div>\r\n@@ -391,46 +371,19 @@\n                         type=\"text\"\r\n                         value={newPromoMaxAmount}\r\n                         onChange={(e) => setNewPromoMaxAmount(e.target.value)}\r\n                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                        placeholder=\"VD: 500000\"\r\n+                        placeholder=\"Nhập giới hạn tối đa\"\r\n                       />\r\n                     </div>\r\n                   )}\r\n                 </div>\r\n \r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   <div>\r\n-                    <label className=\"block text-sm font-medium text-black mb-1\">Phạm vi áp dụng</label>\r\n-                    <select\r\n-                      value={newPromoScope}\r\n-                      onChange={(e) => setNewPromoScope(e.target.value as 'all' | 'selected')}\r\n-                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                    >\r\n-                      <option value=\"all\">Tất cả sản phẩm</option>\r\n-                      <option value=\"selected\">Chọn sản phẩm cụ thể</option>\r\n-                    </select>\r\n-                  </div>\r\n-                  {newPromoScope === 'selected' && (\r\n-                    <div>\r\n-                      <button\r\n-                        type=\"button\"\r\n-                        onClick={() => setShowProductSelector(true)}\r\n-                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black hover:bg-gray-50\"\r\n-                      >\r\n-                        {selectedProducts.length > 0 \r\n-                          ? `Đã chọn ${selectedProducts.length} sản phẩm` \r\n-                          : \"Chọn sản phẩm\"}\r\n-                      </button>\r\n-                    </div>\r\n-                  )}\r\n-                </div>\r\n-\r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n-                  <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Ngày hết hạn</label>\r\n                     <input\r\n-                      type=\"date\"\r\n+                      type=\"datetime-local\"\r\n                       value={newPromoExpiryDate}\r\n                       onChange={(e) => setNewPromoExpiryDate(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                     />\r\n@@ -441,82 +394,35 @@\n                       type=\"number\"\r\n                       value={newPromoPerUserLimit}\r\n                       onChange={(e) => setNewPromoPerUserLimit(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"Để trống nếu không giới hạn\"\r\n+                      placeholder=\"Nhập số lần sử dụng tối đa\"\r\n                       min=\"0\"\r\n                     />\r\n                   </div>\r\n                 </div>\r\n \r\n-                <div className=\"mb-4\">\r\n-                  <label className=\"flex items-center\">\r\n-                    <input\r\n-                      type=\"checkbox\"\r\n-                      checked={newPromoIsLoginRequired}\r\n-                      onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n-                      className=\"form-checkbox h-4 w-4 text-black\"\r\n-                    />\r\n-                    <span className=\"ml-2 text-sm text-black\">Yêu cầu đăng nhập để sử dụng</span>\r\n+                <div className=\"flex items-center\">\r\n+                  <input\r\n+                    type=\"checkbox\"\r\n+                    id=\"isLoginRequired\"\r\n+                    checked={newPromoIsLoginRequired}\r\n+                    onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n+                    className=\"mr-2\"\r\n+                  />\r\n+                  <label htmlFor=\"isLoginRequired\" className=\"text-sm text-black\">\r\n+                    Yêu cầu đăng nhập để sử dụng\r\n                   </label>\r\n                 </div>\r\n \r\n                 <button\r\n                   type=\"submit\"\r\n-                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n+                  className=\"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors\"\r\n                 >\r\n                   Thêm mã giảm giá\r\n                 </button>\r\n               </form>\r\n \r\n-              {/* Product Selector Modal */}\r\n-              {showProductSelector && (\r\n-                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n-                  <div className=\"bg-white p-6 rounded-lg max-w-2xl w-full mx-4\">\r\n-                    <div className=\"flex justify-between items-center mb-4\">\r\n-                      <h3 className=\"text-lg font-bold text-black\">Chọn sản phẩm</h3>\r\n-                      <button\r\n-                        onClick={() => setShowProductSelector(false)}\r\n-                        className=\"text-gray-500 hover:text-black\"\r\n-                      >\r\n-                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n-                        </svg>\r\n-                      </button>\r\n-                    </div>\r\n-                    <div className=\"max-h-96 overflow-y-auto mb-4\">\r\n-                      {products.map((product) => (\r\n-                        <label key={product._id} className=\"flex items-center p-2 hover:bg-gray-50\">\r\n-                          <input\r\n-                            type=\"checkbox\"\r\n-                            checked={selectedProducts.includes(product._id)}\r\n-                            onChange={(e) => {\r\n-                              if (e.target.checked) {\r\n-                                setSelectedProducts([...selectedProducts, product._id]);\r\n-                              } else {\r\n-                                setSelectedProducts(selectedProducts.filter(id => id !== product._id));\r\n-                              }\r\n-                            }}\r\n-                            className=\"form-checkbox h-4 w-4 text-black\"\r\n-                          />\r\n-                          <span className=\"ml-2 text-sm text-black\">\r\n-                            {product.name} - {product.price.toLocaleString('vi-VN')} VND\r\n-                          </span>\r\n-                        </label>\r\n-                      ))}\r\n-                    </div>\r\n-                    <div className=\"flex justify-end\">\r\n-                      <button\r\n-                        onClick={() => setShowProductSelector(false)}\r\n-                        className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n-                      >\r\n-                        Xong\r\n-                      </button>\r\n-                    </div>\r\n-                  </div>\r\n-                </div>\r\n-              )}\r\n-\r\n               <div className=\"overflow-x-auto\">\r\n                 <table className=\"min-w-full\">\r\n                   <thead>\r\n                     <tr className=\"border-b border-gray-200\">\r\n@@ -527,9 +433,8 @@\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Phạm vi</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n                     </tr>\r\n                   </thead>\r\n@@ -543,9 +448,8 @@\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.scope === 'all' ? 'Tất cả' : 'Đã chọn'}</td>\r\n                         <td className=\"py-2 px-4\">\r\n                           <label className=\"flex items-center\">\r\n                             <input\r\n                               type=\"checkbox\"\r\n"
                },
                {
                    "date": 1749544862826,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,26 +4,20 @@\n \r\n interface PromoCode {\r\n   id: string;\r\n   code: string;\r\n-  amount?: number; // amount có thể không tồn tại nếu type là percentage\r\n+  amount?: number;\r\n   isActive: boolean;\r\n-  type: 'fixed' | 'percentage'; // Thêm loại giảm giá\r\n-  value: number; // Số tiền hoặc phần trăm\r\n-  maxAmount?: number; // Giới hạn tối đa cho percentage\r\n-  isLoginRequired?: boolean; // Yêu cầu đăng nhập\r\n-  perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n-  usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n-  expiryDate?: string; // Ngày hết hạn\r\n-  usedCount?: number; // Tổng số lần đã dùng\r\n+  type: 'fixed' | 'percentage';\r\n+  value: number;\r\n+  maxAmount?: number;\r\n+  isLoginRequired?: boolean;\r\n+  perUserLimit?: number;\r\n+  usedByUsers?: string[];\r\n+  expiryDate?: string;\r\n+  usedCount?: number;\r\n }\r\n \r\n-interface Product {\r\n-  _id: string;\r\n-  name: string;\r\n-  price: number;\r\n-}\r\n-\r\n export default function NotificationsAdmin() {\r\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n@@ -33,28 +27,14 @@\n   const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\");\r\n   const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false);\r\n   const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\");\r\n   const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\");\r\n-  const [products, setProducts] = useState<Product[]>([]);\r\n   const [message, setMessage] = useState(\"\");\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n-    fetchProducts();\r\n   }, []);\r\n \r\n-  const fetchProducts = async () => {\r\n-    try {\r\n-      const response = await fetch(\"/api/products\");\r\n-      const data = await response.json();\r\n-      if (data.ok) {\r\n-        setProducts(data.products);\r\n-      }\r\n-    } catch (error) {\r\n-      console.error(\"Error fetching products:\", error);\r\n-    }\r\n-  };\r\n-\r\n   const fetchNotifications = async () => {\r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\");\r\n       const data = await response.json();\r\n@@ -267,67 +247,68 @@\n     }\r\n   };\r\n \r\n   return (\r\n-    <div className=\"min-h-screen bg-white\">\r\n-      <div className=\"w-full\">\r\n-        <div className=\"border-b border-gray-200\">\r\n-          <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n-        </div>\r\n+    <div className=\"container mx-auto px-4 py-8\">\r\n+      <div className=\"border-b border-gray-200\">\r\n+        <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n+      </div>\r\n \r\n-        {message && (\r\n-          <motion.div\r\n-            initial={{ opacity: 0, y: -20 }}\r\n-            animate={{ opacity: 1, y: 0 }}\r\n-            className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n-          >\r\n-            {message}\r\n-          </motion.div>\r\n-        )}\r\n+      {message && (\r\n+        <motion.div\r\n+          initial={{ opacity: 0, y: -20 }}\r\n+          animate={{ opacity: 1, y: 0 }}\r\n+          className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n+        >\r\n+          {message}\r\n+        </motion.div>\r\n+      )}\r\n \r\n-        <div className=\"p-8\">\r\n-          <div className=\"border border-gray-200 mb-6\">\r\n-            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n-              <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n-            </div>\r\n-            <div className=\"p-6\">\r\n-              <form onSubmit={handleAnnouncementSubmit}>\r\n-                <div className=\"mb-4\">\r\n-                  <textarea\r\n-                    value={announcement}\r\n-                    onChange={(e) => setAnnouncement(e.target.value)}\r\n-                    className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                    rows={3}\r\n-                    placeholder=\"Nhập nội dung thông báo...\"\r\n+      <div className=\"p-8\">\r\n+        <div className=\"border border-gray-200 mb-6\">\r\n+          <div className=\"border-b border-gray-200 px-6 py-4\">\r\n+            <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n+          </div>\r\n+          <div className=\"p-6\">\r\n+            <form onSubmit={handleAnnouncementSubmit}>\r\n+              <div className=\"mb-4\">\r\n+                <textarea\r\n+                  value={announcement}\r\n+                  onChange={(e) => setAnnouncement(e.target.value)}\r\n+                  className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                  rows={3}\r\n+                  placeholder=\"Nhập nội dung thông báo...\"\r\n+                />\r\n+              </div>\r\n+              <div className=\"mb-4\">\r\n+                <label className=\"flex items-center text-sm\">\r\n+                  <input\r\n+                    type=\"checkbox\"\r\n+                    checked={isAnnouncementActive}\r\n+                    onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n+                    className=\"form-checkbox h-4 w-4 text-black\"\r\n                   />\r\n-                </div>\r\n-                <div className=\"mb-4\">\r\n-                  <label className=\"flex items-center text-sm\">\r\n-                    <input\r\n-                      type=\"checkbox\"\r\n-                      checked={isAnnouncementActive}\r\n-                      onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n-                      className=\"form-checkbox h-4 w-4 text-black\"\r\n-                    />\r\n-                    <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n-                  </label>\r\n-                </div>\r\n-                <button\r\n-                  type=\"submit\"\r\n-                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n-                >\r\n-                  Cập nhật thông báo\r\n-                </button>\r\n-              </form>\r\n-            </div>\r\n+                  <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n+                </label>\r\n+              </div>\r\n+              <button\r\n+                type=\"submit\"\r\n+                className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n+              >\r\n+                Cập nhật thông báo\r\n+              </button>\r\n+            </form>\r\n           </div>\r\n+        </div>\r\n \r\n-          <div className=\"border border-gray-200\">\r\n-            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n-              <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n-            </div>\r\n-            <div className=\"p-6\">\r\n-              <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n+        <div className=\"border border-gray-200\">\r\n+          <div className=\"border-b border-gray-200 px-6 py-4\">\r\n+            <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n+          </div>\r\n+          <div className=\"p-6\">\r\n+            <div className=\"bg-white rounded-lg shadow-md p-6 mb-8\">\r\n+              <h2 className=\"text-xl font-semibold mb-4\">Thêm mã giảm giá mới</h2>\r\n+              <form onSubmit={handleAddPromoCode} className=\"space-y-4\">\r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Mã giảm giá</label>\r\n                     <input\r\n@@ -420,74 +401,74 @@\n                 >\r\n                   Thêm mã giảm giá\r\n                 </button>\r\n               </form>\r\n+            </div>\r\n \r\n-              <div className=\"overflow-x-auto\">\r\n-                <table className=\"min-w-full\">\r\n-                  <thead>\r\n-                    <tr className=\"border-b border-gray-200\">\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n-                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n+            <div className=\"overflow-x-auto\">\r\n+              <table className=\"min-w-full\">\r\n+                <thead>\r\n+                  <tr className=\"border-b border-gray-200\">\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n+                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n+                  </tr>\r\n+                </thead>\r\n+                <tbody>\r\n+                  {promoCodes.map((promo) => (\r\n+                    <tr key={promo.id} className=\"border-b border-gray-100\">\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n+                      <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n+                      <td className=\"py-2 px-4\">\r\n+                        <label className=\"flex items-center\">\r\n+                          <input\r\n+                            type=\"checkbox\"\r\n+                            checked={promo.isActive}\r\n+                            onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n+                            className=\"form-checkbox h-4 w-4 text-black\"\r\n+                          />\r\n+                          <span className=\"ml-2 text-sm text-black\">\r\n+                            {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n+                          </span>\r\n+                        </label>\r\n+                      </td>\r\n+                      <td className=\"py-2 px-4\">\r\n+                        <div className=\"flex gap-2\">\r\n+                          <button\r\n+                            onClick={() => handleTogglePromoCode(promo.id, !promo.isActive)}\r\n+                            className={`px-3 py-1 rounded ${\r\n+                              promo.isActive \r\n+                                ? 'bg-red-500 hover:bg-red-600' \r\n+                                : 'bg-green-500 hover:bg-green-600'\r\n+                            } text-white text-sm`}\r\n+                          >\r\n+                            {promo.isActive ? 'Vô hiệu hóa' : 'Kích hoạt'}\r\n+                          </button>\r\n+                          <button\r\n+                            onClick={() => handleDeletePromoCode(promo.id)}\r\n+                            className=\"px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-sm\"\r\n+                          >\r\n+                            Xóa\r\n+                          </button>\r\n+                        </div>\r\n+                      </td>\r\n                     </tr>\r\n-                  </thead>\r\n-                  <tbody>\r\n-                    {promoCodes.map((promo) => (\r\n-                      <tr key={promo.id} className=\"border-b border-gray-100\">\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n-                        <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n-                        <td className=\"py-2 px-4\">\r\n-                          <label className=\"flex items-center\">\r\n-                            <input\r\n-                              type=\"checkbox\"\r\n-                              checked={promo.isActive}\r\n-                              onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n-                              className=\"form-checkbox h-4 w-4 text-black\"\r\n-                            />\r\n-                            <span className=\"ml-2 text-sm text-black\">\r\n-                              {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n-                            </span>\r\n-                          </label>\r\n-                        </td>\r\n-                        <td className=\"py-2 px-4\">\r\n-                          <div className=\"flex gap-2\">\r\n-                            <button\r\n-                              onClick={() => handleTogglePromoCode(promo.id, !promo.isActive)}\r\n-                              className={`px-3 py-1 rounded ${\r\n-                                promo.isActive \r\n-                                  ? 'bg-red-500 hover:bg-red-600' \r\n-                                  : 'bg-green-500 hover:bg-green-600'\r\n-                              } text-white text-sm`}\r\n-                            >\r\n-                              {promo.isActive ? 'Vô hiệu hóa' : 'Kích hoạt'}\r\n-                            </button>\r\n-                            <button\r\n-                              onClick={() => handleDeletePromoCode(promo.id)}\r\n-                              className=\"px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-sm\"\r\n-                            >\r\n-                              Xóa\r\n-                            </button>\r\n-                          </div>\r\n-                        </td>\r\n-                      </tr>\r\n-                    ))}\r\n-                  </tbody>\r\n-                </table>\r\n-              </div>\r\n+                  ))}\r\n+                </tbody>\r\n+              </table>\r\n             </div>\r\n           </div>\r\n         </div>\r\n       </div>\r\n"
                },
                {
                    "date": 1749545250655,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,20 +4,26 @@\n \r\n interface PromoCode {\r\n   id: string;\r\n   code: string;\r\n-  amount?: number;\r\n+  amount?: number; // amount có thể không tồn tại nếu type là percentage\r\n   isActive: boolean;\r\n-  type: 'fixed' | 'percentage';\r\n-  value: number;\r\n-  maxAmount?: number;\r\n-  isLoginRequired?: boolean;\r\n-  perUserLimit?: number;\r\n-  usedByUsers?: string[];\r\n-  expiryDate?: string;\r\n-  usedCount?: number;\r\n+  type: 'fixed' | 'percentage'; // Thêm loại giảm giá\r\n+  value: number; // Số tiền hoặc phần trăm\r\n+  maxAmount?: number; // Giới hạn tối đa cho percentage\r\n+  isLoginRequired?: boolean; // Yêu cầu đăng nhập\r\n+  perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n+  usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n+  expiryDate?: string; // Ngày hết hạn\r\n+  usedCount?: number; // Tổng số lần đã dùng\r\n }\r\n \r\n+interface Product {\r\n+  _id: string;\r\n+  name: string;\r\n+  price: number;\r\n+}\r\n+\r\n export default function NotificationsAdmin() {\r\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n@@ -27,14 +33,28 @@\n   const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\");\r\n   const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false);\r\n   const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\");\r\n   const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\");\r\n+  const [products, setProducts] = useState<Product[]>([]);\r\n   const [message, setMessage] = useState(\"\");\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n+    fetchProducts();\r\n   }, []);\r\n \r\n+  const fetchProducts = async () => {\r\n+    try {\r\n+      const response = await fetch(\"/api/products\");\r\n+      const data = await response.json();\r\n+      if (data.ok) {\r\n+        setProducts(data.products);\r\n+      }\r\n+    } catch (error) {\r\n+      console.error(\"Error fetching products:\", error);\r\n+    }\r\n+  };\r\n+\r\n   const fetchNotifications = async () => {\r\n     try {\r\n       const response = await fetch(\"/api/admin/notifications\");\r\n       const data = await response.json();\r\n@@ -247,68 +267,67 @@\n     }\r\n   };\r\n \r\n   return (\r\n-    <div className=\"container mx-auto px-4 py-8\">\r\n-      <div className=\"border-b border-gray-200\">\r\n-        <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n-      </div>\r\n+    <div className=\"min-h-screen bg-white\">\r\n+      <div className=\"w-full\">\r\n+        <div className=\"border-b border-gray-200\">\r\n+          <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n+        </div>\r\n \r\n-      {message && (\r\n-        <motion.div\r\n-          initial={{ opacity: 0, y: -20 }}\r\n-          animate={{ opacity: 1, y: 0 }}\r\n-          className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n-        >\r\n-          {message}\r\n-        </motion.div>\r\n-      )}\r\n+        {message && (\r\n+          <motion.div\r\n+            initial={{ opacity: 0, y: -20 }}\r\n+            animate={{ opacity: 1, y: 0 }}\r\n+            className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n+          >\r\n+            {message}\r\n+          </motion.div>\r\n+        )}\r\n \r\n-      <div className=\"p-8\">\r\n-        <div className=\"border border-gray-200 mb-6\">\r\n-          <div className=\"border-b border-gray-200 px-6 py-4\">\r\n-            <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n-          </div>\r\n-          <div className=\"p-6\">\r\n-            <form onSubmit={handleAnnouncementSubmit}>\r\n-              <div className=\"mb-4\">\r\n-                <textarea\r\n-                  value={announcement}\r\n-                  onChange={(e) => setAnnouncement(e.target.value)}\r\n-                  className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                  rows={3}\r\n-                  placeholder=\"Nhập nội dung thông báo...\"\r\n-                />\r\n-              </div>\r\n-              <div className=\"mb-4\">\r\n-                <label className=\"flex items-center text-sm\">\r\n-                  <input\r\n-                    type=\"checkbox\"\r\n-                    checked={isAnnouncementActive}\r\n-                    onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n-                    className=\"form-checkbox h-4 w-4 text-black\"\r\n+        <div className=\"p-8\">\r\n+          <div className=\"border border-gray-200 mb-6\">\r\n+            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n+              <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n+            </div>\r\n+            <div className=\"p-6\">\r\n+              <form onSubmit={handleAnnouncementSubmit}>\r\n+                <div className=\"mb-4\">\r\n+                  <textarea\r\n+                    value={announcement}\r\n+                    onChange={(e) => setAnnouncement(e.target.value)}\r\n+                    className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                    rows={3}\r\n+                    placeholder=\"Nhập nội dung thông báo...\"\r\n                   />\r\n-                  <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n-                </label>\r\n-              </div>\r\n-              <button\r\n-                type=\"submit\"\r\n-                className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n-              >\r\n-                Cập nhật thông báo\r\n-              </button>\r\n-            </form>\r\n+                </div>\r\n+                <div className=\"mb-4\">\r\n+                  <label className=\"flex items-center text-sm\">\r\n+                    <input\r\n+                      type=\"checkbox\"\r\n+                      checked={isAnnouncementActive}\r\n+                      onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n+                      className=\"form-checkbox h-4 w-4 text-black\"\r\n+                    />\r\n+                    <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n+                  </label>\r\n+                </div>\r\n+                <button\r\n+                  type=\"submit\"\r\n+                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n+                >\r\n+                  Cập nhật thông báo\r\n+                </button>\r\n+              </form>\r\n+            </div>\r\n           </div>\r\n-        </div>\r\n \r\n-        <div className=\"border border-gray-200\">\r\n-          <div className=\"border-b border-gray-200 px-6 py-4\">\r\n-            <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n-          </div>\r\n-          <div className=\"p-6\">\r\n-            <div className=\"bg-white rounded-lg shadow-md p-6 mb-8\">\r\n-              <h2 className=\"text-xl font-semibold mb-4\">Thêm mã giảm giá mới</h2>\r\n-              <form onSubmit={handleAddPromoCode} className=\"space-y-4\">\r\n+          <div className=\"border border-gray-200\">\r\n+            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n+              <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n+            </div>\r\n+            <div className=\"p-6\">\r\n+              <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Mã giảm giá</label>\r\n                     <input\r\n@@ -401,74 +420,74 @@\n                 >\r\n                   Thêm mã giảm giá\r\n                 </button>\r\n               </form>\r\n-            </div>\r\n \r\n-            <div className=\"overflow-x-auto\">\r\n-              <table className=\"min-w-full\">\r\n-                <thead>\r\n-                  <tr className=\"border-b border-gray-200\">\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n-                    <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n-                  </tr>\r\n-                </thead>\r\n-                <tbody>\r\n-                  {promoCodes.map((promo) => (\r\n-                    <tr key={promo.id} className=\"border-b border-gray-100\">\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n-                      <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n-                      <td className=\"py-2 px-4\">\r\n-                        <label className=\"flex items-center\">\r\n-                          <input\r\n-                            type=\"checkbox\"\r\n-                            checked={promo.isActive}\r\n-                            onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n-                            className=\"form-checkbox h-4 w-4 text-black\"\r\n-                          />\r\n-                          <span className=\"ml-2 text-sm text-black\">\r\n-                            {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n-                          </span>\r\n-                        </label>\r\n-                      </td>\r\n-                      <td className=\"py-2 px-4\">\r\n-                        <div className=\"flex gap-2\">\r\n-                          <button\r\n-                            onClick={() => handleTogglePromoCode(promo.id, !promo.isActive)}\r\n-                            className={`px-3 py-1 rounded ${\r\n-                              promo.isActive \r\n-                                ? 'bg-red-500 hover:bg-red-600' \r\n-                                : 'bg-green-500 hover:bg-green-600'\r\n-                            } text-white text-sm`}\r\n-                          >\r\n-                            {promo.isActive ? 'Vô hiệu hóa' : 'Kích hoạt'}\r\n-                          </button>\r\n-                          <button\r\n-                            onClick={() => handleDeletePromoCode(promo.id)}\r\n-                            className=\"px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-sm\"\r\n-                          >\r\n-                            Xóa\r\n-                          </button>\r\n-                        </div>\r\n-                      </td>\r\n+              <div className=\"overflow-x-auto\">\r\n+                <table className=\"min-w-full\">\r\n+                  <thead>\r\n+                    <tr className=\"border-b border-gray-200\">\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Loại</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giá trị</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n                     </tr>\r\n-                  ))}\r\n-                </tbody>\r\n-              </table>\r\n+                  </thead>\r\n+                  <tbody>\r\n+                    {promoCodes.map((promo) => (\r\n+                      <tr key={promo.id} className=\"border-b border-gray-100\">\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.type === 'fixed' ? 'Tiền' : '%'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.value}{promo.type === 'fixed' ? '₫' : '%'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.maxAmount !== undefined && promo.maxAmount !== null ? promo.maxAmount.toLocaleString() + '₫' : '---'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n+                        <td className=\"py-2 px-4\">\r\n+                          <label className=\"flex items-center\">\r\n+                            <input\r\n+                              type=\"checkbox\"\r\n+                              checked={promo.isActive}\r\n+                              onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n+                              className=\"form-checkbox h-4 w-4 text-black\"\r\n+                            />\r\n+                            <span className=\"ml-2 text-sm text-black\">\r\n+                              {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n+                            </span>\r\n+                          </label>\r\n+                        </td>\r\n+                        <td className=\"py-2 px-4\">\r\n+                          <div className=\"flex gap-2\">\r\n+                            <button\r\n+                              onClick={() => handleTogglePromoCode(promo.id, !promo.isActive)}\r\n+                              className={`px-3 py-1 rounded ${\r\n+                                promo.isActive \r\n+                                  ? 'bg-red-500 hover:bg-red-600' \r\n+                                  : 'bg-green-500 hover:bg-green-600'\r\n+                              } text-white text-sm`}\r\n+                            >\r\n+                              {promo.isActive ? 'Vô hiệu hóa' : 'Kích hoạt'}\r\n+                            </button>\r\n+                            <button\r\n+                              onClick={() => handleDeletePromoCode(promo.id)}\r\n+                              className=\"px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-sm\"\r\n+                            >\r\n+                              Xóa\r\n+                            </button>\r\n+                          </div>\r\n+                        </td>\r\n+                      </tr>\r\n+                    ))}\r\n+                  </tbody>\r\n+                </table>\r\n+              </div>\r\n             </div>\r\n           </div>\r\n         </div>\r\n       </div>\r\n"
                },
                {
                    "date": 1749545643404,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,10 @@\n   perUserLimit?: number; // Giới hạn sử dụng mỗi người dùng\r\n   usedByUsers?: string[]; // Danh sách người dùng đã dùng\r\n   expiryDate?: string; // Ngày hết hạn\r\n   usedCount?: number; // Tổng số lần đã dùng\r\n+  scope: 'all' | 'selected';\r\n+  selectedProducts?: string[];\r\n }\r\n \r\n interface Product {\r\n   _id: string;\r\n@@ -27,16 +29,19 @@\n   const [announcement, setAnnouncement] = useState(\"\");\r\n   const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n   const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n   const [newPromoCode, setNewPromoCode] = useState(\"\");\r\n-  const [newPromoType, setNewPromoType] = useState<'fixed' | 'percentage'>('fixed');\r\n-  const [newPromoValue, setNewPromoValue] = useState(\"\");\r\n-  const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\");\r\n-  const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false);\r\n-  const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\");\r\n-  const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\");\r\n+  const [newPromoType, setNewPromoType] = useState<'fixed' | 'percentage'>('fixed'); // State cho loại giảm giá\r\n+  const [newPromoValue, setNewPromoValue] = useState(\"\"); // State cho giá trị (tiền hoặc %) - dùng string để dễ nhập liệu\r\n+  const [newPromoMaxAmount, setNewPromoMaxAmount] = useState(\"\"); // State cho giới hạn tối đa\r\n+  const [newPromoIsLoginRequired, setNewPromoIsLoginRequired] = useState(false); // State yêu cầu đăng nhập\r\n+  const [newPromoPerUserLimit, setNewPromoPerUserLimit] = useState(\"\"); // State giới hạn mỗi người dùng\r\n+  const [newPromoExpiryDate, setNewPromoExpiryDate] = useState(\"\"); // State ngày hết hạn\r\n+  const [newPromoScope, setNewPromoScope] = useState<'all' | 'selected'>('all');\r\n+  const [selectedProducts, setSelectedProducts] = useState<string[]>([]);\r\n   const [products, setProducts] = useState<Product[]>([]);\r\n   const [message, setMessage] = useState(\"\");\r\n+  const [showProductSelector, setShowProductSelector] = useState(false);\r\n \r\n   useEffect(() => {\r\n     fetchNotifications();\r\n     fetchProducts();\r\n@@ -86,8 +91,10 @@\n           perUserLimit: code.perUserLimit || 0,\r\n           usedByUsers: code.usedByUsers || [],\r\n           expiryDate: code.expiryDate,\r\n           usedCount: code.usedCount || 0,\r\n+          scope: code.scope || 'all',\r\n+          selectedProducts: code.selectedProducts || [],\r\n         }));\r\n \r\n         console.log('Formatted promo codes:', formattedPromoCodes); // Debug log\r\n         setPromoCodes(formattedPromoCodes);\r\n@@ -134,16 +141,23 @@\n       newPromoValue, \r\n       newPromoMaxAmount, \r\n       newPromoIsLoginRequired, \r\n       newPromoPerUserLimit, \r\n-      newPromoExpiryDate\r\n+      newPromoExpiryDate,\r\n+      newPromoScope,\r\n+      selectedProducts \r\n     });\r\n \r\n     if (!newPromoCode.trim() || !newPromoValue.trim()) {\r\n       setMessage(\"Vui lòng nhập đầy đủ mã và giá trị giảm giá\");\r\n       return;\r\n     }\r\n \r\n+    if (newPromoScope === 'selected' && selectedProducts.length === 0) {\r\n+      setMessage(\"Vui lòng chọn ít nhất một sản phẩm\");\r\n+      return;\r\n+    }\r\n+\r\n     const promoValueNumeric = parseFloat(newPromoValue.replace(/[^0-9.-]+/g, ''));\r\n \r\n     if (isNaN(promoValueNumeric) || promoValueNumeric <= 0) {\r\n       setMessage(newPromoType === 'fixed' ? \"Số tiền giảm giá không hợp lệ\" : \"Phần trăm giảm giá không hợp lệ\");\r\n@@ -181,14 +195,16 @@\n           value: promoValueNumeric,\r\n           maxAmount: promoMaxAmountNumeric,\r\n           isLoginRequired: newPromoIsLoginRequired,\r\n           perUserLimit: promoPerUserLimitNumeric || undefined,\r\n-          expiryDate: promoExpiryDateValue\r\n+          expiryDate: promoExpiryDateValue,\r\n+          scope: newPromoScope,\r\n+          selectedProducts: newPromoScope === 'selected' ? selectedProducts : undefined\r\n         }),\r\n       });\r\n \r\n       const data = await response.json();\r\n-      console.log('Add promo code response:', data);\r\n+      console.log('Add promo code response:', data); // Debug log\r\n \r\n       if (data.ok) {\r\n         setMessage(\"Mã giảm giá đã được thêm!\");\r\n         setNewPromoCode(\"\");\r\n@@ -196,9 +212,11 @@\n         setNewPromoMaxAmount(\"\");\r\n         setNewPromoIsLoginRequired(false);\r\n         setNewPromoPerUserLimit(\"\");\r\n         setNewPromoExpiryDate(\"\");\r\n-        await fetchNotifications();\r\n+        setNewPromoScope('all');\r\n+        setSelectedProducts([]);\r\n+        await fetchNotifications(); // Fetch updated data\r\n         setTimeout(() => setMessage(\"\"), 3000);\r\n       } else {\r\n         setMessage(data.message || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n       }\r\n@@ -326,17 +344,18 @@\n               <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n             </div>\r\n             <div className=\"p-6\">\r\n               <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Mã giảm giá</label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoCode}\r\n                       onChange={(e) => setNewPromoCode(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"Nhập mã giảm giá\"\r\n+                      placeholder=\"VD: NEWCODE20\"\r\n+                      required\r\n                     />\r\n                   </div>\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Loại giảm giá</label>\r\n@@ -344,25 +363,26 @@\n                       value={newPromoType}\r\n                       onChange={(e) => setNewPromoType(e.target.value as 'fixed' | 'percentage')}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                     >\r\n-                      <option value=\"fixed\">Giảm giá cố định</option>\r\n-                      <option value=\"percentage\">Giảm giá theo phần trăm</option>\r\n+                      <option value=\"fixed\">Giảm theo số tiền cố định</option>\r\n+                      <option value=\"percentage\">Giảm theo phần trăm (%)</option>\r\n                     </select>\r\n                   </div>\r\n                 </div>\r\n \r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                   <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">\r\n-                      {newPromoType === 'fixed' ? 'Số tiền giảm giá' : 'Phần trăm giảm giá (%)'}\r\n+                      {newPromoType === 'fixed' ? 'Số tiền giảm' : 'Phần trăm giảm'}\r\n                     </label>\r\n                     <input\r\n                       type=\"text\"\r\n                       value={newPromoValue}\r\n                       onChange={(e) => setNewPromoValue(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder={newPromoType === 'fixed' ? 'Nhập số tiền' : 'Nhập phần trăm'}\r\n+                      placeholder={newPromoType === 'fixed' ? \"VD: 100000\" : \"VD: 20\"}\r\n+                      required\r\n                     />\r\n                   </div>\r\n                   {newPromoType === 'percentage' && (\r\n                     <div>\r\n@@ -371,19 +391,46 @@\n                         type=\"text\"\r\n                         value={newPromoMaxAmount}\r\n                         onChange={(e) => setNewPromoMaxAmount(e.target.value)}\r\n                         className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                        placeholder=\"Nhập giới hạn tối đa\"\r\n+                        placeholder=\"VD: 500000\"\r\n                       />\r\n                     </div>\r\n                   )}\r\n                 </div>\r\n \r\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                   <div>\r\n+                    <label className=\"block text-sm font-medium text-black mb-1\">Phạm vi áp dụng</label>\r\n+                    <select\r\n+                      value={newPromoScope}\r\n+                      onChange={(e) => setNewPromoScope(e.target.value as 'all' | 'selected')}\r\n+                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n+                    >\r\n+                      <option value=\"all\">Tất cả sản phẩm</option>\r\n+                      <option value=\"selected\">Chọn sản phẩm cụ thể</option>\r\n+                    </select>\r\n+                  </div>\r\n+                  {newPromoScope === 'selected' && (\r\n+                    <div>\r\n+                      <button\r\n+                        type=\"button\"\r\n+                        onClick={() => setShowProductSelector(true)}\r\n+                        className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black hover:bg-gray-50\"\r\n+                      >\r\n+                        {selectedProducts.length > 0 \r\n+                          ? `Đã chọn ${selectedProducts.length} sản phẩm` \r\n+                          : \"Chọn sản phẩm\"}\r\n+                      </button>\r\n+                    </div>\r\n+                  )}\r\n+                </div>\r\n+\r\n+                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n+                  <div>\r\n                     <label className=\"block text-sm font-medium text-black mb-1\">Ngày hết hạn</label>\r\n                     <input\r\n-                      type=\"datetime-local\"\r\n+                      type=\"date\"\r\n                       value={newPromoExpiryDate}\r\n                       onChange={(e) => setNewPromoExpiryDate(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                     />\r\n@@ -394,35 +441,83 @@\n                       type=\"number\"\r\n                       value={newPromoPerUserLimit}\r\n                       onChange={(e) => setNewPromoPerUserLimit(e.target.value)}\r\n                       className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n-                      placeholder=\"Nhập số lần sử dụng tối đa\"\r\n+                      placeholder=\"Để trống nếu không giới hạn\"\r\n                       min=\"0\"\r\n                     />\r\n                   </div>\r\n                 </div>\r\n \r\n-                <div className=\"flex items-center\">\r\n+                <div className=\"mb-4\">\r\n+                  <label className=\"flex items-center\">\r\n                   <input\r\n                     type=\"checkbox\"\r\n                     id=\"isLoginRequired\"\r\n                     checked={newPromoIsLoginRequired}\r\n                     onChange={(e) => setNewPromoIsLoginRequired(e.target.checked)}\r\n-                    className=\"mr-2\"\r\n+                      className=\"form-checkbox h-4 w-4 text-black\"\r\n                   />\r\n-                  <label htmlFor=\"isLoginRequired\" className=\"text-sm text-black\">\r\n-                    Yêu cầu đăng nhập để sử dụng\r\n+                    <span className=\"ml-2 text-sm text-black\">Yêu cầu đăng nhập để sử dụng</span>\r\n                   </label>\r\n                 </div>\r\n \r\n                 <button\r\n                   type=\"submit\"\r\n-                  className=\"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors\"\r\n+                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                 >\r\n                   Thêm mã giảm giá\r\n                 </button>\r\n               </form>\r\n \r\n+              {/* Product Selector Modal */}\r\n+              {showProductSelector && (\r\n+                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n+                  <div className=\"bg-white p-6 rounded-lg max-w-2xl w-full mx-4\">\r\n+                    <div className=\"flex justify-between items-center mb-4\">\r\n+                      <h3 className=\"text-lg font-bold text-black\">Chọn sản phẩm</h3>\r\n+                      <button\r\n+                        onClick={() => setShowProductSelector(false)}\r\n+                        className=\"text-gray-500 hover:text-black\"\r\n+                      >\r\n+                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n+                        </svg>\r\n+                      </button>\r\n+                    </div>\r\n+                    <div className=\"max-h-96 overflow-y-auto mb-4\">\r\n+                      {products.map((product) => (\r\n+                        <label key={product._id} className=\"flex items-center p-2 hover:bg-gray-50\">\r\n+                          <input\r\n+                            type=\"checkbox\"\r\n+                            checked={selectedProducts.includes(product._id)}\r\n+                            onChange={(e) => {\r\n+                              if (e.target.checked) {\r\n+                                setSelectedProducts([...selectedProducts, product._id]);\r\n+                              } else {\r\n+                                setSelectedProducts(selectedProducts.filter(id => id !== product._id));\r\n+                              }\r\n+                            }}\r\n+                            className=\"form-checkbox h-4 w-4 text-black\"\r\n+                          />\r\n+                          <span className=\"ml-2 text-sm text-black\">\r\n+                            {product.name} - {product.price.toLocaleString('vi-VN')} VND\r\n+                          </span>\r\n+                        </label>\r\n+                      ))}\r\n+                    </div>\r\n+                    <div className=\"flex justify-end\">\r\n+                      <button\r\n+                        onClick={() => setShowProductSelector(false)}\r\n+                        className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n+                      >\r\n+                        Xong\r\n+                      </button>\r\n+                    </div>\r\n+                  </div>\r\n+                </div>\r\n+              )}\r\n+\r\n               <div className=\"overflow-x-auto\">\r\n                 <table className=\"min-w-full\">\r\n                   <thead>\r\n                     <tr className=\"border-b border-gray-200\">\r\n@@ -433,8 +528,9 @@\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Yêu cầu đăng nhập</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Giới hạn người dùng</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Đã sử dụng</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hết hạn</th>\r\n+                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Phạm vi</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n                       <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Hành động</th>\r\n                     </tr>\r\n                   </thead>\r\n@@ -448,8 +544,9 @@\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.isLoginRequired ? 'Có' : 'Không'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.perUserLimit !== undefined && promo.perUserLimit > 0 ? promo.perUserLimit : 'Không giới hạn'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.usedCount !== undefined ? promo.usedCount : 'N/A'}</td>\r\n                         <td className=\"py-2 px-4 text-sm text-black\">{promo.expiryDate ? new Date(promo.expiryDate).toLocaleDateString() : '---'}</td>\r\n+                        <td className=\"py-2 px-4 text-sm text-black\">{promo.scope === 'all' ? 'Tất cả' : 'Đã chọn'}</td>\r\n                         <td className=\"py-2 px-4\">\r\n                           <label className=\"flex items-center\">\r\n                             <input\r\n                               type=\"checkbox\"\r\n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface PromoCode {\r\n  id: string;\r\n  code: string;\r\n  amount: number;\r\n  isActive: boolean;\r\n}\r\n\r\nexport default function NotificationsAdmin() {\r\n  const [announcement, setAnnouncement] = useState(\"\");\r\n  const [isAnnouncementActive, setIsAnnouncementActive] = useState(false);\r\n  const [promoCodes, setPromoCodes] = useState<PromoCode[]>([]);\r\n  const [newPromoCode, setNewPromoCode] = useState(\"\");\r\n  const [newPromoAmount, setNewPromoAmount] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    fetchNotifications();\r\n  }, []);\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\");\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setAnnouncement(data.announcement);\r\n        setIsAnnouncementActive(data.isAnnouncementActive);\r\n        setPromoCodes(data.promoCodes || []);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching notifications:\", error);\r\n    }\r\n  };\r\n\r\n  const handleAnnouncementSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"announcement\",\r\n          content: announcement,\r\n          isActive: isAnnouncementActive,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Thông báo đã được cập nhật!\");\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating announcement:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi cập nhật thông báo\");\r\n    }\r\n  };\r\n\r\n  const handleAddPromoCode = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    console.log(\"Adding promo code:\", { newPromoCode, newPromoAmount });\r\n\r\n    if (!newPromoCode || !newPromoAmount) {\r\n      setMessage(\"Vui lòng nhập đầy đủ thông tin mã giảm giá\");\r\n      return;\r\n    }\r\n\r\n    // Chuyển đổi chuỗi số tiền thành số\r\n    const amount = parseInt(newPromoAmount.replace(/[^0-9]/g, ''));\r\n    console.log(\"Parsed amount:\", amount);\r\n\r\n    if (isNaN(amount) || amount <= 0) {\r\n      setMessage(\"Số tiền giảm giá không hợp lệ\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"add\",\r\n          code: newPromoCode.trim(),\r\n          amount: Number(amount), // Đảm bảo gửi số\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      console.log(\"API Response:\", data);\r\n\r\n      if (data.ok) {\r\n        setMessage(\"Mã giảm giá đã được thêm!\");\r\n        setNewPromoCode(\"\");\r\n        setNewPromoAmount(\"\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      } else {\r\n        setMessage(data.error || \"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi thêm mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  const handleTogglePromoCode = async (id: string, isActive: boolean) => {\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"toggle\",\r\n          id,\r\n          isActive,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Trạng thái mã giảm giá đã được cập nhật!\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error toggling promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi cập nhật trạng thái mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  const handleDeletePromoCode = async (id: string) => {\r\n    if (!confirm(\"Bạn có chắc chắn muốn xóa mã giảm giá này?\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/admin/notifications\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          type: \"promo\",\r\n          action: \"delete\",\r\n          id,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.ok) {\r\n        setMessage(\"Mã giảm giá đã được xóa!\");\r\n        fetchNotifications();\r\n        setTimeout(() => setMessage(\"\"), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting promo code:\", error);\r\n      setMessage(\"Có lỗi xảy ra khi xóa mã giảm giá\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white\">\r\n      <div className=\"w-full\">\r\n        <div className=\"border-b border-gray-200\">\r\n          <h1 className=\"text-2xl font-bold text-black py-12 px-8 uppercase tracking-wide\">Quản lý thông báo và mã giảm giá</h1>\r\n        </div>\r\n\r\n        {message && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"bg-green-50 border-b border-green-200 text-green-700 px-8 py-2 text-sm\"\r\n          >\r\n            {message}\r\n          </motion.div>\r\n        )}\r\n\r\n        <div className=\"p-8\">\r\n          <div className=\"border border-gray-200 mb-6\">\r\n            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n              <h2 className=\"text-lg font-bold text-black\">Thông báo chạy ngang</h2>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <form onSubmit={handleAnnouncementSubmit}>\r\n                <div className=\"mb-4\">\r\n                  <textarea\r\n                    value={announcement}\r\n                    onChange={(e) => setAnnouncement(e.target.value)}\r\n                    className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                    rows={3}\r\n                    placeholder=\"Nhập nội dung thông báo...\"\r\n                  />\r\n                </div>\r\n                <div className=\"mb-4\">\r\n                  <label className=\"flex items-center text-sm\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={isAnnouncementActive}\r\n                      onChange={(e) => setIsAnnouncementActive(e.target.checked)}\r\n                      className=\"form-checkbox h-4 w-4 text-black\"\r\n                    />\r\n                    <span className=\"ml-2 text-black\">Hiển thị thông báo</span>\r\n                  </label>\r\n                </div>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                >\r\n                  Cập nhật thông báo\r\n                </button>\r\n              </form>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"border border-gray-200\">\r\n            <div className=\"border-b border-gray-200 px-6 py-4\">\r\n              <h2 className=\"text-lg font-bold text-black\">Mã giảm giá</h2>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <form onSubmit={handleAddPromoCode} className=\"mb-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                  <div>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={newPromoCode}\r\n                      onChange={(e) => setNewPromoCode(e.target.value)}\r\n                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                      placeholder=\"Nhập mã giảm giá...\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={newPromoAmount}\r\n                      onChange={(e) => setNewPromoAmount(e.target.value)}\r\n                      className=\"w-full border border-gray-200 px-3 py-2 text-sm text-black focus:outline-none focus:border-gray-400\"\r\n                      placeholder=\"Nhập số tiền giảm (VD: 100.000đ)\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"bg-black text-white px-4 py-2 text-sm hover:bg-gray-800\"\r\n                >\r\n                  Thêm mã giảm giá\r\n                </button>\r\n              </form>\r\n\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-gray-200\">\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Mã giảm giá</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Số tiền giảm</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Trạng thái</th>\r\n                      <th className=\"py-2 px-4 text-left text-sm font-bold text-black\">Thao tác</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {promoCodes.map((promo) => (\r\n                      <tr key={promo.id} className=\"border-b border-gray-100\">\r\n                        <td className=\"py-2 px-4 text-sm text-black\">{promo.code}</td>\r\n                        <td className=\"py-2 px-4 text-sm text-black\">{promo.amount.toLocaleString()}đ</td>\r\n                        <td className=\"py-2 px-4\">\r\n                          <label className=\"flex items-center\">\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              checked={promo.isActive}\r\n                              onChange={(e) => handleTogglePromoCode(promo.id, e.target.checked)}\r\n                              className=\"form-checkbox h-4 w-4 text-black\"\r\n                            />\r\n                            <span className=\"ml-2 text-sm text-black\">\r\n                              {promo.isActive ? \"Đang kích hoạt\" : \"Đã tắt\"}\r\n                            </span>\r\n                          </label>\r\n                        </td>\r\n                        <td className=\"py-2 px-4\">\r\n                          <button\r\n                            onClick={() => handleDeletePromoCode(promo.id)}\r\n                            className=\"text-sm text-red-600 hover:text-red-800\"\r\n                          >\r\n                            Xóa\r\n                          </button>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "
        }
    ]
}