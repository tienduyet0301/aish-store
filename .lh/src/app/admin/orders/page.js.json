{
    "sourceFile": "src/app/admin/orders/page.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 20,
            "patches": [
                {
                    "date": 1746893158790,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747059958302,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,36 +1,52 @@\n \"use client\";\r\n-import { useState } from \"react\";\r\n+import { useState, useEffect } from \"react\";\r\n import { motion } from \"framer-motion\";\r\n \r\n export default function Orders() {\r\n-  const [orders, setOrders] = useState([\r\n-    {\r\n-      id: \"DH-001\",\r\n-      customer: \"Nguyễn Văn A\",\r\n-      date: \"01/01/2024\",\r\n-      total: \"1,200,000đ\",\r\n-      status: \"Đã giao hàng\",\r\n-      payment: \"Đã thanh toán\"\r\n-    },\r\n-    {\r\n-      id: \"DH-002\",\r\n-      customer: \"Trần Thị B\",\r\n-      date: \"02/01/2024\",\r\n-      total: \"850,000đ\",\r\n-      status: \"Đang giao hàng\",\r\n-      payment: \"Đã thanh toán\"\r\n-    },\r\n-    {\r\n-      id: \"DH-003\",\r\n-      customer: \"Lê Văn C\",\r\n-      date: \"03/01/2024\",\r\n-      total: \"2,300,000đ\",\r\n-      status: \"Chờ xác nhận\",\r\n-      payment: \"Chưa thanh toán\"\r\n-    }\r\n-  ]);\r\n+  const [orders, setOrders] = useState([]);\r\n+  const [loading, setLoading] = useState(true);\r\n \r\n+  useEffect(() => {\r\n+    const fetchOrders = async () => {\r\n+      try {\r\n+        const response = await fetch('/api/admin/orders');\r\n+        const data = await response.json();\r\n+        if (data.ok) {\r\n+          setOrders(data.orders);\r\n+        }\r\n+      } catch (error) {\r\n+        console.error('Error fetching orders:', error);\r\n+      } finally {\r\n+        setLoading(false);\r\n+      }\r\n+    };\r\n+\r\n+    fetchOrders();\r\n+  }, []);\r\n+\r\n+  const formatDate = (date) => {\r\n+    return new Date(date).toLocaleDateString('vi-VN', {\r\n+      day: '2-digit',\r\n+      month: '2-digit',\r\n+      year: 'numeric',\r\n+      hour: '2-digit',\r\n+      minute: '2-digit'\r\n+    });\r\n+  };\r\n+\r\n+  const formatPrice = (price) => {\r\n+    return price.toLocaleString('vi-VN') + ' VND';\r\n+  };\r\n+\r\n+  if (loading) {\r\n+    return (\r\n+      <div className=\"min-h-screen flex items-center justify-center\">\r\n+        <p>Đang tải...</p>\r\n+      </div>\r\n+    );\r\n+  }\r\n+\r\n   return (\r\n     <div className=\"space-y-6\">\r\n       {/* Header */}\r\n       <div className=\"flex justify-between items-center\">\r\n@@ -38,100 +54,85 @@\n         <div className=\"flex space-x-4\">\r\n           <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n             Xuất báo cáo\r\n           </button>\r\n-          <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n-            Thêm đơn hàng\r\n-          </button>\r\n         </div>\r\n       </div>\r\n \r\n       {/* Orders Table */}\r\n-      <motion.div\r\n-        initial={{ opacity: 0, y: 20 }}\r\n-        animate={{ opacity: 1, y: 0 }}\r\n-        transition={{ duration: 0.5 }}\r\n-        className=\"bg-white rounded-lg shadow\"\r\n-      >\r\n-        <div className=\"overflow-x-auto\">\r\n-          <table className=\"min-w-full divide-y divide-gray-200\">\r\n-            <thead className=\"bg-gray-50\">\r\n-              <tr>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Mã đơn hàng\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Khách hàng\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Ngày đặt\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Tổng tiền\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Trạng thái\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Thanh toán\r\n-                </th>\r\n-                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                  Thao tác\r\n-                </th>\r\n+      <div className=\"bg-white shadow-md rounded-lg overflow-hidden\">\r\n+        <table className=\"min-w-full divide-y divide-gray-200\">\r\n+          <thead className=\"bg-gray-50\">\r\n+            <tr>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Mã đơn hàng\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Khách hàng\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Ngày đặt\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Tổng tiền\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Trạng thái\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Thanh toán\r\n+              </th>\r\n+            </tr>\r\n+          </thead>\r\n+          <tbody className=\"bg-white divide-y divide-gray-200\">\r\n+            {orders.map((order) => (\r\n+              <tr key={order._id}>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n+                  {order.orderCode}\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  {order.fullName}\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  {formatDate(order.createdAt)}\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  {formatPrice(order.total)}\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n+                  <span\r\n+                    className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n+                      order.status === \"delivered\"\r\n+                        ? \"bg-green-100 text-green-800\"\r\n+                        : order.status === \"shipped\"\r\n+                        ? \"bg-blue-100 text-blue-800\"\r\n+                        : \"bg-yellow-100 text-yellow-800\"\r\n+                    }`}\r\n+                  >\r\n+                    {order.status === \"pending\" ? \"Chờ xác nhận\" :\r\n+                     order.status === \"processing\" ? \"Đang xử lý\" :\r\n+                     order.status === \"shipped\" ? \"Đang giao hàng\" :\r\n+                     order.status === \"delivered\" ? \"Đã giao hàng\" :\r\n+                     order.status === \"cancelled\" ? \"Đã hủy\" : order.status}\r\n+                  </span>\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n+                  <span\r\n+                    className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n+                      order.paymentStatus === \"paid\"\r\n+                        ? \"bg-green-100 text-green-800\"\r\n+                        : \"bg-red-100 text-red-800\"\r\n+                    }`}\r\n+                  >\r\n+                    {order.paymentStatus === \"paid\" ? \"Đã thanh toán\" :\r\n+                     order.paymentStatus === \"pending\" ? \"Chưa thanh toán\" :\r\n+                     order.paymentStatus === \"failed\" ? \"Thanh toán thất bại\" : order.paymentStatus}\r\n+                  </span>\r\n+                </td>\r\n               </tr>\r\n-            </thead>\r\n-            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n-              {orders.map((order) => (\r\n-                <tr key={order.id}>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n-                    {order.id}\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                    {order.customer}\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                    {order.date}\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                    {order.total}\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n-                    <span\r\n-                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n-                        order.status === \"Đã giao hàng\"\r\n-                          ? \"bg-green-100 text-green-800\"\r\n-                          : order.status === \"Đang giao hàng\"\r\n-                          ? \"bg-blue-100 text-blue-800\"\r\n-                          : \"bg-yellow-100 text-yellow-800\"\r\n-                      }`}\r\n-                    >\r\n-                      {order.status}\r\n-                    </span>\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n-                    <span\r\n-                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n-                        order.payment === \"Đã thanh toán\"\r\n-                          ? \"bg-green-100 text-green-800\"\r\n-                          : \"bg-red-100 text-red-800\"\r\n-                      }`}\r\n-                    >\r\n-                      {order.payment}\r\n-                    </span>\r\n-                  </td>\r\n-                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                    <button className=\"text-blue-600 hover:text-blue-900 mr-4\">\r\n-                      Chi tiết\r\n-                    </button>\r\n-                    <button className=\"text-red-600 hover:text-red-900\">\r\n-                      Hủy\r\n-                    </button>\r\n-                  </td>\r\n-                </tr>\r\n-              ))}\r\n-            </tbody>\r\n-          </table>\r\n-        </div>\r\n-      </motion.div>\r\n+            ))}\r\n+          </tbody>\r\n+        </table>\r\n+      </div>\r\n     </div>\r\n   );\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1747061617936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     );\r\n   }\r\n \r\n   return (\r\n-    <div className=\"space-y-6\">\r\n+    <div className=\"space-y-6 mt-8\">\r\n       {/* Header */}\r\n       <div className=\"flex justify-between items-center\">\r\n         <h1 className=\"text-2xl font-light text-black\">Quản lý đơn hàng</h1>\r\n         <div className=\"flex space-x-4\">\r\n"
                },
                {
                    "date": 1747061644849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     );\r\n   }\r\n \r\n   return (\r\n-    <div className=\"space-y-6 mt-8\">\r\n+    <div className=\"space-y-6 mt-12\">\r\n       {/* Header */}\r\n       <div className=\"flex justify-between items-center\">\r\n         <h1 className=\"text-2xl font-light text-black\">Quản lý đơn hàng</h1>\r\n         <div className=\"flex space-x-4\">\r\n"
                },
                {
                    "date": 1747061847617,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,20 +100,35 @@\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                   <span\r\n                     className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n-                      order.status === \"delivered\"\r\n+                      order.status === \"success\"\r\n                         ? \"bg-green-100 text-green-800\"\r\n-                        : order.status === \"shipped\"\r\n+                        : order.status === \"shipping\"\r\n                         ? \"bg-blue-100 text-blue-800\"\r\n-                        : \"bg-yellow-100 text-yellow-800\"\r\n+                        : order.status === \"packed\"\r\n+                        ? \"bg-purple-100 text-purple-800\"\r\n+                        : order.status === \"confirmed\"\r\n+                        ? \"bg-yellow-100 text-yellow-800\"\r\n+                        : order.status === \"failed\" || order.status === \"customer_cancelled\" || order.status === \"hvc_cancelled\"\r\n+                        ? \"bg-red-100 text-red-800\"\r\n+                        : order.status === \"refunding\"\r\n+                        ? \"bg-orange-100 text-orange-800\"\r\n+                        : order.status === \"refunded\"\r\n+                        ? \"bg-gray-100 text-gray-800\"\r\n+                        : \"bg-gray-100 text-gray-800\"\r\n                     }`}\r\n                   >\r\n                     {order.status === \"pending\" ? \"Chờ xác nhận\" :\r\n-                     order.status === \"processing\" ? \"Đang xử lý\" :\r\n-                     order.status === \"shipped\" ? \"Đang giao hàng\" :\r\n-                     order.status === \"delivered\" ? \"Đã giao hàng\" :\r\n-                     order.status === \"cancelled\" ? \"Đã hủy\" : order.status}\r\n+                     order.status === \"confirmed\" ? \"Đã xác nhận\" :\r\n+                     order.status === \"packed\" ? \"Đã đóng gói\" :\r\n+                     order.status === \"shipping\" ? \"Đang vận chuyển\" :\r\n+                     order.status === \"success\" ? \"Thành công\" :\r\n+                     order.status === \"failed\" ? \"Thất bại\" :\r\n+                     order.status === \"customer_cancelled\" ? \"Khách hủy\" :\r\n+                     order.status === \"hvc_cancelled\" ? \"HVC hủy\" :\r\n+                     order.status === \"refunding\" ? \"Đang hoàn\" :\r\n+                     order.status === \"refunded\" ? \"Đã hoàn\" : order.status}\r\n                   </span>\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                   <span\r\n"
                },
                {
                    "date": 1747061903311,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,21 @@\n export default function Orders() {\r\n   const [orders, setOrders] = useState([]);\r\n   const [loading, setLoading] = useState(true);\r\n \r\n+  const orderStatuses = [\r\n+    { value: \"pending\", label: \"Chờ xác nhận\" },\r\n+    { value: \"confirmed\", label: \"Đã xác nhận\" },\r\n+    { value: \"packed\", label: \"Đã đóng gói\" },\r\n+    { value: \"shipping\", label: \"Đang vận chuyển\" },\r\n+    { value: \"success\", label: \"Thành công\" },\r\n+    { value: \"failed\", label: \"Thất bại\" },\r\n+    { value: \"customer_cancelled\", label: \"Khách hủy\" },\r\n+    { value: \"hvc_cancelled\", label: \"HVC hủy\" },\r\n+    { value: \"refunding\", label: \"Đang hoàn\" },\r\n+    { value: \"refunded\", label: \"Đã hoàn\" }\r\n+  ];\r\n+\r\n   useEffect(() => {\r\n     const fetchOrders = async () => {\r\n       try {\r\n         const response = await fetch('/api/admin/orders');\r\n@@ -23,8 +36,31 @@\n \r\n     fetchOrders();\r\n   }, []);\r\n \r\n+  const handleStatusChange = async (orderId, newStatus) => {\r\n+    try {\r\n+      const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n+        method: 'PATCH',\r\n+        headers: {\r\n+          'Content-Type': 'application/json',\r\n+        },\r\n+        body: JSON.stringify({ status: newStatus }),\r\n+      });\r\n+\r\n+      if (response.ok) {\r\n+        // Cập nhật trạng thái trong state\r\n+        setOrders(orders.map(order => \r\n+          order._id === orderId ? { ...order, status: newStatus } : order\r\n+        ));\r\n+      } else {\r\n+        console.error('Failed to update order status');\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('Error updating order status:', error);\r\n+    }\r\n+  };\r\n+\r\n   const formatDate = (date) => {\r\n     return new Date(date).toLocaleDateString('vi-VN', {\r\n       day: '2-digit',\r\n       month: '2-digit',\r\n@@ -37,8 +73,36 @@\n   const formatPrice = (price) => {\r\n     return price.toLocaleString('vi-VN') + ' VND';\r\n   };\r\n \r\n+  const getStatusColor = (status) => {\r\n+    switch (status) {\r\n+      case \"success\":\r\n+        return \"bg-green-100 text-green-800\";\r\n+      case \"shipping\":\r\n+        return \"bg-blue-100 text-blue-800\";\r\n+      case \"packed\":\r\n+        return \"bg-purple-100 text-purple-800\";\r\n+      case \"confirmed\":\r\n+        return \"bg-yellow-100 text-yellow-800\";\r\n+      case \"failed\":\r\n+      case \"customer_cancelled\":\r\n+      case \"hvc_cancelled\":\r\n+        return \"bg-red-100 text-red-800\";\r\n+      case \"refunding\":\r\n+        return \"bg-orange-100 text-orange-800\";\r\n+      case \"refunded\":\r\n+        return \"bg-gray-100 text-gray-800\";\r\n+      default:\r\n+        return \"bg-gray-100 text-gray-800\";\r\n+    }\r\n+  };\r\n+\r\n+  const getStatusLabel = (status) => {\r\n+    const statusObj = orderStatuses.find(s => s.value === status);\r\n+    return statusObj ? statusObj.label : status;\r\n+  };\r\n+\r\n   if (loading) {\r\n     return (\r\n       <div className=\"min-h-screen flex items-center justify-center\">\r\n         <p>Đang tải...</p>\r\n@@ -98,38 +162,19 @@\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                   {formatPrice(order.total)}\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n-                  <span\r\n-                    className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n-                      order.status === \"success\"\r\n-                        ? \"bg-green-100 text-green-800\"\r\n-                        : order.status === \"shipping\"\r\n-                        ? \"bg-blue-100 text-blue-800\"\r\n-                        : order.status === \"packed\"\r\n-                        ? \"bg-purple-100 text-purple-800\"\r\n-                        : order.status === \"confirmed\"\r\n-                        ? \"bg-yellow-100 text-yellow-800\"\r\n-                        : order.status === \"failed\" || order.status === \"customer_cancelled\" || order.status === \"hvc_cancelled\"\r\n-                        ? \"bg-red-100 text-red-800\"\r\n-                        : order.status === \"refunding\"\r\n-                        ? \"bg-orange-100 text-orange-800\"\r\n-                        : order.status === \"refunded\"\r\n-                        ? \"bg-gray-100 text-gray-800\"\r\n-                        : \"bg-gray-100 text-gray-800\"\r\n-                    }`}\r\n+                  <select\r\n+                    value={order.status}\r\n+                    onChange={(e) => handleStatusChange(order._id, e.target.value)}\r\n+                    className={`px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(order.status)} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black`}\r\n                   >\r\n-                    {order.status === \"pending\" ? \"Chờ xác nhận\" :\r\n-                     order.status === \"confirmed\" ? \"Đã xác nhận\" :\r\n-                     order.status === \"packed\" ? \"Đã đóng gói\" :\r\n-                     order.status === \"shipping\" ? \"Đang vận chuyển\" :\r\n-                     order.status === \"success\" ? \"Thành công\" :\r\n-                     order.status === \"failed\" ? \"Thất bại\" :\r\n-                     order.status === \"customer_cancelled\" ? \"Khách hủy\" :\r\n-                     order.status === \"hvc_cancelled\" ? \"HVC hủy\" :\r\n-                     order.status === \"refunding\" ? \"Đang hoàn\" :\r\n-                     order.status === \"refunded\" ? \"Đã hoàn\" : order.status}\r\n-                  </span>\r\n+                    {orderStatuses.map((status) => (\r\n+                      <option key={status.value} value={status.value}>\r\n+                        {status.label}\r\n+                      </option>\r\n+                    ))}\r\n+                  </select>\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                   <span\r\n                     className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n"
                },
                {
                    "date": 1747062013265,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,14 @@\n     { value: \"refunding\", label: \"Đang hoàn\" },\r\n     { value: \"refunded\", label: \"Đã hoàn\" }\r\n   ];\r\n \r\n+  const paymentStatuses = [\r\n+    { value: \"paid\", label: \"Đã thanh toán\" },\r\n+    { value: \"pending\", label: \"Chưa thanh toán\" },\r\n+    { value: \"failed\", label: \"Thanh toán thất bại\" }\r\n+  ];\r\n+\r\n   useEffect(() => {\r\n     const fetchOrders = async () => {\r\n       try {\r\n         const response = await fetch('/api/admin/orders');\r\n@@ -59,8 +65,30 @@\n       console.error('Error updating order status:', error);\r\n     }\r\n   };\r\n \r\n+  const handlePaymentStatusChange = async (orderId, newPaymentStatus) => {\r\n+    try {\r\n+      const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n+        method: 'PATCH',\r\n+        headers: {\r\n+          'Content-Type': 'application/json',\r\n+        },\r\n+        body: JSON.stringify({ paymentStatus: newPaymentStatus }),\r\n+      });\r\n+\r\n+      if (response.ok) {\r\n+        setOrders(orders.map(order => \r\n+          order._id === orderId ? { ...order, paymentStatus: newPaymentStatus } : order\r\n+        ));\r\n+      } else {\r\n+        console.error('Failed to update payment status');\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('Error updating payment status:', error);\r\n+    }\r\n+  };\r\n+\r\n   const formatDate = (date) => {\r\n     return new Date(date).toLocaleDateString('vi-VN', {\r\n       day: '2-digit',\r\n       month: '2-digit',\r\n@@ -96,8 +124,19 @@\n         return \"bg-gray-100 text-gray-800\";\r\n     }\r\n   };\r\n \r\n+  const getPaymentStatusColor = (status) => {\r\n+    switch (status) {\r\n+      case \"paid\":\r\n+        return \"bg-green-100 text-green-800\";\r\n+      case \"failed\":\r\n+        return \"bg-red-100 text-red-800\";\r\n+      default:\r\n+        return \"bg-yellow-100 text-yellow-800\";\r\n+    }\r\n+  };\r\n+\r\n   const getStatusLabel = (status) => {\r\n     const statusObj = orderStatuses.find(s => s.value === status);\r\n     return statusObj ? statusObj.label : status;\r\n   };\r\n@@ -175,19 +214,19 @@\n                     ))}\r\n                   </select>\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n-                  <span\r\n-                    className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n-                      order.paymentStatus === \"paid\"\r\n-                        ? \"bg-green-100 text-green-800\"\r\n-                        : \"bg-red-100 text-red-800\"\r\n-                    }`}\r\n+                  <select\r\n+                    value={order.paymentStatus}\r\n+                    onChange={(e) => handlePaymentStatusChange(order._id, e.target.value)}\r\n+                    className={`px-2 py-1 text-xs font-semibold rounded-full ${getPaymentStatusColor(order.paymentStatus)} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black`}\r\n                   >\r\n-                    {order.paymentStatus === \"paid\" ? \"Đã thanh toán\" :\r\n-                     order.paymentStatus === \"pending\" ? \"Chưa thanh toán\" :\r\n-                     order.paymentStatus === \"failed\" ? \"Thanh toán thất bại\" : order.paymentStatus}\r\n-                  </span>\r\n+                    {paymentStatuses.map((status) => (\r\n+                      <option key={status.value} value={status.value}>\r\n+                        {status.label}\r\n+                      </option>\r\n+                    ))}\r\n+                  </select>\r\n                 </td>\r\n               </tr>\r\n             ))}\r\n           </tbody>\r\n"
                },
                {
                    "date": 1747062054849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,9 @@\n   return (\r\n     <div className=\"space-y-6 mt-12\">\r\n       {/* Header */}\r\n       <div className=\"flex justify-between items-center\">\r\n-        <h1 className=\"text-2xl font-light text-black\">Quản lý đơn hàng</h1>\r\n+        <h1 className=\"text-2xl font-bold text-black\">Quản lý đơn hàng</h1>\r\n         <div className=\"flex space-x-4\">\r\n           <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n             Xuất báo cáo\r\n           </button>\r\n"
                },
                {
                    "date": 1747062087633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,13 +153,8 @@\n     <div className=\"space-y-6 mt-12\">\r\n       {/* Header */}\r\n       <div className=\"flex justify-between items-center\">\r\n         <h1 className=\"text-2xl font-bold text-black\">Quản lý đơn hàng</h1>\r\n-        <div className=\"flex space-x-4\">\r\n-          <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n-            Xuất báo cáo\r\n-          </button>\r\n-        </div>\r\n       </div>\r\n \r\n       {/* Orders Table */}\r\n       <div className=\"bg-white shadow-md rounded-lg overflow-hidden\">\r\n"
                },
                {
                    "date": 1747062661368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,13 @@\n \"use client\";\r\n import { useState, useEffect } from \"react\";\r\n import { motion } from \"framer-motion\";\r\n+import { useRouter } from \"next/navigation\";\r\n \r\n export default function Orders() {\r\n   const [orders, setOrders] = useState([]);\r\n   const [loading, setLoading] = useState(true);\r\n+  const router = useRouter();\r\n \r\n   const orderStatuses = [\r\n     { value: \"pending\", label: \"Chờ xác nhận\" },\r\n     { value: \"confirmed\", label: \"Đã xác nhận\" },\r\n@@ -24,23 +26,22 @@\n     { value: \"pending\", label: \"Chưa thanh toán\" },\r\n     { value: \"failed\", label: \"Thanh toán thất bại\" }\r\n   ];\r\n \r\n+  const fetchOrders = async () => {\r\n+    try {\r\n+      const response = await fetch('/api/admin/orders');\r\n+      if (!response.ok) throw new Error('Failed to fetch orders');\r\n+      const data = await response.json();\r\n+      setOrders(data.orders);\r\n+    } catch (error) {\r\n+      console.error('Error fetching orders:', error);\r\n+    } finally {\r\n+      setLoading(false);\r\n+    }\r\n+  };\r\n+\r\n   useEffect(() => {\r\n-    const fetchOrders = async () => {\r\n-      try {\r\n-        const response = await fetch('/api/admin/orders');\r\n-        const data = await response.json();\r\n-        if (data.ok) {\r\n-          setOrders(data.orders);\r\n-        }\r\n-      } catch (error) {\r\n-        console.error('Error fetching orders:', error);\r\n-      } finally {\r\n-        setLoading(false);\r\n-      }\r\n-    };\r\n-\r\n     fetchOrders();\r\n   }, []);\r\n \r\n   const handleStatusChange = async (orderId, newStatus) => {\r\n@@ -52,43 +53,55 @@\n         },\r\n         body: JSON.stringify({ status: newStatus }),\r\n       });\r\n \r\n-      if (response.ok) {\r\n-        // Cập nhật trạng thái trong state\r\n-        setOrders(orders.map(order => \r\n-          order._id === orderId ? { ...order, status: newStatus } : order\r\n-        ));\r\n-      } else {\r\n-        console.error('Failed to update order status');\r\n-      }\r\n+      if (!response.ok) throw new Error('Failed to update status');\r\n+      \r\n+      // Refresh orders after update\r\n+      fetchOrders();\r\n     } catch (error) {\r\n-      console.error('Error updating order status:', error);\r\n+      console.error('Error updating status:', error);\r\n     }\r\n   };\r\n \r\n-  const handlePaymentStatusChange = async (orderId, newPaymentStatus) => {\r\n+  const handlePaymentStatusChange = async (orderId, newStatus) => {\r\n     try {\r\n       const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n         method: 'PATCH',\r\n         headers: {\r\n           'Content-Type': 'application/json',\r\n         },\r\n-        body: JSON.stringify({ paymentStatus: newPaymentStatus }),\r\n+        body: JSON.stringify({ paymentStatus: newStatus }),\r\n       });\r\n \r\n-      if (response.ok) {\r\n-        setOrders(orders.map(order => \r\n-          order._id === orderId ? { ...order, paymentStatus: newPaymentStatus } : order\r\n-        ));\r\n-      } else {\r\n-        console.error('Failed to update payment status');\r\n-      }\r\n+      if (!response.ok) throw new Error('Failed to update payment status');\r\n+      \r\n+      // Refresh orders after update\r\n+      fetchOrders();\r\n     } catch (error) {\r\n       console.error('Error updating payment status:', error);\r\n     }\r\n   };\r\n \r\n+  const handleDeleteOrder = async (orderId) => {\r\n+    if (!window.confirm('Bạn có chắc chắn muốn xóa đơn hàng này?')) {\r\n+      return;\r\n+    }\r\n+\r\n+    try {\r\n+      const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n+        method: 'DELETE',\r\n+      });\r\n+\r\n+      if (!response.ok) throw new Error('Failed to delete order');\r\n+      \r\n+      // Refresh orders after deletion\r\n+      fetchOrders();\r\n+    } catch (error) {\r\n+      console.error('Error deleting order:', error);\r\n+    }\r\n+  };\r\n+\r\n   const formatDate = (date) => {\r\n     return new Date(date).toLocaleDateString('vi-VN', {\r\n       day: '2-digit',\r\n       month: '2-digit',\r\n@@ -178,8 +191,11 @@\n               </th>\r\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Thanh toán\r\n               </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Thao tác\r\n+              </th>\r\n             </tr>\r\n           </thead>\r\n           <tbody className=\"bg-white divide-y divide-gray-200\">\r\n             {orders.map((order) => (\r\n@@ -221,8 +237,16 @@\n                       </option>\r\n                     ))}\r\n                   </select>\r\n                 </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  <button\r\n+                    onClick={() => handleDeleteOrder(order._id)}\r\n+                    className=\"text-red-600 hover:text-red-900\"\r\n+                  >\r\n+                    Xóa\r\n+                  </button>\r\n+                </td>\r\n               </tr>\r\n             ))}\r\n           </tbody>\r\n         </table>\r\n"
                },
                {
                    "date": 1747063940625,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,23 +82,29 @@\n     }\r\n   };\r\n \r\n   const handleDeleteOrder = async (orderId) => {\r\n-    if (!window.confirm('Bạn có chắc chắn muốn xóa đơn hàng này?')) {\r\n+    if (!confirm('Bạn có chắc chắn muốn xóa đơn hàng này?')) {\r\n       return;\r\n     }\r\n \r\n     try {\r\n       const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n         method: 'DELETE',\r\n       });\r\n \r\n-      if (!response.ok) throw new Error('Failed to delete order');\r\n-      \r\n-      // Refresh orders after deletion\r\n-      fetchOrders();\r\n+      const data = await response.json();\r\n+\r\n+      if (!response.ok) {\r\n+        throw new Error(data.message || 'Không thể xóa đơn hàng');\r\n+      }\r\n+\r\n+      // Cập nhật lại danh sách đơn hàng sau khi xóa thành công\r\n+      setOrders(orders.filter(order => order._id !== orderId));\r\n+      alert('Xóa đơn hàng thành công');\r\n     } catch (error) {\r\n       console.error('Error deleting order:', error);\r\n+      alert(error.message || 'Có lỗi xảy ra khi xóa đơn hàng. Vui lòng thử lại.');\r\n     }\r\n   };\r\n \r\n   const formatDate = (date) => {\r\n"
                },
                {
                    "date": 1747064019233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,13 +89,15 @@\n \r\n     try {\r\n       const response = await fetch(`/api/admin/orders/${orderId}`, {\r\n         method: 'DELETE',\r\n+        headers: {\r\n+          'Content-Type': 'application/json',\r\n+        },\r\n       });\r\n \r\n-      const data = await response.json();\r\n-\r\n       if (!response.ok) {\r\n+        const data = await response.json();\r\n         throw new Error(data.message || 'Không thể xóa đơn hàng');\r\n       }\r\n \r\n       // Cập nhật lại danh sách đơn hàng sau khi xóa thành công\r\n"
                },
                {
                    "date": 1747110946376,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -194,8 +194,14 @@\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Tổng tiền\r\n               </th>\r\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Sản phẩm\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n+                Địa chỉ\r\n+              </th>\r\n+              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Trạng thái\r\n               </th>\r\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Thanh toán\r\n@@ -219,8 +225,20 @@\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                   {formatPrice(order.total)}\r\n                 </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  <ul className=\"list-disc pl-4\">\r\n+                    {order.items && order.items.map((item, idx) => (\r\n+                      <li key={idx}>\r\n+                        <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity})\r\n+                      </li>\r\n+                    ))}\r\n+                  </ul>\r\n+                </td>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n+                  {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}\r\n+                </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                   <select\r\n                     value={order.status}\r\n                     onChange={(e) => handleStatusChange(order._id, e.target.value)}\r\n"
                },
                {
                    "date": 1747110990890,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -194,14 +194,8 @@\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Tổng tiền\r\n               </th>\r\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                Sản phẩm\r\n-              </th>\r\n-              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n-                Địa chỉ\r\n-              </th>\r\n-              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Trạng thái\r\n               </th>\r\n               <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                 Thanh toán\r\n@@ -225,20 +219,8 @@\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                   {formatPrice(order.total)}\r\n                 </td>\r\n-                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                  <ul className=\"list-disc pl-4\">\r\n-                    {order.items && order.items.map((item, idx) => (\r\n-                      <li key={idx}>\r\n-                        <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity})\r\n-                      </li>\r\n-                    ))}\r\n-                  </ul>\r\n-                </td>\r\n-                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n-                  {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}\r\n-                </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                   <select\r\n                     value={order.status}\r\n                     onChange={(e) => handleStatusChange(order._id, e.target.value)}\r\n"
                },
                {
                    "date": 1747111169424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,15 @@\n \"use client\";\r\n import { useState, useEffect } from \"react\";\r\n import { motion } from \"framer-motion\";\r\n import { useRouter } from \"next/navigation\";\r\n+import React from \"react\";\r\n \r\n export default function Orders() {\r\n   const [orders, setOrders] = useState([]);\r\n   const [loading, setLoading] = useState(true);\r\n+  const [selectedOrder, setSelectedOrder] = useState(null);\r\n+  const [showModal, setShowModal] = useState(false);\r\n   const router = useRouter();\r\n \r\n   const orderStatuses = [\r\n     { value: \"pending\", label: \"Chờ xác nhận\" },\r\n@@ -207,9 +210,9 @@\n           </thead>\r\n           <tbody className=\"bg-white divide-y divide-gray-200\">\r\n             {orders.map((order) => (\r\n               <tr key={order._id}>\r\n-                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 cursor-pointer underline hover:text-blue-600\" onClick={() => { setSelectedOrder(order); setShowModal(true); }}>\r\n                   {order.orderCode}\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                   {order.fullName}\r\n@@ -258,7 +261,40 @@\n             ))}\r\n           </tbody>\r\n         </table>\r\n       </div>\r\n+\r\n+      {/* Modal hiển thị chi tiết đơn hàng */}\r\n+      {showModal && selectedOrder && (\r\n+        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40\">\r\n+          <div className=\"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative\">\r\n+            <button onClick={() => setShowModal(false)} className=\"absolute top-2 right-2 text-gray-500 hover:text-black text-xl\">×</button>\r\n+            <h2 className=\"text-lg font-bold mb-4\">Chi tiết đơn hàng: {selectedOrder.orderCode}</h2>\r\n+            <div className=\"mb-3\">\r\n+              <b>Khách hàng:</b> {selectedOrder.fullName}<br/>\r\n+              <b>Địa chỉ:</b> {[selectedOrder.address, selectedOrder.apartment, selectedOrder.ward, selectedOrder.district, selectedOrder.province].filter(Boolean).join(\", \")}<br/>\r\n+              <b>Số điện thoại:</b> {selectedOrder.phone}\r\n+            </div>\r\n+            <div className=\"mb-3\">\r\n+              <b>Sản phẩm:</b>\r\n+              <ul className=\"list-disc pl-5 mt-1\">\r\n+                {selectedOrder.items && selectedOrder.items.map((item, idx) => (\r\n+                  <li key={idx}>\r\n+                    <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity}, Giá: {item.price?.toLocaleString('vi-VN')} VND)\r\n+                  </li>\r\n+                ))}\r\n+              </ul>\r\n+            </div>\r\n+            {selectedOrder.promoCode && (\r\n+              <div className=\"mb-2\">\r\n+                <b>Mã giảm giá:</b> {selectedOrder.promoCode} (-{selectedOrder.promoAmount?.toLocaleString('vi-VN')} VND)\r\n+              </div>\r\n+            )}\r\n+            <div>\r\n+              <b>Tổng tiền:</b> {selectedOrder.total?.toLocaleString('vi-VN')} VND\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n     </div>\r\n   );\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1747111247805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n   const [orders, setOrders] = useState([]);\r\n   const [loading, setLoading] = useState(true);\r\n   const [selectedOrder, setSelectedOrder] = useState(null);\r\n   const [showModal, setShowModal] = useState(false);\r\n+  const [expandedOrderId, setExpandedOrderId] = useState(null);\r\n   const router = useRouter();\r\n \r\n   const orderStatuses = [\r\n     { value: \"pending\", label: \"Chờ xác nhận\" },\r\n@@ -210,9 +211,9 @@\n           </thead>\r\n           <tbody className=\"bg-white divide-y divide-gray-200\">\r\n             {orders.map((order) => (\r\n               <tr key={order._id}>\r\n-                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 cursor-pointer underline hover:text-blue-600\" onClick={() => { setSelectedOrder(order); setShowModal(true); }}>\r\n+                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 cursor-pointer underline hover:text-blue-600\" onClick={() => setExpandedOrderId(expandedOrderId === order._id ? null : order._id)}>\r\n                   {order.orderCode}\r\n                 </td>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                   {order.fullName}\r\n@@ -257,44 +258,40 @@\n                     Xóa\r\n                   </button>\r\n                 </td>\r\n               </tr>\r\n+              {expandedOrderId === order._id && (\r\n+                <tr>\r\n+                  <td colSpan={8} className=\"bg-gray-50 px-6 py-4\">\r\n+                    <div className=\"mb-2\">\r\n+                      <b>Khách hàng:</b> {order.fullName}<br/>\r\n+                      <b>Địa chỉ:</b> {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}<br/>\r\n+                      <b>Số điện thoại:</b> {order.phone}\r\n+                    </div>\r\n+                    <div className=\"mb-2\">\r\n+                      <b>Sản phẩm:</b>\r\n+                      <ul className=\"list-disc pl-5 mt-1\">\r\n+                        {order.items && order.items.map((item, idx) => (\r\n+                          <li key={idx}>\r\n+                            <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity}, Giá: {item.price?.toLocaleString('vi-VN')} VND)\r\n+                          </li>\r\n+                        ))}\r\n+                      </ul>\r\n+                    </div>\r\n+                    {order.promoCode && (\r\n+                      <div className=\"mb-2\">\r\n+                        <b>Mã giảm giá:</b> {order.promoCode} (-{order.promoAmount?.toLocaleString('vi-VN')} VND)\r\n+                      </div>\r\n+                    )}\r\n+                    <div>\r\n+                      <b>Tổng tiền:</b> {order.total?.toLocaleString('vi-VN')} VND\r\n+                    </div>\r\n+                  </td>\r\n+                </tr>\r\n+              )}\r\n             ))}\r\n           </tbody>\r\n         </table>\r\n       </div>\r\n-\r\n-      {/* Modal hiển thị chi tiết đơn hàng */}\r\n-      {showModal && selectedOrder && (\r\n-        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40\">\r\n-          <div className=\"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative\">\r\n-            <button onClick={() => setShowModal(false)} className=\"absolute top-2 right-2 text-gray-500 hover:text-black text-xl\">×</button>\r\n-            <h2 className=\"text-lg font-bold mb-4\">Chi tiết đơn hàng: {selectedOrder.orderCode}</h2>\r\n-            <div className=\"mb-3\">\r\n-              <b>Khách hàng:</b> {selectedOrder.fullName}<br/>\r\n-              <b>Địa chỉ:</b> {[selectedOrder.address, selectedOrder.apartment, selectedOrder.ward, selectedOrder.district, selectedOrder.province].filter(Boolean).join(\", \")}<br/>\r\n-              <b>Số điện thoại:</b> {selectedOrder.phone}\r\n-            </div>\r\n-            <div className=\"mb-3\">\r\n-              <b>Sản phẩm:</b>\r\n-              <ul className=\"list-disc pl-5 mt-1\">\r\n-                {selectedOrder.items && selectedOrder.items.map((item, idx) => (\r\n-                  <li key={idx}>\r\n-                    <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity}, Giá: {item.price?.toLocaleString('vi-VN')} VND)\r\n-                  </li>\r\n-                ))}\r\n-              </ul>\r\n-            </div>\r\n-            {selectedOrder.promoCode && (\r\n-              <div className=\"mb-2\">\r\n-                <b>Mã giảm giá:</b> {selectedOrder.promoCode} (-{selectedOrder.promoAmount?.toLocaleString('vi-VN')} VND)\r\n-              </div>\r\n-            )}\r\n-            <div>\r\n-              <b>Tổng tiền:</b> {selectedOrder.total?.toLocaleString('vi-VN')} VND\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n     </div>\r\n   );\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1747111277816,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -209,9 +209,9 @@\n               </th>\r\n             </tr>\r\n           </thead>\r\n           <tbody className=\"bg-white divide-y divide-gray-200\">\r\n-            {orders.map((order) => (\r\n+            {orders.map((order) => [\r\n               <tr key={order._id}>\r\n                 <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 cursor-pointer underline hover:text-blue-600\" onClick={() => setExpandedOrderId(expandedOrderId === order._id ? null : order._id)}>\r\n                   {order.orderCode}\r\n                 </td>\r\n@@ -257,11 +257,11 @@\n                   >\r\n                     Xóa\r\n                   </button>\r\n                 </td>\r\n-              </tr>\r\n-              {expandedOrderId === order._id && (\r\n-                <tr>\r\n+              </tr>,\r\n+              expandedOrderId === order._id && (\r\n+                <tr key={order._id + '-expand'}>\r\n                   <td colSpan={8} className=\"bg-gray-50 px-6 py-4\">\r\n                     <div className=\"mb-2\">\r\n                       <b>Khách hàng:</b> {order.fullName}<br/>\r\n                       <b>Địa chỉ:</b> {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}<br/>\r\n@@ -286,10 +286,10 @@\n                       <b>Tổng tiền:</b> {order.total?.toLocaleString('vi-VN')} VND\r\n                     </div>\r\n                   </td>\r\n                 </tr>\r\n-              )}\r\n-            ))}\r\n+              )\r\n+            ])}\r\n           </tbody>\r\n         </table>\r\n       </div>\r\n     </div>\r\n"
                },
                {
                    "date": 1747111359582,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -260,31 +260,35 @@\n                 </td>\r\n               </tr>,\r\n               expandedOrderId === order._id && (\r\n                 <tr key={order._id + '-expand'}>\r\n-                  <td colSpan={8} className=\"bg-gray-50 px-6 py-4\">\r\n-                    <div className=\"mb-2\">\r\n-                      <b>Khách hàng:</b> {order.fullName}<br/>\r\n-                      <b>Địa chỉ:</b> {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}<br/>\r\n-                      <b>Số điện thoại:</b> {order.phone}\r\n-                    </div>\r\n-                    <div className=\"mb-2\">\r\n-                      <b>Sản phẩm:</b>\r\n-                      <ul className=\"list-disc pl-5 mt-1\">\r\n-                        {order.items && order.items.map((item, idx) => (\r\n-                          <li key={idx}>\r\n-                            <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity}, Giá: {item.price?.toLocaleString('vi-VN')} VND)\r\n-                          </li>\r\n-                        ))}\r\n-                      </ul>\r\n-                    </div>\r\n-                    {order.promoCode && (\r\n-                      <div className=\"mb-2\">\r\n-                        <b>Mã giảm giá:</b> {order.promoCode} (-{order.promoAmount?.toLocaleString('vi-VN')} VND)\r\n+                  <td colSpan={8}>\r\n+                    <div className=\"bg-white border border-gray-300 rounded-lg shadow p-6 mb-2 text-black\">\r\n+                      <div className=\"mb-4 border-b pb-2\">\r\n+                        <b>Khách hàng:</b> {order.fullName}<br/>\r\n+                        <b>Số điện thoại:</b> {order.phone}\r\n                       </div>\r\n-                    )}\r\n-                    <div>\r\n-                      <b>Tổng tiền:</b> {order.total?.toLocaleString('vi-VN')} VND\r\n+                      <div className=\"mb-4 border-b pb-2\">\r\n+                        <b>Địa chỉ:</b> {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}\r\n+                      </div>\r\n+                      <div className=\"mb-4 border-b pb-2\">\r\n+                        <b>Sản phẩm:</b>\r\n+                        <ul className=\"list-disc pl-5 mt-1\">\r\n+                          {order.items && order.items.map((item, idx) => (\r\n+                            <li key={idx}>\r\n+                              <b>{item.name}</b> (Size: {item.size}, SL: {item.quantity}, Giá: {item.price?.toLocaleString('vi-VN')} VND)\r\n+                            </li>\r\n+                          ))}\r\n+                        </ul>\r\n+                      </div>\r\n+                      {order.promoCode && (\r\n+                        <div className=\"mb-4 border-b pb-2\">\r\n+                          <b>Mã giảm giá:</b> {order.promoCode} (-{order.promoAmount?.toLocaleString('vi-VN')} VND)\r\n+                        </div>\r\n+                      )}\r\n+                      <div>\r\n+                        <b>Tổng tiền:</b> {order.total?.toLocaleString('vi-VN')} VND\r\n+                      </div>\r\n                     </div>\r\n                   </td>\r\n                 </tr>\r\n               )\r\n"
                },
                {
                    "date": 1747111545960,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -261,11 +261,10 @@\n               </tr>,\r\n               expandedOrderId === order._id && (\r\n                 <tr key={order._id + '-expand'}>\r\n                   <td colSpan={8}>\r\n-                    <div className=\"bg-white border border-gray-300 rounded-lg shadow p-6 mb-2 text-black\">\r\n+                    <div className=\"bg-white border border-gray-300 rounded-lg shadow p-6 mb-2 text-sm text-gray-900\">\r\n                       <div className=\"mb-4 border-b pb-2\">\r\n-                        <b>Khách hàng:</b> {order.fullName}<br/>\r\n                         <b>Số điện thoại:</b> {order.phone}\r\n                       </div>\r\n                       <div className=\"mb-4 border-b pb-2\">\r\n                         <b>Địa chỉ:</b> {[order.address, order.apartment, order.ward, order.district, order.province].filter(Boolean).join(\", \")}\r\n@@ -284,11 +283,8 @@\n                         <div className=\"mb-4 border-b pb-2\">\r\n                           <b>Mã giảm giá:</b> {order.promoCode} (-{order.promoAmount?.toLocaleString('vi-VN')} VND)\r\n                         </div>\r\n                       )}\r\n-                      <div>\r\n-                        <b>Tổng tiền:</b> {order.total?.toLocaleString('vi-VN')} VND\r\n-                      </div>\r\n                     </div>\r\n                   </td>\r\n                 </tr>\r\n               )\r\n"
                },
                {
                    "date": 1747210277921,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -262,8 +262,13 @@\n               expandedOrderId === order._id && (\r\n                 <tr key={order._id + '-expand'}>\r\n                   <td colSpan={8}>\r\n                     <div className=\"bg-white border border-gray-300 rounded-lg shadow p-6 mb-2 text-sm text-gray-900\">\r\n+                      {order.email && (\r\n+                        <div className=\"mb-4 border-b pb-2\">\r\n+                          <b>Email:</b> {order.email}\r\n+                        </div>\r\n+                      )}\r\n                       <div className=\"mb-4 border-b pb-2\">\r\n                         <b>Số điện thoại:</b> {order.phone}\r\n                       </div>\r\n                       <div className=\"mb-4 border-b pb-2\">\r\n"
                },
                {
                    "date": 1747210378243,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -98,15 +98,22 @@\n           'Content-Type': 'application/json',\r\n         },\r\n       });\r\n \r\n+      const data = await response.json();\r\n+\r\n       if (!response.ok) {\r\n-        const data = await response.json();\r\n         throw new Error(data.message || 'Không thể xóa đơn hàng');\r\n       }\r\n \r\n-      // Cập nhật lại danh sách đơn hàng sau khi xóa thành công\r\n-      setOrders(orders.filter(order => order._id !== orderId));\r\n+      // Chỉ cập nhật state sau khi xóa thành công\r\n+      setOrders(prevOrders => prevOrders.filter(order => order._id !== orderId));\r\n+      \r\n+      // Đóng modal chi tiết nếu đang mở\r\n+      if (expandedOrderId === orderId) {\r\n+        setExpandedOrderId(null);\r\n+      }\r\n+\r\n       alert('Xóa đơn hàng thành công');\r\n     } catch (error) {\r\n       console.error('Error deleting order:', error);\r\n       alert(error.message || 'Có lỗi xảy ra khi xóa đơn hàng. Vui lòng thử lại.');\r\n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "\"use client\";\r\nimport { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function Orders() {\r\n  const [orders, setOrders] = useState([\r\n    {\r\n      id: \"DH-001\",\r\n      customer: \"Nguyễn Văn A\",\r\n      date: \"01/01/2024\",\r\n      total: \"1,200,000đ\",\r\n      status: \"Đã giao hàng\",\r\n      payment: \"Đã thanh toán\"\r\n    },\r\n    {\r\n      id: \"DH-002\",\r\n      customer: \"Trần Thị B\",\r\n      date: \"02/01/2024\",\r\n      total: \"850,000đ\",\r\n      status: \"Đang giao hàng\",\r\n      payment: \"Đã thanh toán\"\r\n    },\r\n    {\r\n      id: \"DH-003\",\r\n      customer: \"Lê Văn C\",\r\n      date: \"03/01/2024\",\r\n      total: \"2,300,000đ\",\r\n      status: \"Chờ xác nhận\",\r\n      payment: \"Chưa thanh toán\"\r\n    }\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-light text-black\">Quản lý đơn hàng</h1>\r\n        <div className=\"flex space-x-4\">\r\n          <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n            Xuất báo cáo\r\n          </button>\r\n          <button className=\"bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors duration-200\">\r\n            Thêm đơn hàng\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Orders Table */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.5 }}\r\n        className=\"bg-white rounded-lg shadow\"\r\n      >\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Mã đơn hàng\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Khách hàng\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Ngày đặt\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Tổng tiền\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Trạng thái\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Thanh toán\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Thao tác\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {orders.map((order) => (\r\n                <tr key={order.id}>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                    {order.id}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                    {order.customer}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                    {order.date}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                    {order.total}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span\r\n                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                        order.status === \"Đã giao hàng\"\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : order.status === \"Đang giao hàng\"\r\n                          ? \"bg-blue-100 text-blue-800\"\r\n                          : \"bg-yellow-100 text-yellow-800\"\r\n                      }`}\r\n                    >\r\n                      {order.status}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span\r\n                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                        order.payment === \"Đã thanh toán\"\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : \"bg-red-100 text-red-800\"\r\n                      }`}\r\n                    >\r\n                      {order.payment}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                    <button className=\"text-blue-600 hover:text-blue-900 mr-4\">\r\n                      Chi tiết\r\n                    </button>\r\n                    <button className=\"text-red-600 hover:text-red-900\">\r\n                      Hủy\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n} "
        }
    ]
}