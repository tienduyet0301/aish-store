{
    "sourceFile": ".next/server/chunks/[root-of-the-server]__552505db._.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746891736986,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "module.exports = {\n\n\"[project]/.next-internal/server/app/api/products/[id]/route/actions.js [app-rsc] (server actions loader, ecmascript)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\n}}),\n\"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/compiled/next-server/app-route-turbo.runtime.dev.js\", () => require(\"next/dist/compiled/next-server/app-route-turbo.runtime.dev.js\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/compiled/@opentelemetry/api\", () => require(\"next/dist/compiled/@opentelemetry/api\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/compiled/next-server/app-page-turbo.runtime.dev.js\", () => require(\"next/dist/compiled/next-server/app-page-turbo.runtime.dev.js\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/server/app-render/work-unit-async-storage.external.js\", () => require(\"next/dist/server/app-render/work-unit-async-storage.external.js\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/server/app-render/work-async-storage.external.js\", () => require(\"next/dist/server/app-render/work-async-storage.external.js\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"next/dist/server/app-render/after-task-async-storage.external.js\", () => require(\"next/dist/server/app-render/after-task-async-storage.external.js\"));\n\nmodule.exports = mod;\n}}),\n\"[externals]/mongodb [external] (mongodb, cjs)\": (function(__turbopack_context__) {\n\nvar { g: global, __dirname, m: module, e: exports } = __turbopack_context__;\n{\nconst mod = __turbopack_context__.x(\"mongodb\", () => require(\"mongodb\"));\n\nmodule.exports = mod;\n}}),\n\"[project]/src/lib/mongodb.ts [app-route] (ecmascript)\": ((__turbopack_context__) => {\n\"use strict\";\n\nvar { g: global, __dirname } = __turbopack_context__;\n{\n__turbopack_context__.s({\n    \"connectToDatabase\": (()=>connectToDatabase),\n    \"default\": (()=>__TURBOPACK__default__export__)\n});\nvar __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__ = __turbopack_context__.i(\"[externals]/mongodb [external] (mongodb, cjs)\");\n;\nif (!process.env.MONGODB_URI) {\n    throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\nconst uri = process.env.MONGODB_URI;\nconst options = {};\nlet client;\nlet clientPromise;\nif (\"TURBOPACK compile-time truthy\", 1) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    let globalWithMongo = global;\n    if (!globalWithMongo._mongoClientPromise) {\n        client = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__[\"MongoClient\"](uri, options);\n        globalWithMongo._mongoClientPromise = client.connect();\n    }\n    clientPromise = globalWithMongo._mongoClientPromise;\n} else {\n    \"TURBOPACK unreachable\";\n}\nasync function connectToDatabase() {\n    const client = await clientPromise;\n    const db = client.db(\"aishh\");\n    // Update schema if needed\n    const collections = await db.listCollections().toArray();\n    const collectionNames = collections.map((col)=>col.name);\n    // Create banners collection if it doesn't exist\n    if (!collectionNames.includes(\"banners\")) {\n        await db.createCollection(\"banners\");\n        // Create indexes\n        await db.collection(\"banners\").createIndex({\n            order: 1\n        });\n        await db.collection(\"banners\").createIndex({\n            createdAt: 1\n        });\n    }\n    // Update products schema if needed\n    if (collectionNames.includes(\"products\")) {\n        await db.collection(\"products\").updateMany({\n            sizeGuideImage: {\n                $exists: false\n            }\n        }, {\n            $set: {\n                sizeGuideImage: \"\"\n            }\n        });\n    }\n    return {\n        client,\n        db\n    };\n}\nconst __TURBOPACK__default__export__ = clientPromise;\n}}),\n\"[project]/src/app/api/products/[id]/route.ts [app-route] (ecmascript)\": ((__turbopack_context__) => {\n\"use strict\";\n\nvar { g: global, __dirname } = __turbopack_context__;\n{\n__turbopack_context__.s({\n    \"DELETE\": (()=>DELETE),\n    \"GET\": (()=>GET),\n    \"PUT\": (()=>PUT)\n});\nvar __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/node_modules/next/server.js [app-route] (ecmascript)\");\nvar __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mongodb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/src/lib/mongodb.ts [app-route] (ecmascript)\");\nvar __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__ = __turbopack_context__.i(\"[externals]/mongodb [external] (mongodb, cjs)\");\nvar __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/node_modules/next/cache.js [app-route] (ecmascript)\");\n;\n;\n;\n;\nconst DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \"http://localhost:3000\";\nasync function GET(request, { params }) {\n    try {\n        const client = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mongodb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"default\"];\n        const db = client.db(\"aishh\");\n        const { id } = params;\n        const product = await db.collection(\"products\").findOne({\n            _id: new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__[\"ObjectId\"](id)\n        });\n        if (!product) {\n            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n                ok: false,\n                error: \"Product not found\"\n            }, {\n                status: 404\n            });\n        }\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: true,\n            product: {\n                ...product,\n                _id: product._id.toString(),\n                images: product.images?.map((url)=>url.startsWith('http') ? url : `${DOMAIN}${url}`) || []\n            }\n        });\n    } catch (error) {\n        console.error(\"Error fetching product:\", error);\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: false,\n            error: \"Failed to fetch product\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PUT(request, { params }) {\n    try {\n        const client = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mongodb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"default\"];\n        const db = client.db(\"aishh\");\n        const product = await request.json();\n        const { id } = params;\n        // Chuyển đổi các trường số\n        const updatedProduct = {\n            name: product.name,\n            price: Number(product.price),\n            description: product.description,\n            images: product.images,\n            quantityM: Number(product.quantityM),\n            quantityL: Number(product.quantityL),\n            quantityXL: Number(product.quantityXL),\n            quantityHat: Number(product.quantityHat),\n            productCode: product.productCode,\n            details: product.details,\n            category: product.category,\n            collection: product.collection,\n            colors: product.colors || [],\n            updatedAt: new Date().toISOString()\n        };\n        const result = await db.collection(\"products\").updateOne({\n            _id: new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__[\"ObjectId\"](id)\n        }, {\n            $set: updatedProduct\n        });\n        if (result.matchedCount === 0) {\n            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n                ok: false,\n                error: \"Product not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Lấy sản phẩm đã cập nhật\n        const updatedProductData = await db.collection(\"products\").findOne({\n            _id: new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__[\"ObjectId\"](id)\n        });\n        if (!updatedProductData) {\n            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n                ok: false,\n                error: \"Failed to fetch updated product\"\n            }, {\n                status: 500\n            });\n        }\n        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"revalidatePath\"])(\"/products\");\n        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"revalidatePath\"])(\"/admin/products\");\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: true,\n            product: {\n                ...updatedProductData,\n                _id: updatedProductData._id.toString(),\n                images: updatedProductData.images?.map((url)=>url.startsWith('http') ? url : `${DOMAIN}${url}`) || []\n            }\n        });\n    } catch (error) {\n        console.error(\"Error updating product:\", error);\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: false,\n            error: \"Failed to update product\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function DELETE(request, { params }) {\n    try {\n        const client = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$mongodb$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"default\"];\n        const db = client.db(\"aishh\");\n        const { id } = params;\n        const result = await db.collection(\"products\").deleteOne({\n            _id: new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__[\"ObjectId\"](id)\n        });\n        if (result.deletedCount === 0) {\n            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n                ok: false,\n                error: \"Product not found\"\n            }, {\n                status: 404\n            });\n        }\n        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"revalidatePath\"])(\"/products\");\n        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"revalidatePath\"])(\"/admin/products\");\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: true\n        });\n    } catch (error) {\n        console.error(\"Error deleting product:\", error);\n        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[\"NextResponse\"].json({\n            ok: false,\n            error: \"Failed to delete product\"\n        }, {\n            status: 500\n        });\n    }\n}\n}}),\n\n};\n\n//# sourceMappingURL=%5Broot-of-the-server%5D__552505db._.js.map"
        }
    ]
}