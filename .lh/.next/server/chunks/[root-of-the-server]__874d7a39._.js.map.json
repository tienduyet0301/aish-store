{
    "sourceFile": ".next/server/chunks/[root-of-the-server]__874d7a39._.js.map",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746891737111,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "{\n  \"version\": 3,\n  \"sources\": [],\n  \"sections\": [\n    {\"offset\": {\"line\": 6, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\",\"debugId\":null}},\n    {\"offset\": {\"line\": 68, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"file://C%3A/Users/hongh/aishh/src/lib/mongodb.ts\"],\"sourcesContent\":[\"import { MongoClient } from \\\"mongodb\\\";\\r\\n\\r\\nif (!process.env.MONGODB_URI) {\\r\\n  throw new Error('Invalid/Missing environment variable: \\\"MONGODB_URI\\\"');\\r\\n}\\r\\n\\r\\nconst uri = process.env.MONGODB_URI;\\r\\nconst options = {};\\r\\n\\r\\nlet client;\\r\\nlet clientPromise: Promise<MongoClient>;\\r\\n\\r\\nif (process.env.NODE_ENV === \\\"development\\\") {\\r\\n  // In development mode, use a global variable so that the value\\r\\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\\r\\n  let globalWithMongo = global as typeof globalThis & {\\r\\n    _mongoClientPromise?: Promise<MongoClient>;\\r\\n  };\\r\\n\\r\\n  if (!globalWithMongo._mongoClientPromise) {\\r\\n    client = new MongoClient(uri, options);\\r\\n    globalWithMongo._mongoClientPromise = client.connect();\\r\\n  }\\r\\n  clientPromise = globalWithMongo._mongoClientPromise;\\r\\n} else {\\r\\n  // In production mode, it's best to not use a global variable.\\r\\n  client = new MongoClient(uri, options);\\r\\n  clientPromise = client.connect();\\r\\n}\\r\\n\\r\\nexport async function connectToDatabase() {\\r\\n  const client = await clientPromise;\\r\\n  const db = client.db(\\\"aishh\\\");\\r\\n\\r\\n  // Update schema if needed\\r\\n  const collections = await db.listCollections().toArray();\\r\\n  const collectionNames = collections.map(col => col.name);\\r\\n\\r\\n  // Create banners collection if it doesn't exist\\r\\n  if (!collectionNames.includes(\\\"banners\\\")) {\\r\\n    await db.createCollection(\\\"banners\\\");\\r\\n    // Create indexes\\r\\n    await db.collection(\\\"banners\\\").createIndex({ order: 1 });\\r\\n    await db.collection(\\\"banners\\\").createIndex({ createdAt: 1 });\\r\\n  }\\r\\n\\r\\n  // Update products schema if needed\\r\\n  if (collectionNames.includes(\\\"products\\\")) {\\r\\n    await db.collection(\\\"products\\\").updateMany(\\r\\n      { sizeGuideImage: { $exists: false } },\\r\\n      { $set: { sizeGuideImage: \\\"\\\" } }\\r\\n    );\\r\\n  }\\r\\n\\r\\n  return { client, db };\\r\\n}\\r\\n\\r\\nexport default clientPromise; \"],\"names\":[],\"mappings\":\";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,kBAAkB;IAItB,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,uGAAA,CAAA,cAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD,OAAO;;AAIP;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,MAAM,KAAK,OAAO,EAAE,CAAC;IAErB,0BAA0B;IAC1B,MAAM,cAAc,MAAM,GAAG,eAAe,GAAG,OAAO;IACtD,MAAM,kBAAkB,YAAY,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI;IAEvD,gDAAgD;IAChD,IAAI,CAAC,gBAAgB,QAAQ,CAAC,YAAY;QACxC,MAAM,GAAG,gBAAgB,CAAC;QAC1B,iBAAiB;QACjB,MAAM,GAAG,UAAU,CAAC,WAAW,WAAW,CAAC;YAAE,OAAO;QAAE;QACtD,MAAM,GAAG,UAAU,CAAC,WAAW,WAAW,CAAC;YAAE,WAAW;QAAE;IAC5D;IAEA,mCAAmC;IACnC,IAAI,gBAAgB,QAAQ,CAAC,aAAa;QACxC,MAAM,GAAG,UAAU,CAAC,YAAY,UAAU,CACxC;YAAE,gBAAgB;gBAAE,SAAS;YAAM;QAAE,GACrC;YAAE,MAAM;gBAAE,gBAAgB;YAAG;QAAE;IAEnC;IAEA,OAAO;QAAE;QAAQ;IAAG;AACtB;uCAEe\",\"debugId\":null}},\n    {\"offset\": {\"line\": 134, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"file://C%3A/Users/hongh/aishh/src/app/api/products/route.ts\"],\"sourcesContent\":[\"// src/app/api/products/route.ts\\nimport { NextResponse } from \\\"next/server\\\";\\nimport { connectToDatabase } from \\\"@/lib/mongodb\\\";\\nimport { ObjectId } from \\\"mongodb\\\";\\n\\nconst DOMAIN = process.env.NEXT_PUBLIC_DOMAIN || \\\"http://localhost:3000\\\";\\n\\n// GET /api/products - Lấy danh sách sản phẩm\\nexport async function GET() {\\n  try {\\n    console.log(\\\"Connecting to database...\\\");\\n    const { db } = await connectToDatabase();\\n    console.log(\\\"Connected to database successfully\\\");\\n\\n    console.log(\\\"Fetching products...\\\");\\n    const products = await db.collection(\\\"products\\\").find({}).toArray();\\n    console.log(`Found ${products.length} products`);\\n\\n    return NextResponse.json({ ok: true, products });\\n  } catch (error: any) {\\n    console.error(\\\"Error details:\\\", {\\n      message: error?.message || 'Unknown error',\\n      stack: error?.stack || 'No stack trace',\\n      name: error?.name || 'Unknown error type'\\n    });\\n    return NextResponse.json(\\n      { ok: false, error: \\\"Failed to fetch products\\\" },\\n      { status: 500 }\\n    );\\n  }\\n}\\n\\n// POST /api/products - Thêm sản phẩm mới\\nexport async function POST(request: Request) {\\n  try {\\n    const formData = await request.formData();\\n    const name = formData.get(\\\"name\\\") as string;\\n    const description = formData.get(\\\"description\\\") as string;\\n    const details = formData.get(\\\"details\\\") as string;\\n    const price = Number(formData.get(\\\"price\\\"));\\n    const category = formData.get(\\\"category\\\") as string;\\n    const collection = formData.get(\\\"collection\\\") as string;\\n    const productCode = formData.get(\\\"productCode\\\") as string;\\n    const quantityM = Number(formData.get(\\\"quantityM\\\"));\\n    const quantityL = Number(formData.get(\\\"quantityL\\\"));\\n    const quantityXL = Number(formData.get(\\\"quantityXL\\\"));\\n    const quantityHat = Number(formData.get(\\\"quantityHat\\\"));\\n    const images = JSON.parse(formData.get(\\\"images\\\") as string);\\n    const sizeGuideImage = formData.get(\\\"sizeGuideImage\\\") as string;\\n    const colors = JSON.parse(formData.get(\\\"colors\\\") as string || \\\"[]\\\");\\n\\n    const { db } = await connectToDatabase();\\n    const product = {\\n      name,\\n      description,\\n      details,\\n      price,\\n      category,\\n      collection,\\n      productCode,\\n      images,\\n      sizeGuideImage,\\n      quantityM,\\n      quantityL,\\n      quantityXL,\\n      quantityHat,\\n      colors,\\n      createdAt: new Date().toISOString(),\\n      updatedAt: new Date().toISOString(),\\n    };\\n\\n    const result = await db.collection(\\\"products\\\").insertOne(product);\\n\\n    return NextResponse.json({\\n      ok: true,\\n      product: { ...product, _id: result.insertedId },\\n    });\\n  } catch (error) {\\n    console.error(\\\"Error creating product:\\\", error);\\n    return NextResponse.json(\\n      { ok: false, error: \\\"Failed to create product\\\" },\\n      { status: 500 }\\n    );\\n  }\\n}\\n\\n// PUT /api/products/[id] - Cập nhật sản phẩm\\nexport async function PUT(request: Request) {\\n  try {\\n    const { searchParams } = new URL(request.url);\\n    const id = searchParams.get(\\\"id\\\");\\n    \\n    if (!id) {\\n      return NextResponse.json(\\n        { ok: false, error: \\\"Product ID is required\\\" },\\n        { status: 400 }\\n      );\\n    }\\n\\n    const formData = await request.formData();\\n    \\n    const updateData: any = {\\n      name: formData.get(\\\"name\\\"),\\n      description: formData.get(\\\"description\\\"),\\n      details: formData.get(\\\"details\\\"),\\n      price: Number(formData.get(\\\"price\\\")),\\n      category: formData.get(\\\"category\\\"),\\n      quantityM: Number(formData.get(\\\"quantityM\\\")),\\n      quantityL: Number(formData.get(\\\"quantityL\\\")),\\n      quantityXL: Number(formData.get(\\\"quantityXL\\\")),\\n      quantityHat: Number(formData.get(\\\"quantityHat\\\")),\\n      colors: JSON.parse(formData.get(\\\"colors\\\") as string || \\\"[]\\\"),\\n      updatedAt: new Date().toISOString(),\\n    };\\n\\n    // Handle size guide image upload if exists\\n    const sizeGuideImage = formData.get(\\\"sizeGuideImage\\\") as File;\\n    if (sizeGuideImage) {\\n      const sizeGuideFormData = new FormData();\\n      sizeGuideFormData.append(\\\"file\\\", sizeGuideImage);\\n      \\n      const uploadResponse = await fetch(\\\"/api/upload\\\", {\\n        method: \\\"POST\\\",\\n        body: sizeGuideFormData,\\n      });\\n\\n      if (!uploadResponse.ok) {\\n        throw new Error(\\\"Failed to upload size guide image\\\");\\n      }\\n\\n      const uploadData = await uploadResponse.json();\\n      updateData.sizeGuideImage = uploadData.url;\\n    }\\n\\n    const { db } = await connectToDatabase();\\n    const result = await db.collection(\\\"products\\\").updateOne(\\n      { _id: new ObjectId(id) },\\n      { $set: updateData }\\n    );\\n\\n    if (result.matchedCount === 0) {\\n      return NextResponse.json(\\n        { ok: false, error: \\\"Product not found\\\" },\\n        { status: 404 }\\n      );\\n    }\\n\\n    const updatedProduct = await db.collection(\\\"products\\\").findOne({\\n      _id: new ObjectId(id),\\n    });\\n\\n    return NextResponse.json({\\n      ok: true,\\n      product: updatedProduct,\\n    });\\n  } catch (error) {\\n    console.error(\\\"Error updating product:\\\", error);\\n    return NextResponse.json(\\n      { ok: false, error: \\\"Failed to update product\\\" },\\n      { status: 500 }\\n    );\\n  }\\n}\\n\\n// DELETE /api/products/[id] - Xóa sản phẩm\\nexport async function DELETE(\\n  request: Request,\\n  { params }: { params: { id: string } }\\n) {\\n  try {\\n    const { db } = await connectToDatabase();\\n    const { id } = params;\\n\\n    const result = await db\\n      .collection(\\\"products\\\")\\n      .deleteOne({ _id: new ObjectId(id) });\\n\\n    if (result.deletedCount === 0) {\\n      return NextResponse.json(\\n        { ok: false, error: \\\"Product not found\\\" },\\n        { status: 404 }\\n      );\\n    }\\n\\n    return NextResponse.json({ ok: true });\\n  } catch (error) {\\n    console.error(\\\"Error deleting product:\\\", error);\\n    return NextResponse.json(\\n      { ok: false, error: \\\"Failed to delete product\\\" },\\n      { status: 500 }\\n    );\\n  }\\n}\\n\"],\"names\":[],\"mappings\":\"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\",\"debugId\":null}}]\n}"
        }
    ]
}