{
    "sourceFile": "node_modules/next/dist/esm/export/routes/app-route.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746892798706,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "import { INFINITE_CACHE, NEXT_BODY_SUFFIX, NEXT_CACHE_TAGS_HEADER, NEXT_META_SUFFIX } from '../../lib/constants';\nimport { NodeNextRequest } from '../../server/base-http/node';\nimport { NextRequestAdapter, signalFromNodeResponse } from '../../server/web/spec-extension/adapters/next-request';\nimport { toNodeOutgoingHttpHeaders } from '../../server/web/utils';\nimport { isDynamicUsageError } from '../helpers/is-dynamic-usage-error';\nimport { hasNextSupport } from '../../server/ci-info';\nimport { isStaticGenEnabled } from '../../server/route-modules/app-route/helpers/is-static-gen-enabled';\nimport { isMetadataRoute } from '../../lib/metadata/is-metadata-route';\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths';\nimport { AfterRunner } from '../../server/after/run-with-after';\nexport var ExportedAppRouteFiles = /*#__PURE__*/ function(ExportedAppRouteFiles) {\n    ExportedAppRouteFiles[\"BODY\"] = \"BODY\";\n    ExportedAppRouteFiles[\"META\"] = \"META\";\n    return ExportedAppRouteFiles;\n}({});\nexport async function exportAppRoute(req, res, params, page, module, incrementalCache, cacheLifeProfiles, htmlFilepath, fileWriter, experimental, buildId) {\n    // Ensure that the URL is absolute.\n    req.url = `http://localhost:3000${req.url}`;\n    // Adapt the request and response to the Next.js request and response.\n    const request = NextRequestAdapter.fromNodeNextRequest(new NodeNextRequest(req), signalFromNodeResponse(res));\n    const afterRunner = new AfterRunner();\n    // Create the context for the handler. This contains the params from\n    // the route and the context for the request.\n    const context = {\n        params,\n        prerenderManifest: {\n            version: 4,\n            routes: {},\n            dynamicRoutes: {},\n            preview: {\n                previewModeEncryptionKey: '',\n                previewModeId: '',\n                previewModeSigningKey: ''\n            },\n            notFoundRoutes: []\n        },\n        renderOpts: {\n            experimental,\n            nextExport: true,\n            supportsDynamicResponse: false,\n            incrementalCache,\n            waitUntil: afterRunner.context.waitUntil,\n            onClose: afterRunner.context.onClose,\n            onAfterTaskError: afterRunner.context.onTaskError,\n            cacheLifeProfiles\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    if (hasNextSupport) {\n        context.renderOpts.isRevalidate = true;\n    }\n    try {\n        const userland = module.userland;\n        // we don't bail from the static optimization for\n        // metadata routes, since it's app-route we can always append /route suffix.\n        const routePath = normalizeAppPath(page) + '/route';\n        const isPageMetadataRoute = isMetadataRoute(routePath);\n        if (!isStaticGenEnabled(userland) && !isPageMetadataRoute && // We don't disable static gen when dynamicIO is enabled because we\n        // expect that anything dynamic in the GET handler will make it dynamic\n        // and thus avoid the cache surprises that led to us removing static gen\n        // unless specifically opted into\n        experimental.dynamicIO !== true) {\n            return {\n                cacheControl: {\n                    revalidate: 0,\n                    expire: undefined\n                }\n            };\n        }\n        const response = await module.handle(request, context);\n        const isValidStatus = response.status < 400 || response.status === 404;\n        if (!isValidStatus) {\n            return {\n                cacheControl: {\n                    revalidate: 0,\n                    expire: undefined\n                }\n            };\n        }\n        const blob = await response.blob();\n        // TODO(after): if we abort a prerender because of an error in an after-callback\n        // we should probably communicate that better (and not log the error twice)\n        await afterRunner.executeAfter();\n        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n        const headers = toNodeOutgoingHttpHeaders(response.headers);\n        const cacheTags = context.renderOpts.collectedTags;\n        if (cacheTags) {\n            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n        }\n        if (!headers['content-type'] && blob.type) {\n            headers['content-type'] = blob.type;\n        }\n        // Writing response body to a file.\n        const body = Buffer.from(await blob.arrayBuffer());\n        fileWriter.append(htmlFilepath.replace(/\\.html$/, NEXT_BODY_SUFFIX), body);\n        // Write the request metadata to a file.\n        const meta = {\n            status: response.status,\n            headers\n        };\n        fileWriter.append(htmlFilepath.replace(/\\.html$/, NEXT_META_SUFFIX), JSON.stringify(meta));\n        return {\n            cacheControl: {\n                revalidate,\n                expire\n            },\n            metadata: meta\n        };\n    } catch (err) {\n        if (!isDynamicUsageError(err)) {\n            throw err;\n        }\n        return {\n            cacheControl: {\n                revalidate: 0,\n                expire: undefined\n            }\n        };\n    }\n}\n\n//# sourceMappingURL=app-route.js.map"
        }
    ]
}