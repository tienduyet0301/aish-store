{
    "sourceFile": "node_modules/next-auth/src/client/__tests__/csrf.test.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746892932089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "import { useState } from \"react\"\nimport userEvent from \"@testing-library/user-event\"\nimport { render, screen, waitFor } from \"@testing-library/react\"\nimport { server, mockCSRFToken } from \"./helpers/mocks\"\nimport logger from \"../../utils/logger\"\nimport { getCsrfToken } from \"../../react\"\nimport { rest } from \"msw\"\n\njest.mock(\"../../utils/logger\", () => ({\n  __esModule: true,\n  default: {\n    warn: jest.fn(),\n    debug: jest.fn(),\n    error: jest.fn(),\n  },\n  proxyLogger(logger) {\n    return logger\n  },\n}))\n\nbeforeAll(() => {\n  server.listen()\n})\n\nafterEach(() => {\n  server.resetHandlers()\n  jest.clearAllMocks()\n})\n\nafterAll(() => {\n  server.close()\n})\n\ntest(\"returns the Cross Site Request Forgery Token (CSRF Token) required to make POST requests\", async () => {\n  render(<CSRFFlow />)\n\n  userEvent.click(screen.getByRole(\"button\"))\n\n  await waitFor(() => {\n    expect(screen.getByTestId(\"csrf-result\").textContent).toEqual(\n      mockCSRFToken.csrfToken\n    )\n  })\n})\n\ntest(\"when there's no CSRF token returned, it'll reflect that\", async () => {\n  server.use(\n    rest.get(\"*/api/auth/csrf\", (req, res, ctx) =>\n      res(\n        ctx.status(200),\n        ctx.json({\n          ...mockCSRFToken,\n          csrfToken: null,\n        })\n      )\n    )\n  )\n\n  render(<CSRFFlow />)\n\n  userEvent.click(screen.getByRole(\"button\"))\n\n  await waitFor(() => {\n    expect(screen.getByTestId(\"csrf-result\").textContent).toBe(\"null-response\")\n  })\n})\n\ntest(\"when the fetch fails it'll throw a client fetch error\", async () => {\n  server.use(\n    rest.get(\"*/api/auth/csrf\", (req, res, ctx) =>\n      res(ctx.status(500), ctx.text(\"some error happened\"))\n    )\n  )\n\n  render(<CSRFFlow />)\n\n  userEvent.click(screen.getByRole(\"button\"))\n\n  await waitFor(() => {\n    expect(logger.error).toHaveBeenCalledTimes(1)\n    expect(logger.error).toBeCalledWith(\"CLIENT_FETCH_ERROR\", {\n      url: \"/api/auth/csrf\",\n      error: new SyntaxError(\"Unexpected token s in JSON at position 0\"),\n    })\n  })\n})\n\nfunction CSRFFlow() {\n  const [response, setResponse] = useState()\n\n  async function handleCSRF() {\n    const result = await getCsrfToken()\n    setResponse(result)\n  }\n\n  return (\n    <>\n      <p data-testid=\"csrf-result\">\n        {response === null ? \"null-response\" : response || \"no response\"}\n      </p>\n      <button onClick={handleCSRF}>Get CSRF</button>\n    </>\n  )\n}\n"
        }
    ]
}