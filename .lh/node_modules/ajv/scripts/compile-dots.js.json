{
    "sourceFile": "node_modules/ajv/scripts/compile-dots.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746892016790,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "//compile doT templates to js functions\n'use strict';\n\nvar glob = require('glob')\n  , fs = require('fs')\n  , path = require('path')\n  , doT = require('dot')\n  , beautify = require('js-beautify').js_beautify;\n\nvar defsRootPath = process.argv[2] || path.join(__dirname, '../lib');\n\nvar defs = {};\nvar defFiles = glob.sync('./dot/**/*.def', { cwd: defsRootPath });\ndefFiles.forEach(function (f) {\n  var name = path.basename(f, '.def');\n  defs[name] = fs.readFileSync(path.join(defsRootPath, f));\n});\n\nvar filesRootPath = process.argv[3] || path.join(__dirname, '../lib');\nvar files = glob.sync('./dot/**/*.jst', { cwd: filesRootPath });\n\nvar dotjsPath = path.join(filesRootPath, './dotjs');\ntry { fs.mkdirSync(dotjsPath); } catch(e) {}\n\nconsole.log('\\n\\nCompiling:');\n\nvar FUNCTION_NAME = /function\\s+anonymous\\s*\\(it[^)]*\\)\\s*{/;\nvar OUT_EMPTY_STRING = /out\\s*\\+=\\s*'\\s*';/g;\nvar ISTANBUL = /'(istanbul[^']+)';/g;\nvar ERROR_KEYWORD = /\\$errorKeyword/g;\nvar ERROR_KEYWORD_OR = /\\$errorKeyword\\s+\\|\\|/g;\nvar VARS = [\n  '$errs', '$valid', '$lvl', '$data', '$dataLvl',\n  '$errorKeyword', '$closingBraces', '$schemaPath',\n  '$validate'\n];\n\nfiles.forEach(function (f) {\n  var keyword = path.basename(f, '.jst');\n  var targetPath = path.join(dotjsPath, keyword + '.js');\n  var template = fs.readFileSync(path.join(filesRootPath, f));\n  var code = doT.compile(template, defs);\n  code = code.toString()\n             .replace(OUT_EMPTY_STRING, '')\n             .replace(FUNCTION_NAME, 'function generate_' + keyword + '(it, $keyword, $ruleType) {')\n             .replace(ISTANBUL, '/* $1 */');\n  removeAlwaysFalsyInOr();\n  VARS.forEach(removeUnusedVar);\n  code = \"'use strict';\\nmodule.exports = \" + code;\n  code = beautify(code, { indent_size: 2 }) + '\\n';\n  fs.writeFileSync(targetPath, code);\n  console.log('compiled', keyword);\n\n  function removeUnusedVar(v) {\n    v = v.replace(/\\$/g, '\\\\$$');\n    var regexp = new RegExp(v + '[^A-Za-z0-9_$]', 'g');\n    var count = occurrences(regexp);\n    if (count == 1) {\n      regexp = new RegExp('var\\\\s+' + v + '\\\\s*=[^;]+;|var\\\\s+' + v + ';');\n      code = code.replace(regexp, '');\n    }\n  }\n\n  function removeAlwaysFalsyInOr() {\n    var countUsed = occurrences(ERROR_KEYWORD);\n    var countOr = occurrences(ERROR_KEYWORD_OR);\n    if (countUsed == countOr + 1) code = code.replace(ERROR_KEYWORD_OR, '');\n  }\n\n  function occurrences(regexp) {\n    return (code.match(regexp) || []).length;\n  }\n});\n"
        }
    ]
}