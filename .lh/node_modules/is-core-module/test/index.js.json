{
    "sourceFile": "node_modules/is-core-module/test/index.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1746892331796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1746891704042,
            "name": "cart",
            "content": "'use strict';\n\nvar test = require('tape');\nvar keys = require('object-keys');\nvar semver = require('semver');\nvar mockProperty = require('mock-property');\n\nvar isCore = require('../');\nvar data = require('../core.json');\n\nvar supportsNodePrefix = semver.satisfies(process.versions.node, '^14.18 || >= 16', { includePrerelease: true });\n\ntest('core modules', function (t) {\n\tt.test('isCore()', function (st) {\n\t\tst.ok(isCore('fs'));\n\t\tst.ok(isCore('net'));\n\t\tst.ok(isCore('http'));\n\n\t\tst.ok(!isCore('seq'));\n\t\tst.ok(!isCore('../'));\n\n\t\tst.ok(!isCore('toString'));\n\n\t\tst.end();\n\t});\n\n\tt.test('core list', function (st) {\n\t\tvar cores = keys(data);\n\t\tst.plan(cores.length);\n\n\t\tfor (var i = 0; i < cores.length; ++i) {\n\t\t\tvar mod = cores[i];\n\t\t\tvar requireFunc = function () { require(mod); }; // eslint-disable-line no-loop-func\n\t\t\tif (isCore(mod)) {\n\t\t\t\tst.doesNotThrow(requireFunc, mod + ' supported; requiring does not throw');\n\t\t\t} else {\n\t\t\t\tst['throws'](requireFunc, mod + ' not supported; requiring throws');\n\t\t\t}\n\t\t}\n\n\t\tst.end();\n\t});\n\n\tt.test('core via repl module', { skip: !data.repl }, function (st) {\n\t\tvar libs = require('repl')._builtinLibs; // eslint-disable-line no-underscore-dangle\n\t\tif (!libs) {\n\t\t\tst.skip('repl._builtinLibs does not exist');\n\t\t} else {\n\t\t\tfor (var i = 0; i < libs.length; ++i) {\n\t\t\t\tvar mod = libs[i];\n\t\t\t\tst.ok(data[mod], mod + ' is a core module');\n\t\t\t\tst.doesNotThrow(\n\t\t\t\t\tfunction () { require(mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t'requiring ' + mod + ' does not throw'\n\t\t\t\t);\n\t\t\t\tif (mod.slice(0, 5) !== 'node:') {\n\t\t\t\t\tif (supportsNodePrefix) {\n\t\t\t\t\t\tst.doesNotThrow(\n\t\t\t\t\t\t\tfunction () { require('node:' + mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t\t\t'requiring node:' + mod + ' does not throw'\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tst['throws'](\n\t\t\t\t\t\t\tfunction () { require('node:' + mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t\t\t'requiring node:' + mod + ' throws'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tst.end();\n\t});\n\n\tt.test('core via builtinModules list', { skip: !data.module }, function (st) {\n\t\tvar Module = require('module');\n\t\tvar libs = Module.builtinModules;\n\t\tif (!libs) {\n\t\t\tst.skip('module.builtinModules does not exist');\n\t\t} else {\n\t\t\tvar excludeList = [\n\t\t\t\t'_debug_agent',\n\t\t\t\t'v8/tools/tickprocessor-driver',\n\t\t\t\t'v8/tools/SourceMap',\n\t\t\t\t'v8/tools/tickprocessor',\n\t\t\t\t'v8/tools/profile'\n\t\t\t];\n\n\t\t\t// see https://github.com/nodejs/node/issues/42785\n\t\t\tif (semver.satisfies(process.version, '>= 18')) {\n\t\t\t\tlibs = libs.concat('node:test');\n\t\t\t}\n\t\t\tif (semver.satisfies(process.version, '^20.12 || >= 21.7')) {\n\t\t\t\tlibs = libs.concat('node:sea');\n\t\t\t}\n\t\t\tif (semver.satisfies(process.version, '>= 23.4')) {\n\t\t\t\tlibs = libs.concat('node:sqlite');\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < libs.length; ++i) {\n\t\t\t\tvar mod = libs[i];\n\t\t\t\tif (excludeList.indexOf(mod) === -1) {\n\t\t\t\t\tst.ok(data[mod], mod + ' is a core module');\n\n\t\t\t\t\tif (Module.isBuiltin) {\n\t\t\t\t\t\tst.ok(Module.isBuiltin(mod), 'module.isBuiltin(' + mod + ') is true');\n\t\t\t\t\t}\n\n\t\t\t\t\tst.doesNotThrow(\n\t\t\t\t\t\tfunction () { require(mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t\t'requiring ' + mod + ' does not throw'\n\t\t\t\t\t);\n\n\t\t\t\t\tif (process.getBuiltinModule) {\n\t\t\t\t\t\tst.equal(\n\t\t\t\t\t\t\tprocess.getBuiltinModule(mod),\n\t\t\t\t\t\t\trequire(mod),\n\t\t\t\t\t\t\t'process.getBuiltinModule(' + mod + ') === require(' + mod + ')'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mod.slice(0, 5) !== 'node:') {\n\t\t\t\t\t\tif (supportsNodePrefix) {\n\t\t\t\t\t\t\tst.doesNotThrow(\n\t\t\t\t\t\t\t\tfunction () { require('node:' + mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t\t\t\t'requiring node:' + mod + ' does not throw'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tst['throws'](\n\t\t\t\t\t\t\t\tfunction () { require('node:' + mod); }, // eslint-disable-line no-loop-func\n\t\t\t\t\t\t\t\t'requiring node:' + mod + ' throws'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tst.end();\n\t});\n\n\tt.test('Object.prototype pollution', function (st) {\n\t\tvar nonKey = 'not a core module';\n\t\tst.teardown(mockProperty(Object.prototype, 'fs', { value: false }));\n\t\tst.teardown(mockProperty(Object.prototype, 'path', { value: '>= 999999999' }));\n\t\tst.teardown(mockProperty(Object.prototype, 'http', { value: data.http }));\n\t\tst.teardown(mockProperty(Object.prototype, nonKey, { value: true }));\n\n\t\tst.equal(isCore('fs'), true, 'fs is a core module even if Object.prototype lies');\n\t\tst.equal(isCore('path'), true, 'path is a core module even if Object.prototype lies');\n\t\tst.equal(isCore('http'), true, 'path is a core module even if Object.prototype matches data');\n\t\tst.equal(isCore(nonKey), false, '\"' + nonKey + '\" is not a core module even if Object.prototype lies');\n\n\t\tst.end();\n\t});\n\n\tt.end();\n});\n"
        }
    ]
}